{"ast":null,"code":"import _toConsumableArray from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _slicedToArray from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _regeneratorRuntime from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _createClass from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _classCallCheck from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _inherits from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _wrapNativeSuper from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/wrapNativeSuper.js\";\n// Typescript `enums` thwart tree-shaking. See https://bargsten.org/jsts/enums/\nvar SolanaMobileWalletAdapterErrorCode = {\n  ERROR_ASSOCIATION_PORT_OUT_OF_RANGE: 'ERROR_ASSOCIATION_PORT_OUT_OF_RANGE',\n  ERROR_FORBIDDEN_WALLET_BASE_URL: 'ERROR_FORBIDDEN_WALLET_BASE_URL',\n  ERROR_SECURE_CONTEXT_REQUIRED: 'ERROR_SECURE_CONTEXT_REQUIRED',\n  ERROR_SESSION_CLOSED: 'ERROR_SESSION_CLOSED',\n  ERROR_SESSION_TIMEOUT: 'ERROR_SESSION_TIMEOUT',\n  ERROR_WALLET_NOT_FOUND: 'ERROR_WALLET_NOT_FOUND'\n};\nvar SolanaMobileWalletAdapterError = /*#__PURE__*/function (_Error) {\n  _inherits(SolanaMobileWalletAdapterError, _Error);\n  var _super = _createSuper(SolanaMobileWalletAdapterError);\n  function SolanaMobileWalletAdapterError() {\n    var _this;\n    _classCallCheck(this, SolanaMobileWalletAdapterError);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    var code = args[0],\n      message = args[1],\n      data = args[2];\n    _this = _super.call(this, message);\n    _this.code = code;\n    _this.data = data;\n    _this.name = 'SolanaMobileWalletAdapterError';\n    return _this;\n  }\n  return _createClass(SolanaMobileWalletAdapterError);\n}( /*#__PURE__*/_wrapNativeSuper(Error)); // Typescript `enums` thwart tree-shaking. See https://bargsten.org/jsts/enums/\nvar SolanaMobileWalletAdapterProtocolErrorCode = {\n  // Keep these in sync with `mobilewalletadapter/common/ProtocolContract.java`.\n  ERROR_AUTHORIZATION_FAILED: -1,\n  ERROR_INVALID_PAYLOADS: -2,\n  ERROR_NOT_SIGNED: -3,\n  ERROR_NOT_SUBMITTED: -4,\n  ERROR_TOO_MANY_PAYLOADS: -5,\n  ERROR_ATTEST_ORIGIN_ANDROID: -100\n};\nvar SolanaMobileWalletAdapterProtocolError = /*#__PURE__*/function (_Error2) {\n  _inherits(SolanaMobileWalletAdapterProtocolError, _Error2);\n  var _super2 = _createSuper(SolanaMobileWalletAdapterProtocolError);\n  function SolanaMobileWalletAdapterProtocolError() {\n    var _this2;\n    _classCallCheck(this, SolanaMobileWalletAdapterProtocolError);\n    for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n      args[_key2] = arguments[_key2];\n    }\n    var jsonRpcMessageId = args[0],\n      code = args[1],\n      message = args[2],\n      data = args[3];\n    _this2 = _super2.call(this, message);\n    _this2.code = code;\n    _this2.data = data;\n    _this2.jsonRpcMessageId = jsonRpcMessageId;\n    _this2.name = 'SolanaMobileWalletAdapterProtocolError';\n    return _this2;\n  }\n  return _createClass(SolanaMobileWalletAdapterProtocolError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\nfunction __awaiter(thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n}\nfunction createHelloReq(ecdhPublicKey, associationKeypairPrivateKey) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var publicKeyBuffer, signatureBuffer, response;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return crypto.subtle.exportKey('raw', ecdhPublicKey);\n          case 2:\n            publicKeyBuffer = _context.sent;\n            _context.next = 5;\n            return crypto.subtle.sign({\n              hash: 'SHA-256',\n              name: 'ECDSA'\n            }, associationKeypairPrivateKey, publicKeyBuffer);\n          case 5:\n            signatureBuffer = _context.sent;\n            response = new Uint8Array(publicKeyBuffer.byteLength + signatureBuffer.byteLength);\n            response.set(new Uint8Array(publicKeyBuffer), 0);\n            response.set(new Uint8Array(signatureBuffer), publicKeyBuffer.byteLength);\n            return _context.abrupt(\"return\", response);\n          case 10:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n}\nvar SEQUENCE_NUMBER_BYTES = 4;\nfunction createSequenceNumberVector(sequenceNumber) {\n  if (sequenceNumber >= 4294967296) {\n    throw new Error('Outbound sequence number overflow. The maximum sequence number is 32-bytes.');\n  }\n  var byteArray = new ArrayBuffer(SEQUENCE_NUMBER_BYTES);\n  var view = new DataView(byteArray);\n  view.setUint32(0, sequenceNumber, /* littleEndian */false);\n  return new Uint8Array(byteArray);\n}\nfunction generateAssociationKeypair() {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return crypto.subtle.generateKey({\n              name: 'ECDSA',\n              namedCurve: 'P-256'\n            }, false /* extractable */, ['sign'] /* keyUsages */);\n          case 2:\n            return _context2.abrupt(\"return\", _context2.sent);\n          case 3:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n}\nfunction generateECDHKeypair() {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n    return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            _context3.next = 2;\n            return crypto.subtle.generateKey({\n              name: 'ECDH',\n              namedCurve: 'P-256'\n            }, false /* extractable */, ['deriveKey', 'deriveBits'] /* keyUsages */);\n          case 2:\n            return _context3.abrupt(\"return\", _context3.sent);\n          case 3:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n}\nvar INITIALIZATION_VECTOR_BYTES = 12;\nfunction encryptJsonRpcMessage(jsonRpcMessage, sharedSecret) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n    var plaintext, sequenceNumberVector, initializationVector, ciphertext, response;\n    return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            plaintext = JSON.stringify(jsonRpcMessage);\n            sequenceNumberVector = createSequenceNumberVector(jsonRpcMessage.id);\n            initializationVector = new Uint8Array(INITIALIZATION_VECTOR_BYTES);\n            crypto.getRandomValues(initializationVector);\n            _context4.next = 6;\n            return crypto.subtle.encrypt(getAlgorithmParams(sequenceNumberVector, initializationVector), sharedSecret, new TextEncoder().encode(plaintext));\n          case 6:\n            ciphertext = _context4.sent;\n            response = new Uint8Array(sequenceNumberVector.byteLength + initializationVector.byteLength + ciphertext.byteLength);\n            response.set(new Uint8Array(sequenceNumberVector), 0);\n            response.set(new Uint8Array(initializationVector), sequenceNumberVector.byteLength);\n            response.set(new Uint8Array(ciphertext), sequenceNumberVector.byteLength + initializationVector.byteLength);\n            return _context4.abrupt(\"return\", response);\n          case 12:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n}\nfunction decryptJsonRpcMessage(message, sharedSecret) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n    var sequenceNumberVector, initializationVector, ciphertext, plaintextBuffer, plaintext, jsonRpcMessage;\n    return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n      while (1) {\n        switch (_context5.prev = _context5.next) {\n          case 0:\n            sequenceNumberVector = message.slice(0, SEQUENCE_NUMBER_BYTES);\n            initializationVector = message.slice(SEQUENCE_NUMBER_BYTES, SEQUENCE_NUMBER_BYTES + INITIALIZATION_VECTOR_BYTES);\n            ciphertext = message.slice(SEQUENCE_NUMBER_BYTES + INITIALIZATION_VECTOR_BYTES);\n            _context5.next = 5;\n            return crypto.subtle.decrypt(getAlgorithmParams(sequenceNumberVector, initializationVector), sharedSecret, ciphertext);\n          case 5:\n            plaintextBuffer = _context5.sent;\n            plaintext = getUtf8Decoder().decode(plaintextBuffer);\n            jsonRpcMessage = JSON.parse(plaintext);\n            if (!Object.hasOwnProperty.call(jsonRpcMessage, 'error')) {\n              _context5.next = 10;\n              break;\n            }\n            throw new SolanaMobileWalletAdapterProtocolError(jsonRpcMessage.id, jsonRpcMessage.error.code, jsonRpcMessage.error.message);\n          case 10:\n            return _context5.abrupt(\"return\", jsonRpcMessage);\n          case 11:\n          case \"end\":\n            return _context5.stop();\n        }\n      }\n    }, _callee5);\n  }));\n}\nfunction getAlgorithmParams(sequenceNumber, initializationVector) {\n  return {\n    additionalData: sequenceNumber,\n    iv: initializationVector,\n    name: 'AES-GCM',\n    tagLength: 128 // 16 byte tag => 128 bits\n  };\n}\n\nvar _utf8Decoder;\nfunction getUtf8Decoder() {\n  if (_utf8Decoder === undefined) {\n    _utf8Decoder = new TextDecoder('utf-8');\n  }\n  return _utf8Decoder;\n}\nfunction parseHelloRsp(payloadBuffer,\n// The X9.62-encoded wallet endpoint ephemeral ECDH public keypoint.\nassociationPublicKey, ecdhPrivateKey) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n    var _yield$Promise$all, _yield$Promise$all2, associationPublicKeyBuffer, walletPublicKey, sharedSecret, ecdhSecretKey, aesKeyMaterialVal;\n    return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.next = 2;\n            return Promise.all([crypto.subtle.exportKey('raw', associationPublicKey), crypto.subtle.importKey('raw', payloadBuffer, {\n              name: 'ECDH',\n              namedCurve: 'P-256'\n            }, false /* extractable */, [] /* keyUsages */)]);\n          case 2:\n            _yield$Promise$all = _context6.sent;\n            _yield$Promise$all2 = _slicedToArray(_yield$Promise$all, 2);\n            associationPublicKeyBuffer = _yield$Promise$all2[0];\n            walletPublicKey = _yield$Promise$all2[1];\n            _context6.next = 8;\n            return crypto.subtle.deriveBits({\n              name: 'ECDH',\n              public: walletPublicKey\n            }, ecdhPrivateKey, 256);\n          case 8:\n            sharedSecret = _context6.sent;\n            _context6.next = 11;\n            return crypto.subtle.importKey('raw', sharedSecret, 'HKDF', false /* extractable */, ['deriveKey'] /* keyUsages */);\n          case 11:\n            ecdhSecretKey = _context6.sent;\n            _context6.next = 14;\n            return crypto.subtle.deriveKey({\n              name: 'HKDF',\n              hash: 'SHA-256',\n              salt: new Uint8Array(associationPublicKeyBuffer),\n              info: new Uint8Array()\n            }, ecdhSecretKey, {\n              name: 'AES-GCM',\n              length: 128\n            }, false /* extractable */, ['encrypt', 'decrypt']);\n          case 14:\n            aesKeyMaterialVal = _context6.sent;\n            return _context6.abrupt(\"return\", aesKeyMaterialVal);\n          case 16:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n}\nfunction getRandomAssociationPort() {\n  return assertAssociationPort(49152 + Math.floor(Math.random() * (65535 - 49152 + 1)));\n}\nfunction assertAssociationPort(port) {\n  if (port < 49152 || port > 65535) {\n    throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_ASSOCIATION_PORT_OUT_OF_RANGE, \"Association port number must be between 49152 and 65535. \".concat(port, \" given.\"), {\n      port: port\n    });\n  }\n  return port;\n}\n\n// https://stackoverflow.com/a/9458996/802047\nfunction arrayBufferToBase64String(buffer) {\n  var binary = '';\n  var bytes = new Uint8Array(buffer);\n  var len = bytes.byteLength;\n  for (var ii = 0; ii < len; ii++) {\n    binary += String.fromCharCode(bytes[ii]);\n  }\n  return window.btoa(binary);\n}\nfunction getStringWithURLUnsafeCharactersReplaced(unsafeBase64EncodedString) {\n  return unsafeBase64EncodedString.replace(/[/+=]/g, function (m) {\n    return {\n      '/': '_',\n      '+': '-',\n      '=': '.'\n    }[m];\n  });\n}\nvar INTENT_NAME = 'solana-wallet';\nfunction getPathParts(pathString) {\n  return pathString\n  // Strip leading and trailing slashes\n  .replace(/(^\\/+|\\/+$)/g, '')\n  // Return an array of directories\n  .split('/');\n}\nfunction getIntentURL(methodPathname, intentUrlBase) {\n  var baseUrl = null;\n  if (intentUrlBase) {\n    try {\n      baseUrl = new URL(intentUrlBase);\n    } catch (_a) {} // eslint-disable-line no-empty\n    if ((baseUrl === null || baseUrl === void 0 ? void 0 : baseUrl.protocol) !== 'https:') {\n      throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_FORBIDDEN_WALLET_BASE_URL, 'Base URLs supplied by wallets must be valid `https` URLs');\n    }\n  }\n  baseUrl || (baseUrl = new URL(\"\".concat(INTENT_NAME, \":/\")));\n  var pathname = methodPathname.startsWith('/') ?\n  // Method is an absolute path. Replace it wholesale.\n  methodPathname :\n  // Method is a relative path. Merge it with the existing one.\n  [].concat(_toConsumableArray(getPathParts(baseUrl.pathname)), _toConsumableArray(getPathParts(methodPathname))).join('/');\n  return new URL(pathname, baseUrl);\n}\nfunction getAssociateAndroidIntentURL(associationPublicKey, putativePort, associationURLBase) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n    var associationPort, exportedKey, encodedKey, url;\n    return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            associationPort = assertAssociationPort(putativePort);\n            _context7.next = 3;\n            return crypto.subtle.exportKey('raw', associationPublicKey);\n          case 3:\n            exportedKey = _context7.sent;\n            encodedKey = arrayBufferToBase64String(exportedKey);\n            url = getIntentURL('v1/associate/local', associationURLBase);\n            url.searchParams.set('association', getStringWithURLUnsafeCharactersReplaced(encodedKey));\n            url.searchParams.set('port', \"\".concat(associationPort));\n            return _context7.abrupt(\"return\", url);\n          case 9:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7);\n  }));\n}\n\n// Typescript `enums` thwart tree-shaking. See https://bargsten.org/jsts/enums/\nvar Browser = {\n  Firefox: 0,\n  Other: 1\n};\nfunction assertUnreachable(x) {\n  return x;\n}\nfunction getBrowser() {\n  return navigator.userAgent.indexOf('Firefox/') !== -1 ? Browser.Firefox : Browser.Other;\n}\nfunction getDetectionPromise() {\n  // Chrome and others silently fail if a custom protocol is not supported.\n  // For these, we wait to see if the browser is navigated away from in\n  // a reasonable amount of time (ie. the native wallet opened).\n  return new Promise(function (resolve, reject) {\n    function cleanup() {\n      clearTimeout(timeoutId);\n      window.removeEventListener('blur', handleBlur);\n    }\n    function handleBlur() {\n      cleanup();\n      resolve();\n    }\n    window.addEventListener('blur', handleBlur);\n    var timeoutId = setTimeout(function () {\n      cleanup();\n      reject();\n    }, 2000);\n  });\n}\nvar _frame = null;\nfunction launchUrlThroughHiddenFrame(url) {\n  if (_frame == null) {\n    _frame = document.createElement('iframe');\n    _frame.style.display = 'none';\n    document.body.appendChild(_frame);\n  }\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  _frame.contentWindow.location.href = url.toString();\n}\nfunction startSession(associationPublicKey, associationURLBase) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n    var randomAssociationPort, associationUrl, browser, detectionPromise;\n    return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n      while (1) {\n        switch (_context8.prev = _context8.next) {\n          case 0:\n            randomAssociationPort = getRandomAssociationPort();\n            _context8.next = 3;\n            return getAssociateAndroidIntentURL(associationPublicKey, randomAssociationPort, associationURLBase);\n          case 3:\n            associationUrl = _context8.sent;\n            if (!(associationUrl.protocol === 'https:')) {\n              _context8.next = 8;\n              break;\n            }\n            // The association URL is an Android 'App Link' or iOS 'Universal Link'.\n            // These are regular web URLs that are designed to launch an app if it\n            // is installed or load the actual target webpage if not.\n            window.location.assign(associationUrl);\n            _context8.next = 26;\n            break;\n          case 8:\n            _context8.prev = 8;\n            browser = getBrowser();\n            _context8.t0 = browser;\n            _context8.next = _context8.t0 === Browser.Firefox ? 13 : _context8.t0 === Browser.Other ? 15 : 20;\n            break;\n          case 13:\n            // If a custom protocol is not supported in Firefox, it throws.\n            launchUrlThroughHiddenFrame(associationUrl);\n            // If we reached this line, it's supported.\n            return _context8.abrupt(\"break\", 21);\n          case 15:\n            detectionPromise = getDetectionPromise();\n            window.location.assign(associationUrl);\n            _context8.next = 19;\n            return detectionPromise;\n          case 19:\n            return _context8.abrupt(\"break\", 21);\n          case 20:\n            assertUnreachable(browser);\n          case 21:\n            _context8.next = 26;\n            break;\n          case 23:\n            _context8.prev = 23;\n            _context8.t1 = _context8[\"catch\"](8);\n            throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_WALLET_NOT_FOUND, 'Found no installed wallet that supports the mobile wallet protocol.');\n          case 26:\n            return _context8.abrupt(\"return\", randomAssociationPort);\n          case 27:\n          case \"end\":\n            return _context8.stop();\n        }\n      }\n    }, _callee8, null, [[8, 23]]);\n  }));\n}\nvar WEBSOCKET_CONNECTION_CONFIG = {\n  /**\n   * 300 milliseconds is a generally accepted threshold for what someone\n   * would consider an acceptable response time for a user interface\n   * after having performed a low-attention tapping task. We set the initial\n   * interval at which we wait for the wallet to set up the websocket at\n   * half this, as per the Nyquist frequency, with a progressive backoff\n   * sequence from there. The total wait time is 30s, which allows for the\n   * user to be presented with a disambiguation dialog, select a wallet, and\n   * for the wallet app to subsequently start.\n   */\n  retryDelayScheduleMs: [150, 150, 200, 500, 500, 750, 750, 1000],\n  timeoutMs: 30000\n};\nvar WEBSOCKET_PROTOCOL = 'com.solana.mobilewalletadapter.v1';\nfunction assertSecureContext() {\n  if (typeof window === 'undefined' || window.isSecureContext !== true) {\n    throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_SECURE_CONTEXT_REQUIRED, 'The mobile wallet adapter protocol must be used in a secure context (`https`).');\n  }\n}\nfunction assertSecureEndpointSpecificURI(walletUriBase) {\n  var url;\n  try {\n    url = new URL(walletUriBase);\n  } catch (_a) {\n    throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_FORBIDDEN_WALLET_BASE_URL, 'Invalid base URL supplied by wallet');\n  }\n  if (url.protocol !== 'https:') {\n    throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_FORBIDDEN_WALLET_BASE_URL, 'Base URLs supplied by wallets must be valid `https` URLs');\n  }\n}\nfunction getSequenceNumberFromByteArray(byteArray) {\n  var view = new DataView(byteArray);\n  return view.getUint32(0, /* littleEndian */false);\n}\nfunction transact(callback, config) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee13() {\n    var _this3 = this;\n    var associationKeypair, sessionPort, websocketURL, connectionStartTime, getNextRetryDelayMs, nextJsonRpcMessageId, lastKnownInboundSequenceNumber, state;\n    return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n      while (1) {\n        switch (_context13.prev = _context13.next) {\n          case 0:\n            assertSecureContext();\n            _context13.next = 3;\n            return generateAssociationKeypair();\n          case 3:\n            associationKeypair = _context13.sent;\n            _context13.next = 6;\n            return startSession(associationKeypair.publicKey, config === null || config === void 0 ? void 0 : config.baseUri);\n          case 6:\n            sessionPort = _context13.sent;\n            websocketURL = \"ws://localhost:\".concat(sessionPort, \"/solana-wallet\");\n            getNextRetryDelayMs = function () {\n              var schedule = _toConsumableArray(WEBSOCKET_CONNECTION_CONFIG.retryDelayScheduleMs);\n              return function () {\n                return schedule.length > 1 ? schedule.shift() : schedule[0];\n              };\n            }();\n            nextJsonRpcMessageId = 1;\n            lastKnownInboundSequenceNumber = 0;\n            state = {\n              __type: 'disconnected'\n            };\n            return _context13.abrupt(\"return\", new Promise(function (resolve, reject) {\n              var socket;\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              var jsonRpcResponsePromises = {};\n              var handleOpen = function handleOpen() {\n                return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n                  var _state, associationKeypair, ecdhKeypair;\n                  return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n                    while (1) {\n                      switch (_context9.prev = _context9.next) {\n                        case 0:\n                          if (!(state.__type !== 'connecting')) {\n                            _context9.next = 3;\n                            break;\n                          }\n                          console.warn('Expected adapter state to be `connecting` at the moment the websocket opens. ' + \"Got `\".concat(state.__type, \"`.\"));\n                          return _context9.abrupt(\"return\");\n                        case 3:\n                          _state = state, associationKeypair = _state.associationKeypair;\n                          socket.removeEventListener('open', handleOpen);\n                          _context9.next = 7;\n                          return generateECDHKeypair();\n                        case 7:\n                          ecdhKeypair = _context9.sent;\n                          _context9.t0 = socket;\n                          _context9.next = 11;\n                          return createHelloReq(ecdhKeypair.publicKey, associationKeypair.privateKey);\n                        case 11:\n                          _context9.t1 = _context9.sent;\n                          _context9.t0.send.call(_context9.t0, _context9.t1);\n                          state = {\n                            __type: 'hello_req_sent',\n                            associationPublicKey: associationKeypair.publicKey,\n                            ecdhPrivateKey: ecdhKeypair.privateKey\n                          };\n                        case 14:\n                        case \"end\":\n                          return _context9.stop();\n                      }\n                    }\n                  }, _callee9);\n                }));\n              };\n              var handleClose = function handleClose(evt) {\n                if (evt.wasClean) {\n                  state = {\n                    __type: 'disconnected'\n                  };\n                } else {\n                  reject(new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_SESSION_CLOSED, \"The wallet session dropped unexpectedly (\".concat(evt.code, \": \").concat(evt.reason, \").\"), {\n                    closeEvent: evt\n                  }));\n                }\n                disposeSocket();\n              };\n              var handleError = function handleError(_evt) {\n                return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {\n                  return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n                    while (1) {\n                      switch (_context10.prev = _context10.next) {\n                        case 0:\n                          disposeSocket();\n                          if (!(Date.now() - connectionStartTime >= WEBSOCKET_CONNECTION_CONFIG.timeoutMs)) {\n                            _context10.next = 5;\n                            break;\n                          }\n                          reject(new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_SESSION_TIMEOUT, \"Failed to connect to the wallet websocket on port \".concat(sessionPort, \".\")));\n                          _context10.next = 8;\n                          break;\n                        case 5:\n                          _context10.next = 7;\n                          return new Promise(function (resolve) {\n                            var retryDelayMs = getNextRetryDelayMs();\n                            retryWaitTimeoutId = window.setTimeout(resolve, retryDelayMs);\n                          });\n                        case 7:\n                          attemptSocketConnection();\n                        case 8:\n                        case \"end\":\n                          return _context10.stop();\n                      }\n                    }\n                  }, _callee10);\n                }));\n              };\n              var handleMessage = function handleMessage(evt) {\n                return __awaiter(_this3, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee12() {\n                  var responseBuffer, sequenceNumberVector, sequenceNumber, jsonRpcMessage, responsePromise, _responsePromise, sharedSecret, wallet;\n                  return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n                    while (1) {\n                      switch (_context12.prev = _context12.next) {\n                        case 0:\n                          _context12.next = 2;\n                          return evt.data.arrayBuffer();\n                        case 2:\n                          responseBuffer = _context12.sent;\n                          _context12.t0 = state.__type;\n                          _context12.next = _context12.t0 === 'connected' ? 6 : _context12.t0 === 'hello_req_sent' ? 30 : 51;\n                          break;\n                        case 6:\n                          _context12.prev = 6;\n                          sequenceNumberVector = responseBuffer.slice(0, SEQUENCE_NUMBER_BYTES);\n                          sequenceNumber = getSequenceNumberFromByteArray(sequenceNumberVector);\n                          if (!(sequenceNumber !== lastKnownInboundSequenceNumber + 1)) {\n                            _context12.next = 11;\n                            break;\n                          }\n                          throw new Error('Encrypted message has invalid sequence number');\n                        case 11:\n                          lastKnownInboundSequenceNumber = sequenceNumber;\n                          _context12.next = 14;\n                          return decryptJsonRpcMessage(responseBuffer, state.sharedSecret);\n                        case 14:\n                          jsonRpcMessage = _context12.sent;\n                          responsePromise = jsonRpcResponsePromises[jsonRpcMessage.id];\n                          delete jsonRpcResponsePromises[jsonRpcMessage.id];\n                          responsePromise.resolve(jsonRpcMessage.result);\n                          _context12.next = 29;\n                          break;\n                        case 20:\n                          _context12.prev = 20;\n                          _context12.t1 = _context12[\"catch\"](6);\n                          if (!(_context12.t1 instanceof SolanaMobileWalletAdapterProtocolError)) {\n                            _context12.next = 28;\n                            break;\n                          }\n                          _responsePromise = jsonRpcResponsePromises[_context12.t1.jsonRpcMessageId];\n                          delete jsonRpcResponsePromises[_context12.t1.jsonRpcMessageId];\n                          _responsePromise.reject(_context12.t1);\n                          _context12.next = 29;\n                          break;\n                        case 28:\n                          throw _context12.t1;\n                        case 29:\n                          return _context12.abrupt(\"break\", 51);\n                        case 30:\n                          _context12.next = 32;\n                          return parseHelloRsp(responseBuffer, state.associationPublicKey, state.ecdhPrivateKey);\n                        case 32:\n                          sharedSecret = _context12.sent;\n                          state = {\n                            __type: 'connected',\n                            sharedSecret: sharedSecret\n                          };\n                          wallet = new Proxy({}, {\n                            get: function get(target, p) {\n                              if (target[p] == null) {\n                                var method = p.toString().replace(/[A-Z]/g, function (letter) {\n                                  return \"_\".concat(letter.toLowerCase());\n                                }).toLowerCase();\n                                target[p] = function (params) {\n                                  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {\n                                    var id;\n                                    return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n                                      while (1) {\n                                        switch (_context11.prev = _context11.next) {\n                                          case 0:\n                                            id = nextJsonRpcMessageId++;\n                                            _context11.t0 = socket;\n                                            _context11.next = 4;\n                                            return encryptJsonRpcMessage({\n                                              id: id,\n                                              jsonrpc: '2.0',\n                                              method: method,\n                                              params: params !== null && params !== void 0 ? params : {}\n                                            }, sharedSecret);\n                                          case 4:\n                                            _context11.t1 = _context11.sent;\n                                            _context11.t0.send.call(_context11.t0, _context11.t1);\n                                            return _context11.abrupt(\"return\", new Promise(function (_resolve, reject) {\n                                              jsonRpcResponsePromises[id] = {\n                                                resolve: function resolve(result) {\n                                                  switch (p) {\n                                                    case 'authorize':\n                                                    case 'reauthorize':\n                                                      {\n                                                        var wallet_uri_base = result.wallet_uri_base;\n                                                        if (wallet_uri_base != null) {\n                                                          try {\n                                                            assertSecureEndpointSpecificURI(wallet_uri_base);\n                                                          } catch (e) {\n                                                            reject(e);\n                                                            return;\n                                                          }\n                                                        }\n                                                        break;\n                                                      }\n                                                  }\n                                                  _resolve(result);\n                                                },\n                                                reject: reject\n                                              };\n                                            }));\n                                          case 7:\n                                          case \"end\":\n                                            return _context11.stop();\n                                        }\n                                      }\n                                    }, _callee11);\n                                  }));\n                                };\n                              }\n                              return target[p];\n                            },\n                            defineProperty: function defineProperty() {\n                              return false;\n                            },\n                            deleteProperty: function deleteProperty() {\n                              return false;\n                            }\n                          });\n                          _context12.prev = 35;\n                          _context12.t2 = resolve;\n                          _context12.next = 39;\n                          return callback(wallet);\n                        case 39:\n                          _context12.t3 = _context12.sent;\n                          (0, _context12.t2)(_context12.t3);\n                          _context12.next = 46;\n                          break;\n                        case 43:\n                          _context12.prev = 43;\n                          _context12.t4 = _context12[\"catch\"](35);\n                          reject(_context12.t4);\n                        case 46:\n                          _context12.prev = 46;\n                          disposeSocket();\n                          socket.close();\n                          return _context12.finish(46);\n                        case 50:\n                          return _context12.abrupt(\"break\", 51);\n                        case 51:\n                        case \"end\":\n                          return _context12.stop();\n                      }\n                    }\n                  }, _callee12, null, [[6, 20], [35, 43, 46, 50]]);\n                }));\n              };\n              var disposeSocket;\n              var retryWaitTimeoutId;\n              var attemptSocketConnection = function attemptSocketConnection() {\n                if (disposeSocket) {\n                  disposeSocket();\n                }\n                state = {\n                  __type: 'connecting',\n                  associationKeypair: associationKeypair\n                };\n                if (connectionStartTime === undefined) {\n                  connectionStartTime = Date.now();\n                }\n                socket = new WebSocket(websocketURL, [WEBSOCKET_PROTOCOL]);\n                socket.addEventListener('open', handleOpen);\n                socket.addEventListener('close', handleClose);\n                socket.addEventListener('error', handleError);\n                socket.addEventListener('message', handleMessage);\n                disposeSocket = function disposeSocket() {\n                  window.clearTimeout(retryWaitTimeoutId);\n                  socket.removeEventListener('open', handleOpen);\n                  socket.removeEventListener('close', handleClose);\n                  socket.removeEventListener('error', handleError);\n                  socket.removeEventListener('message', handleMessage);\n                };\n              };\n              attemptSocketConnection();\n            }));\n          case 13:\n          case \"end\":\n            return _context13.stop();\n        }\n      }\n    }, _callee13);\n  }));\n}\nexport { SolanaMobileWalletAdapterError, SolanaMobileWalletAdapterErrorCode, SolanaMobileWalletAdapterProtocolError, SolanaMobileWalletAdapterProtocolErrorCode, transact };","map":{"version":3,"names":["SolanaMobileWalletAdapterErrorCode","ERROR_ASSOCIATION_PORT_OUT_OF_RANGE","ERROR_FORBIDDEN_WALLET_BASE_URL","ERROR_SECURE_CONTEXT_REQUIRED","ERROR_SESSION_CLOSED","ERROR_SESSION_TIMEOUT","ERROR_WALLET_NOT_FOUND","SolanaMobileWalletAdapterError","args","code","message","data","name","Error","SolanaMobileWalletAdapterProtocolErrorCode","ERROR_AUTHORIZATION_FAILED","ERROR_INVALID_PAYLOADS","ERROR_NOT_SIGNED","ERROR_NOT_SUBMITTED","ERROR_TOO_MANY_PAYLOADS","ERROR_ATTEST_ORIGIN_ANDROID","SolanaMobileWalletAdapterProtocolError","jsonRpcMessageId","__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","createHelloReq","ecdhPublicKey","associationKeypairPrivateKey","crypto","subtle","exportKey","publicKeyBuffer","sign","hash","signatureBuffer","response","Uint8Array","byteLength","set","SEQUENCE_NUMBER_BYTES","createSequenceNumberVector","sequenceNumber","byteArray","ArrayBuffer","view","DataView","setUint32","generateAssociationKeypair","generateKey","namedCurve","generateECDHKeypair","INITIALIZATION_VECTOR_BYTES","encryptJsonRpcMessage","jsonRpcMessage","sharedSecret","plaintext","JSON","stringify","sequenceNumberVector","id","initializationVector","getRandomValues","encrypt","getAlgorithmParams","TextEncoder","encode","ciphertext","decryptJsonRpcMessage","slice","decrypt","plaintextBuffer","getUtf8Decoder","decode","parse","Object","hasOwnProperty","call","error","additionalData","iv","tagLength","_utf8Decoder","undefined","TextDecoder","parseHelloRsp","payloadBuffer","associationPublicKey","ecdhPrivateKey","all","importKey","associationPublicKeyBuffer","walletPublicKey","deriveBits","public","ecdhSecretKey","deriveKey","salt","info","length","aesKeyMaterialVal","getRandomAssociationPort","assertAssociationPort","Math","floor","random","port","arrayBufferToBase64String","buffer","binary","bytes","len","ii","String","fromCharCode","window","btoa","getStringWithURLUnsafeCharactersReplaced","unsafeBase64EncodedString","replace","m","INTENT_NAME","getPathParts","pathString","split","getIntentURL","methodPathname","intentUrlBase","baseUrl","URL","_a","protocol","pathname","startsWith","join","getAssociateAndroidIntentURL","putativePort","associationURLBase","associationPort","exportedKey","encodedKey","url","searchParams","Browser","Firefox","Other","assertUnreachable","x","getBrowser","navigator","userAgent","indexOf","getDetectionPromise","cleanup","clearTimeout","timeoutId","removeEventListener","handleBlur","addEventListener","setTimeout","_frame","launchUrlThroughHiddenFrame","document","createElement","style","display","body","appendChild","contentWindow","location","href","toString","startSession","randomAssociationPort","associationUrl","assign","browser","detectionPromise","WEBSOCKET_CONNECTION_CONFIG","retryDelayScheduleMs","timeoutMs","WEBSOCKET_PROTOCOL","assertSecureContext","isSecureContext","assertSecureEndpointSpecificURI","walletUriBase","getSequenceNumberFromByteArray","getUint32","transact","callback","config","associationKeypair","publicKey","baseUri","sessionPort","websocketURL","getNextRetryDelayMs","schedule","shift","nextJsonRpcMessageId","lastKnownInboundSequenceNumber","state","__type","socket","jsonRpcResponsePromises","handleOpen","console","warn","ecdhKeypair","privateKey","send","handleClose","evt","wasClean","reason","closeEvent","disposeSocket","handleError","_evt","Date","now","connectionStartTime","retryDelayMs","retryWaitTimeoutId","attemptSocketConnection","handleMessage","arrayBuffer","responseBuffer","responsePromise","wallet","Proxy","get","target","p","method","letter","toLowerCase","params","jsonrpc","wallet_uri_base","defineProperty","deleteProperty","close","WebSocket"],"sources":["/Users/ivan/Metadata/node_modules/@solana-mobile/mobile-wallet-adapter-protocol-web3js/node_modules/@solana-mobile/mobile-wallet-adapter-protocol/lib/esm/index.js"],"sourcesContent":["// Typescript `enums` thwart tree-shaking. See https://bargsten.org/jsts/enums/\nconst SolanaMobileWalletAdapterErrorCode = {\n    ERROR_ASSOCIATION_PORT_OUT_OF_RANGE: 'ERROR_ASSOCIATION_PORT_OUT_OF_RANGE',\n    ERROR_FORBIDDEN_WALLET_BASE_URL: 'ERROR_FORBIDDEN_WALLET_BASE_URL',\n    ERROR_SECURE_CONTEXT_REQUIRED: 'ERROR_SECURE_CONTEXT_REQUIRED',\n    ERROR_SESSION_CLOSED: 'ERROR_SESSION_CLOSED',\n    ERROR_SESSION_TIMEOUT: 'ERROR_SESSION_TIMEOUT',\n    ERROR_WALLET_NOT_FOUND: 'ERROR_WALLET_NOT_FOUND',\n};\nclass SolanaMobileWalletAdapterError extends Error {\n    constructor(...args) {\n        const [code, message, data] = args;\n        super(message);\n        this.code = code;\n        this.data = data;\n        this.name = 'SolanaMobileWalletAdapterError';\n    }\n}\n// Typescript `enums` thwart tree-shaking. See https://bargsten.org/jsts/enums/\nconst SolanaMobileWalletAdapterProtocolErrorCode = {\n    // Keep these in sync with `mobilewalletadapter/common/ProtocolContract.java`.\n    ERROR_AUTHORIZATION_FAILED: -1,\n    ERROR_INVALID_PAYLOADS: -2,\n    ERROR_NOT_SIGNED: -3,\n    ERROR_NOT_SUBMITTED: -4,\n    ERROR_TOO_MANY_PAYLOADS: -5,\n    ERROR_ATTEST_ORIGIN_ANDROID: -100,\n};\nclass SolanaMobileWalletAdapterProtocolError extends Error {\n    constructor(...args) {\n        const [jsonRpcMessageId, code, message, data] = args;\n        super(message);\n        this.code = code;\n        this.data = data;\n        this.jsonRpcMessageId = jsonRpcMessageId;\n        this.name = 'SolanaMobileWalletAdapterProtocolError';\n    }\n}\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nfunction createHelloReq(ecdhPublicKey, associationKeypairPrivateKey) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const publicKeyBuffer = yield crypto.subtle.exportKey('raw', ecdhPublicKey);\n        const signatureBuffer = yield crypto.subtle.sign({ hash: 'SHA-256', name: 'ECDSA' }, associationKeypairPrivateKey, publicKeyBuffer);\n        const response = new Uint8Array(publicKeyBuffer.byteLength + signatureBuffer.byteLength);\n        response.set(new Uint8Array(publicKeyBuffer), 0);\n        response.set(new Uint8Array(signatureBuffer), publicKeyBuffer.byteLength);\n        return response;\n    });\n}\n\nconst SEQUENCE_NUMBER_BYTES = 4;\nfunction createSequenceNumberVector(sequenceNumber) {\n    if (sequenceNumber >= 4294967296) {\n        throw new Error('Outbound sequence number overflow. The maximum sequence number is 32-bytes.');\n    }\n    const byteArray = new ArrayBuffer(SEQUENCE_NUMBER_BYTES);\n    const view = new DataView(byteArray);\n    view.setUint32(0, sequenceNumber, /* littleEndian */ false);\n    return new Uint8Array(byteArray);\n}\n\nfunction generateAssociationKeypair() {\n    return __awaiter(this, void 0, void 0, function* () {\n        return yield crypto.subtle.generateKey({\n            name: 'ECDSA',\n            namedCurve: 'P-256',\n        }, false /* extractable */, ['sign'] /* keyUsages */);\n    });\n}\n\nfunction generateECDHKeypair() {\n    return __awaiter(this, void 0, void 0, function* () {\n        return yield crypto.subtle.generateKey({\n            name: 'ECDH',\n            namedCurve: 'P-256',\n        }, false /* extractable */, ['deriveKey', 'deriveBits'] /* keyUsages */);\n    });\n}\n\nconst INITIALIZATION_VECTOR_BYTES = 12;\nfunction encryptJsonRpcMessage(jsonRpcMessage, sharedSecret) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const plaintext = JSON.stringify(jsonRpcMessage);\n        const sequenceNumberVector = createSequenceNumberVector(jsonRpcMessage.id);\n        const initializationVector = new Uint8Array(INITIALIZATION_VECTOR_BYTES);\n        crypto.getRandomValues(initializationVector);\n        const ciphertext = yield crypto.subtle.encrypt(getAlgorithmParams(sequenceNumberVector, initializationVector), sharedSecret, new TextEncoder().encode(plaintext));\n        const response = new Uint8Array(sequenceNumberVector.byteLength + initializationVector.byteLength + ciphertext.byteLength);\n        response.set(new Uint8Array(sequenceNumberVector), 0);\n        response.set(new Uint8Array(initializationVector), sequenceNumberVector.byteLength);\n        response.set(new Uint8Array(ciphertext), sequenceNumberVector.byteLength + initializationVector.byteLength);\n        return response;\n    });\n}\nfunction decryptJsonRpcMessage(message, sharedSecret) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const sequenceNumberVector = message.slice(0, SEQUENCE_NUMBER_BYTES);\n        const initializationVector = message.slice(SEQUENCE_NUMBER_BYTES, SEQUENCE_NUMBER_BYTES + INITIALIZATION_VECTOR_BYTES);\n        const ciphertext = message.slice(SEQUENCE_NUMBER_BYTES + INITIALIZATION_VECTOR_BYTES);\n        const plaintextBuffer = yield crypto.subtle.decrypt(getAlgorithmParams(sequenceNumberVector, initializationVector), sharedSecret, ciphertext);\n        const plaintext = getUtf8Decoder().decode(plaintextBuffer);\n        const jsonRpcMessage = JSON.parse(plaintext);\n        if (Object.hasOwnProperty.call(jsonRpcMessage, 'error')) {\n            throw new SolanaMobileWalletAdapterProtocolError(jsonRpcMessage.id, jsonRpcMessage.error.code, jsonRpcMessage.error.message);\n        }\n        return jsonRpcMessage;\n    });\n}\nfunction getAlgorithmParams(sequenceNumber, initializationVector) {\n    return {\n        additionalData: sequenceNumber,\n        iv: initializationVector,\n        name: 'AES-GCM',\n        tagLength: 128, // 16 byte tag => 128 bits\n    };\n}\nlet _utf8Decoder;\nfunction getUtf8Decoder() {\n    if (_utf8Decoder === undefined) {\n        _utf8Decoder = new TextDecoder('utf-8');\n    }\n    return _utf8Decoder;\n}\n\nfunction parseHelloRsp(payloadBuffer, // The X9.62-encoded wallet endpoint ephemeral ECDH public keypoint.\nassociationPublicKey, ecdhPrivateKey) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const [associationPublicKeyBuffer, walletPublicKey] = yield Promise.all([\n            crypto.subtle.exportKey('raw', associationPublicKey),\n            crypto.subtle.importKey('raw', payloadBuffer, { name: 'ECDH', namedCurve: 'P-256' }, false /* extractable */, [] /* keyUsages */),\n        ]);\n        const sharedSecret = yield crypto.subtle.deriveBits({ name: 'ECDH', public: walletPublicKey }, ecdhPrivateKey, 256);\n        const ecdhSecretKey = yield crypto.subtle.importKey('raw', sharedSecret, 'HKDF', false /* extractable */, ['deriveKey'] /* keyUsages */);\n        const aesKeyMaterialVal = yield crypto.subtle.deriveKey({\n            name: 'HKDF',\n            hash: 'SHA-256',\n            salt: new Uint8Array(associationPublicKeyBuffer),\n            info: new Uint8Array(),\n        }, ecdhSecretKey, { name: 'AES-GCM', length: 128 }, false /* extractable */, ['encrypt', 'decrypt']);\n        return aesKeyMaterialVal;\n    });\n}\n\nfunction getRandomAssociationPort() {\n    return assertAssociationPort(49152 + Math.floor(Math.random() * (65535 - 49152 + 1)));\n}\nfunction assertAssociationPort(port) {\n    if (port < 49152 || port > 65535) {\n        throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_ASSOCIATION_PORT_OUT_OF_RANGE, `Association port number must be between 49152 and 65535. ${port} given.`, { port });\n    }\n    return port;\n}\n\n// https://stackoverflow.com/a/9458996/802047\nfunction arrayBufferToBase64String(buffer) {\n    let binary = '';\n    const bytes = new Uint8Array(buffer);\n    const len = bytes.byteLength;\n    for (let ii = 0; ii < len; ii++) {\n        binary += String.fromCharCode(bytes[ii]);\n    }\n    return window.btoa(binary);\n}\n\nfunction getStringWithURLUnsafeCharactersReplaced(unsafeBase64EncodedString) {\n    return unsafeBase64EncodedString.replace(/[/+=]/g, (m) => ({\n        '/': '_',\n        '+': '-',\n        '=': '.',\n    }[m]));\n}\n\nconst INTENT_NAME = 'solana-wallet';\nfunction getPathParts(pathString) {\n    return (pathString\n        // Strip leading and trailing slashes\n        .replace(/(^\\/+|\\/+$)/g, '')\n        // Return an array of directories\n        .split('/'));\n}\nfunction getIntentURL(methodPathname, intentUrlBase) {\n    let baseUrl = null;\n    if (intentUrlBase) {\n        try {\n            baseUrl = new URL(intentUrlBase);\n        }\n        catch (_a) { } // eslint-disable-line no-empty\n        if ((baseUrl === null || baseUrl === void 0 ? void 0 : baseUrl.protocol) !== 'https:') {\n            throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_FORBIDDEN_WALLET_BASE_URL, 'Base URLs supplied by wallets must be valid `https` URLs');\n        }\n    }\n    baseUrl || (baseUrl = new URL(`${INTENT_NAME}:/`));\n    const pathname = methodPathname.startsWith('/')\n        ? // Method is an absolute path. Replace it wholesale.\n            methodPathname\n        : // Method is a relative path. Merge it with the existing one.\n            [...getPathParts(baseUrl.pathname), ...getPathParts(methodPathname)].join('/');\n    return new URL(pathname, baseUrl);\n}\nfunction getAssociateAndroidIntentURL(associationPublicKey, putativePort, associationURLBase) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const associationPort = assertAssociationPort(putativePort);\n        const exportedKey = yield crypto.subtle.exportKey('raw', associationPublicKey);\n        const encodedKey = arrayBufferToBase64String(exportedKey);\n        const url = getIntentURL('v1/associate/local', associationURLBase);\n        url.searchParams.set('association', getStringWithURLUnsafeCharactersReplaced(encodedKey));\n        url.searchParams.set('port', `${associationPort}`);\n        return url;\n    });\n}\n\n// Typescript `enums` thwart tree-shaking. See https://bargsten.org/jsts/enums/\nconst Browser = {\n    Firefox: 0,\n    Other: 1,\n};\nfunction assertUnreachable(x) {\n    return x;\n}\nfunction getBrowser() {\n    return navigator.userAgent.indexOf('Firefox/') !== -1 ? Browser.Firefox : Browser.Other;\n}\nfunction getDetectionPromise() {\n    // Chrome and others silently fail if a custom protocol is not supported.\n    // For these, we wait to see if the browser is navigated away from in\n    // a reasonable amount of time (ie. the native wallet opened).\n    return new Promise((resolve, reject) => {\n        function cleanup() {\n            clearTimeout(timeoutId);\n            window.removeEventListener('blur', handleBlur);\n        }\n        function handleBlur() {\n            cleanup();\n            resolve();\n        }\n        window.addEventListener('blur', handleBlur);\n        const timeoutId = setTimeout(() => {\n            cleanup();\n            reject();\n        }, 2000);\n    });\n}\nlet _frame = null;\nfunction launchUrlThroughHiddenFrame(url) {\n    if (_frame == null) {\n        _frame = document.createElement('iframe');\n        _frame.style.display = 'none';\n        document.body.appendChild(_frame);\n    }\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    _frame.contentWindow.location.href = url.toString();\n}\nfunction startSession(associationPublicKey, associationURLBase) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const randomAssociationPort = getRandomAssociationPort();\n        const associationUrl = yield getAssociateAndroidIntentURL(associationPublicKey, randomAssociationPort, associationURLBase);\n        if (associationUrl.protocol === 'https:') {\n            // The association URL is an Android 'App Link' or iOS 'Universal Link'.\n            // These are regular web URLs that are designed to launch an app if it\n            // is installed or load the actual target webpage if not.\n            window.location.assign(associationUrl);\n        }\n        else {\n            // The association URL has a custom protocol (eg. `solana-wallet:`)\n            try {\n                const browser = getBrowser();\n                switch (browser) {\n                    case Browser.Firefox:\n                        // If a custom protocol is not supported in Firefox, it throws.\n                        launchUrlThroughHiddenFrame(associationUrl);\n                        // If we reached this line, it's supported.\n                        break;\n                    case Browser.Other: {\n                        const detectionPromise = getDetectionPromise();\n                        window.location.assign(associationUrl);\n                        yield detectionPromise;\n                        break;\n                    }\n                    default:\n                        assertUnreachable(browser);\n                }\n            }\n            catch (e) {\n                throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_WALLET_NOT_FOUND, 'Found no installed wallet that supports the mobile wallet protocol.');\n            }\n        }\n        return randomAssociationPort;\n    });\n}\n\nconst WEBSOCKET_CONNECTION_CONFIG = {\n    /**\n     * 300 milliseconds is a generally accepted threshold for what someone\n     * would consider an acceptable response time for a user interface\n     * after having performed a low-attention tapping task. We set the initial\n     * interval at which we wait for the wallet to set up the websocket at\n     * half this, as per the Nyquist frequency, with a progressive backoff\n     * sequence from there. The total wait time is 30s, which allows for the\n     * user to be presented with a disambiguation dialog, select a wallet, and\n     * for the wallet app to subsequently start.\n     */\n    retryDelayScheduleMs: [150, 150, 200, 500, 500, 750, 750, 1000],\n    timeoutMs: 30000,\n};\nconst WEBSOCKET_PROTOCOL = 'com.solana.mobilewalletadapter.v1';\nfunction assertSecureContext() {\n    if (typeof window === 'undefined' || window.isSecureContext !== true) {\n        throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_SECURE_CONTEXT_REQUIRED, 'The mobile wallet adapter protocol must be used in a secure context (`https`).');\n    }\n}\nfunction assertSecureEndpointSpecificURI(walletUriBase) {\n    let url;\n    try {\n        url = new URL(walletUriBase);\n    }\n    catch (_a) {\n        throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_FORBIDDEN_WALLET_BASE_URL, 'Invalid base URL supplied by wallet');\n    }\n    if (url.protocol !== 'https:') {\n        throw new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_FORBIDDEN_WALLET_BASE_URL, 'Base URLs supplied by wallets must be valid `https` URLs');\n    }\n}\nfunction getSequenceNumberFromByteArray(byteArray) {\n    const view = new DataView(byteArray);\n    return view.getUint32(0, /* littleEndian */ false);\n}\nfunction transact(callback, config) {\n    return __awaiter(this, void 0, void 0, function* () {\n        assertSecureContext();\n        const associationKeypair = yield generateAssociationKeypair();\n        const sessionPort = yield startSession(associationKeypair.publicKey, config === null || config === void 0 ? void 0 : config.baseUri);\n        const websocketURL = `ws://localhost:${sessionPort}/solana-wallet`;\n        let connectionStartTime;\n        const getNextRetryDelayMs = (() => {\n            const schedule = [...WEBSOCKET_CONNECTION_CONFIG.retryDelayScheduleMs];\n            return () => (schedule.length > 1 ? schedule.shift() : schedule[0]);\n        })();\n        let nextJsonRpcMessageId = 1;\n        let lastKnownInboundSequenceNumber = 0;\n        let state = { __type: 'disconnected' };\n        return new Promise((resolve, reject) => {\n            let socket;\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const jsonRpcResponsePromises = {};\n            const handleOpen = () => __awaiter(this, void 0, void 0, function* () {\n                if (state.__type !== 'connecting') {\n                    console.warn('Expected adapter state to be `connecting` at the moment the websocket opens. ' +\n                        `Got \\`${state.__type}\\`.`);\n                    return;\n                }\n                const { associationKeypair } = state;\n                socket.removeEventListener('open', handleOpen);\n                const ecdhKeypair = yield generateECDHKeypair();\n                socket.send(yield createHelloReq(ecdhKeypair.publicKey, associationKeypair.privateKey));\n                state = {\n                    __type: 'hello_req_sent',\n                    associationPublicKey: associationKeypair.publicKey,\n                    ecdhPrivateKey: ecdhKeypair.privateKey,\n                };\n            });\n            const handleClose = (evt) => {\n                if (evt.wasClean) {\n                    state = { __type: 'disconnected' };\n                }\n                else {\n                    reject(new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_SESSION_CLOSED, `The wallet session dropped unexpectedly (${evt.code}: ${evt.reason}).`, { closeEvent: evt }));\n                }\n                disposeSocket();\n            };\n            const handleError = (_evt) => __awaiter(this, void 0, void 0, function* () {\n                disposeSocket();\n                if (Date.now() - connectionStartTime >= WEBSOCKET_CONNECTION_CONFIG.timeoutMs) {\n                    reject(new SolanaMobileWalletAdapterError(SolanaMobileWalletAdapterErrorCode.ERROR_SESSION_TIMEOUT, `Failed to connect to the wallet websocket on port ${sessionPort}.`));\n                }\n                else {\n                    yield new Promise((resolve) => {\n                        const retryDelayMs = getNextRetryDelayMs();\n                        retryWaitTimeoutId = window.setTimeout(resolve, retryDelayMs);\n                    });\n                    attemptSocketConnection();\n                }\n            });\n            const handleMessage = (evt) => __awaiter(this, void 0, void 0, function* () {\n                const responseBuffer = yield evt.data.arrayBuffer();\n                switch (state.__type) {\n                    case 'connected':\n                        try {\n                            const sequenceNumberVector = responseBuffer.slice(0, SEQUENCE_NUMBER_BYTES);\n                            const sequenceNumber = getSequenceNumberFromByteArray(sequenceNumberVector);\n                            if (sequenceNumber !== (lastKnownInboundSequenceNumber + 1)) {\n                                throw new Error('Encrypted message has invalid sequence number');\n                            }\n                            lastKnownInboundSequenceNumber = sequenceNumber;\n                            const jsonRpcMessage = yield decryptJsonRpcMessage(responseBuffer, state.sharedSecret);\n                            const responsePromise = jsonRpcResponsePromises[jsonRpcMessage.id];\n                            delete jsonRpcResponsePromises[jsonRpcMessage.id];\n                            responsePromise.resolve(jsonRpcMessage.result);\n                        }\n                        catch (e) {\n                            if (e instanceof SolanaMobileWalletAdapterProtocolError) {\n                                const responsePromise = jsonRpcResponsePromises[e.jsonRpcMessageId];\n                                delete jsonRpcResponsePromises[e.jsonRpcMessageId];\n                                responsePromise.reject(e);\n                            }\n                            else {\n                                throw e;\n                            }\n                        }\n                        break;\n                    case 'hello_req_sent': {\n                        const sharedSecret = yield parseHelloRsp(responseBuffer, state.associationPublicKey, state.ecdhPrivateKey);\n                        state = { __type: 'connected', sharedSecret };\n                        const wallet = new Proxy({}, {\n                            get(target, p) {\n                                if (target[p] == null) {\n                                    const method = p\n                                        .toString()\n                                        .replace(/[A-Z]/g, (letter) => `_${letter.toLowerCase()}`)\n                                        .toLowerCase();\n                                    target[p] = function (params) {\n                                        return __awaiter(this, void 0, void 0, function* () {\n                                            const id = nextJsonRpcMessageId++;\n                                            socket.send(yield encryptJsonRpcMessage({\n                                                id,\n                                                jsonrpc: '2.0',\n                                                method,\n                                                params: params !== null && params !== void 0 ? params : {},\n                                            }, sharedSecret));\n                                            return new Promise((resolve, reject) => {\n                                                jsonRpcResponsePromises[id] = {\n                                                    resolve(result) {\n                                                        switch (p) {\n                                                            case 'authorize':\n                                                            case 'reauthorize': {\n                                                                const { wallet_uri_base } = result;\n                                                                if (wallet_uri_base != null) {\n                                                                    try {\n                                                                        assertSecureEndpointSpecificURI(wallet_uri_base);\n                                                                    }\n                                                                    catch (e) {\n                                                                        reject(e);\n                                                                        return;\n                                                                    }\n                                                                }\n                                                                break;\n                                                            }\n                                                        }\n                                                        resolve(result);\n                                                    },\n                                                    reject,\n                                                };\n                                            });\n                                        });\n                                    };\n                                }\n                                return target[p];\n                            },\n                            defineProperty() {\n                                return false;\n                            },\n                            deleteProperty() {\n                                return false;\n                            },\n                        });\n                        try {\n                            resolve(yield callback(wallet));\n                        }\n                        catch (e) {\n                            reject(e);\n                        }\n                        finally {\n                            disposeSocket();\n                            socket.close();\n                        }\n                        break;\n                    }\n                }\n            });\n            let disposeSocket;\n            let retryWaitTimeoutId;\n            const attemptSocketConnection = () => {\n                if (disposeSocket) {\n                    disposeSocket();\n                }\n                state = { __type: 'connecting', associationKeypair };\n                if (connectionStartTime === undefined) {\n                    connectionStartTime = Date.now();\n                }\n                socket = new WebSocket(websocketURL, [WEBSOCKET_PROTOCOL]);\n                socket.addEventListener('open', handleOpen);\n                socket.addEventListener('close', handleClose);\n                socket.addEventListener('error', handleError);\n                socket.addEventListener('message', handleMessage);\n                disposeSocket = () => {\n                    window.clearTimeout(retryWaitTimeoutId);\n                    socket.removeEventListener('open', handleOpen);\n                    socket.removeEventListener('close', handleClose);\n                    socket.removeEventListener('error', handleError);\n                    socket.removeEventListener('message', handleMessage);\n                };\n            };\n            attemptSocketConnection();\n        });\n    });\n}\n\nexport { SolanaMobileWalletAdapterError, SolanaMobileWalletAdapterErrorCode, SolanaMobileWalletAdapterProtocolError, SolanaMobileWalletAdapterProtocolErrorCode, transact };\n"],"mappings":";;;;;;;;AAAA;AACA,IAAMA,kCAAkC,GAAG;EACvCC,mCAAmC,EAAE,qCAAqC;EAC1EC,+BAA+B,EAAE,iCAAiC;EAClEC,6BAA6B,EAAE,+BAA+B;EAC9DC,oBAAoB,EAAE,sBAAsB;EAC5CC,qBAAqB,EAAE,uBAAuB;EAC9CC,sBAAsB,EAAE;AAC5B,CAAC;AAAC,IACIC,8BAA8B;EAAA;EAAA;EAChC,0CAAqB;IAAA;IAAA;IAAA,kCAANC,IAAI;MAAJA,IAAI;IAAA;IACf,IAAOC,IAAI,GAAmBD,IAAI;MAArBE,OAAO,GAAUF,IAAI;MAAZG,IAAI,GAAIH,IAAI;IAClC,0BAAME,OAAO;IACb,MAAKD,IAAI,GAAGA,IAAI;IAChB,MAAKE,IAAI,GAAGA,IAAI;IAChB,MAAKC,IAAI,GAAG,gCAAgC;IAAC;EACjD;EAAC;AAAA,iCAPwCC,KAAK,IASlD;AACA,IAAMC,0CAA0C,GAAG;EAC/C;EACAC,0BAA0B,EAAE,CAAC,CAAC;EAC9BC,sBAAsB,EAAE,CAAC,CAAC;EAC1BC,gBAAgB,EAAE,CAAC,CAAC;EACpBC,mBAAmB,EAAE,CAAC,CAAC;EACvBC,uBAAuB,EAAE,CAAC,CAAC;EAC3BC,2BAA2B,EAAE,CAAC;AAClC,CAAC;AAAC,IACIC,sCAAsC;EAAA;EAAA;EACxC,kDAAqB;IAAA;IAAA;IAAA,mCAANb,IAAI;MAAJA,IAAI;IAAA;IACf,IAAOc,gBAAgB,GAAyBd,IAAI;MAA3BC,IAAI,GAAmBD,IAAI;MAArBE,OAAO,GAAUF,IAAI;MAAZG,IAAI,GAAIH,IAAI;IACpD,4BAAME,OAAO;IACb,OAAKD,IAAI,GAAGA,IAAI;IAChB,OAAKE,IAAI,GAAGA,IAAI;IAChB,OAAKW,gBAAgB,GAAGA,gBAAgB;IACxC,OAAKV,IAAI,GAAG,wCAAwC;IAAC;EACzD;EAAC;AAAA,iCARgDC,KAAK;AAW1D;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA,SAASU,SAAS,CAACC,OAAO,EAAEC,UAAU,EAAEC,CAAC,EAAEC,SAAS,EAAE;EAClD,SAASC,KAAK,CAACC,KAAK,EAAE;IAAE,OAAOA,KAAK,YAAYH,CAAC,GAAGG,KAAK,GAAG,IAAIH,CAAC,CAAC,UAAUI,OAAO,EAAE;MAAEA,OAAO,CAACD,KAAK,CAAC;IAAE,CAAC,CAAC;EAAE;EAC3G,OAAO,KAAKH,CAAC,KAAKA,CAAC,GAAGK,OAAO,CAAC,EAAE,UAAUD,OAAO,EAAEE,MAAM,EAAE;IACvD,SAASC,SAAS,CAACJ,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAACQ,IAAI,CAACN,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC1F,SAASC,QAAQ,CAACR,KAAK,EAAE;MAAE,IAAI;QAAEK,IAAI,CAACP,SAAS,CAAC,OAAO,CAAC,CAACE,KAAK,CAAC,CAAC;MAAE,CAAC,CAAC,OAAOO,CAAC,EAAE;QAAEJ,MAAM,CAACI,CAAC,CAAC;MAAE;IAAE;IAC7F,SAASF,IAAI,CAACI,MAAM,EAAE;MAAEA,MAAM,CAACC,IAAI,GAAGT,OAAO,CAACQ,MAAM,CAACT,KAAK,CAAC,GAAGD,KAAK,CAACU,MAAM,CAACT,KAAK,CAAC,CAACW,IAAI,CAACP,SAAS,EAAEI,QAAQ,CAAC;IAAE;IAC7GH,IAAI,CAAC,CAACP,SAAS,GAAGA,SAAS,CAACc,KAAK,CAACjB,OAAO,EAAEC,UAAU,IAAI,EAAE,CAAC,EAAEU,IAAI,EAAE,CAAC;EACzE,CAAC,CAAC;AACN;AAEA,SAASO,cAAc,CAACC,aAAa,EAAEC,4BAA4B,EAAE;EACjE,OAAOrB,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA;YACX,OAAMsB,MAAM,CAACC,MAAM,CAACC,SAAS,CAAC,KAAK,EAAEJ,aAAa,CAAC;UAAA;YAArEK,eAAe;YAAA;YACG,OAAMH,MAAM,CAACC,MAAM,CAACG,IAAI,CAAC;cAAEC,IAAI,EAAE,SAAS;cAAEtC,IAAI,EAAE;YAAQ,CAAC,EAAEgC,4BAA4B,EAAEI,eAAe,CAAC;UAAA;YAA7HG,eAAe;YACfC,QAAQ,GAAG,IAAIC,UAAU,CAACL,eAAe,CAACM,UAAU,GAAGH,eAAe,CAACG,UAAU,CAAC;YACxFF,QAAQ,CAACG,GAAG,CAAC,IAAIF,UAAU,CAACL,eAAe,CAAC,EAAE,CAAC,CAAC;YAChDI,QAAQ,CAACG,GAAG,CAAC,IAAIF,UAAU,CAACF,eAAe,CAAC,EAAEH,eAAe,CAACM,UAAU,CAAC;YAAC,iCACnEF,QAAQ;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAClB,EAAC;AACN;AAEA,IAAMI,qBAAqB,GAAG,CAAC;AAC/B,SAASC,0BAA0B,CAACC,cAAc,EAAE;EAChD,IAAIA,cAAc,IAAI,UAAU,EAAE;IAC9B,MAAM,IAAI7C,KAAK,CAAC,6EAA6E,CAAC;EAClG;EACA,IAAM8C,SAAS,GAAG,IAAIC,WAAW,CAACJ,qBAAqB,CAAC;EACxD,IAAMK,IAAI,GAAG,IAAIC,QAAQ,CAACH,SAAS,CAAC;EACpCE,IAAI,CAACE,SAAS,CAAC,CAAC,EAAEL,cAAc,EAAE,kBAAmB,KAAK,CAAC;EAC3D,OAAO,IAAIL,UAAU,CAACM,SAAS,CAAC;AACpC;AAEA,SAASK,0BAA0B,GAAG;EAClC,OAAOzC,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;MAAA;QAAA;UAAA;YAAA;YAC5B,OAAMsB,MAAM,CAACC,MAAM,CAACmB,WAAW,CAAC;cACnCrD,IAAI,EAAE,OAAO;cACbsD,UAAU,EAAE;YAChB,CAAC,EAAE,KAAK,CAAC,mBAAmB,CAAC,MAAM,CAAC,CAAC,gBAAgB;UAAA;YAAA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CACxD,EAAC;AACN;AAEA,SAASC,mBAAmB,GAAG;EAC3B,OAAO5C,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;MAAA;QAAA;UAAA;YAAA;YAC5B,OAAMsB,MAAM,CAACC,MAAM,CAACmB,WAAW,CAAC;cACnCrD,IAAI,EAAE,MAAM;cACZsD,UAAU,EAAE;YAChB,CAAC,EAAE,KAAK,CAAC,mBAAmB,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC,gBAAgB;UAAA;YAAA;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAC3E,EAAC;AACN;AAEA,IAAME,2BAA2B,GAAG,EAAE;AACtC,SAASC,qBAAqB,CAACC,cAAc,EAAEC,YAAY,EAAE;EACzD,OAAOhD,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;IAAA;MAAA;QAAA;UAAA;YAC7BiD,SAAS,GAAGC,IAAI,CAACC,SAAS,CAACJ,cAAc,CAAC;YAC1CK,oBAAoB,GAAGlB,0BAA0B,CAACa,cAAc,CAACM,EAAE,CAAC;YACpEC,oBAAoB,GAAG,IAAIxB,UAAU,CAACe,2BAA2B,CAAC;YACxEvB,MAAM,CAACiC,eAAe,CAACD,oBAAoB,CAAC;YAAC;YAC1B,OAAMhC,MAAM,CAACC,MAAM,CAACiC,OAAO,CAACC,kBAAkB,CAACL,oBAAoB,EAAEE,oBAAoB,CAAC,EAAEN,YAAY,EAAE,IAAIU,WAAW,EAAE,CAACC,MAAM,CAACV,SAAS,CAAC,CAAC;UAAA;YAA3JW,UAAU;YACV/B,QAAQ,GAAG,IAAIC,UAAU,CAACsB,oBAAoB,CAACrB,UAAU,GAAGuB,oBAAoB,CAACvB,UAAU,GAAG6B,UAAU,CAAC7B,UAAU,CAAC;YAC1HF,QAAQ,CAACG,GAAG,CAAC,IAAIF,UAAU,CAACsB,oBAAoB,CAAC,EAAE,CAAC,CAAC;YACrDvB,QAAQ,CAACG,GAAG,CAAC,IAAIF,UAAU,CAACwB,oBAAoB,CAAC,EAAEF,oBAAoB,CAACrB,UAAU,CAAC;YACnFF,QAAQ,CAACG,GAAG,CAAC,IAAIF,UAAU,CAAC8B,UAAU,CAAC,EAAER,oBAAoB,CAACrB,UAAU,GAAGuB,oBAAoB,CAACvB,UAAU,CAAC;YAAC,kCACrGF,QAAQ;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAClB,EAAC;AACN;AACA,SAASgC,qBAAqB,CAAC1E,OAAO,EAAE6D,YAAY,EAAE;EAClD,OAAOhD,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;IAAA;MAAA;QAAA;UAAA;YAC7BoD,oBAAoB,GAAGjE,OAAO,CAAC2E,KAAK,CAAC,CAAC,EAAE7B,qBAAqB,CAAC;YAC9DqB,oBAAoB,GAAGnE,OAAO,CAAC2E,KAAK,CAAC7B,qBAAqB,EAAEA,qBAAqB,GAAGY,2BAA2B,CAAC;YAChHe,UAAU,GAAGzE,OAAO,CAAC2E,KAAK,CAAC7B,qBAAqB,GAAGY,2BAA2B,CAAC;YAAA;YAC7D,OAAMvB,MAAM,CAACC,MAAM,CAACwC,OAAO,CAACN,kBAAkB,CAACL,oBAAoB,EAAEE,oBAAoB,CAAC,EAAEN,YAAY,EAAEY,UAAU,CAAC;UAAA;YAAvII,eAAe;YACff,SAAS,GAAGgB,cAAc,EAAE,CAACC,MAAM,CAACF,eAAe,CAAC;YACpDjB,cAAc,GAAGG,IAAI,CAACiB,KAAK,CAAClB,SAAS,CAAC;YAAA,KACxCmB,MAAM,CAACC,cAAc,CAACC,IAAI,CAACvB,cAAc,EAAE,OAAO,CAAC;cAAA;cAAA;YAAA;YAAA,MAC7C,IAAIjD,sCAAsC,CAACiD,cAAc,CAACM,EAAE,EAAEN,cAAc,CAACwB,KAAK,CAACrF,IAAI,EAAE6D,cAAc,CAACwB,KAAK,CAACpF,OAAO,CAAC;UAAA;YAAA,kCAEzH4D,cAAc;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CACxB,EAAC;AACN;AACA,SAASU,kBAAkB,CAACtB,cAAc,EAAEmB,oBAAoB,EAAE;EAC9D,OAAO;IACHkB,cAAc,EAAErC,cAAc;IAC9BsC,EAAE,EAAEnB,oBAAoB;IACxBjE,IAAI,EAAE,SAAS;IACfqF,SAAS,EAAE,GAAG,CAAE;EACpB,CAAC;AACL;;AACA,IAAIC,YAAY;AAChB,SAASV,cAAc,GAAG;EACtB,IAAIU,YAAY,KAAKC,SAAS,EAAE;IAC5BD,YAAY,GAAG,IAAIE,WAAW,CAAC,OAAO,CAAC;EAC3C;EACA,OAAOF,YAAY;AACvB;AAEA,SAASG,aAAa,CAACC,aAAa;AAAE;AACtCC,oBAAoB,EAAEC,cAAc,EAAE;EAClC,OAAOjF,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;IAAA;MAAA;QAAA;UAAA;YAAA;YACmB,OAAMQ,OAAO,CAAC0E,GAAG,CAAC,CACpE5D,MAAM,CAACC,MAAM,CAACC,SAAS,CAAC,KAAK,EAAEwD,oBAAoB,CAAC,EACpD1D,MAAM,CAACC,MAAM,CAAC4D,SAAS,CAAC,KAAK,EAAEJ,aAAa,EAAE;cAAE1F,IAAI,EAAE,MAAM;cAAEsD,UAAU,EAAE;YAAQ,CAAC,EAAE,KAAK,CAAC,mBAAmB,EAAE,CAAC,gBAAgB,CACpI,CAAC;UAAA;YAAA;YAAA;YAHKyC,0BAA0B;YAAEC,eAAe;YAAA;YAI7B,OAAM/D,MAAM,CAACC,MAAM,CAAC+D,UAAU,CAAC;cAAEjG,IAAI,EAAE,MAAM;cAAEkG,MAAM,EAAEF;YAAgB,CAAC,EAAEJ,cAAc,EAAE,GAAG,CAAC;UAAA;YAA7GjC,YAAY;YAAA;YACI,OAAM1B,MAAM,CAACC,MAAM,CAAC4D,SAAS,CAAC,KAAK,EAAEnC,YAAY,EAAE,MAAM,EAAE,KAAK,CAAC,mBAAmB,CAAC,WAAW,CAAC,CAAC,gBAAgB;UAAA;YAAlIwC,aAAa;YAAA;YACO,OAAMlE,MAAM,CAACC,MAAM,CAACkE,SAAS,CAAC;cACpDpG,IAAI,EAAE,MAAM;cACZsC,IAAI,EAAE,SAAS;cACf+D,IAAI,EAAE,IAAI5D,UAAU,CAACsD,0BAA0B,CAAC;cAChDO,IAAI,EAAE,IAAI7D,UAAU;YACxB,CAAC,EAAE0D,aAAa,EAAE;cAAEnG,IAAI,EAAE,SAAS;cAAEuG,MAAM,EAAE;YAAI,CAAC,EAAE,KAAK,CAAC,mBAAmB,CAAC,SAAS,EAAE,SAAS,CAAC,CAAC;UAAA;YAL9FC,iBAAiB;YAAA,kCAMhBA,iBAAiB;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAC3B,EAAC;AACN;AAEA,SAASC,wBAAwB,GAAG;EAChC,OAAOC,qBAAqB,CAAC,KAAK,GAAGC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,EAAE,IAAI,KAAK,GAAG,KAAK,GAAG,CAAC,CAAC,CAAC,CAAC;AACzF;AACA,SAASH,qBAAqB,CAACI,IAAI,EAAE;EACjC,IAAIA,IAAI,GAAG,KAAK,IAAIA,IAAI,GAAG,KAAK,EAAE;IAC9B,MAAM,IAAInH,8BAA8B,CAACP,kCAAkC,CAACC,mCAAmC,qEAA8DyH,IAAI,cAAW;MAAEA,IAAI,EAAJA;IAAK,CAAC,CAAC;EACzM;EACA,OAAOA,IAAI;AACf;;AAEA;AACA,SAASC,yBAAyB,CAACC,MAAM,EAAE;EACvC,IAAIC,MAAM,GAAG,EAAE;EACf,IAAMC,KAAK,GAAG,IAAIzE,UAAU,CAACuE,MAAM,CAAC;EACpC,IAAMG,GAAG,GAAGD,KAAK,CAACxE,UAAU;EAC5B,KAAK,IAAI0E,EAAE,GAAG,CAAC,EAAEA,EAAE,GAAGD,GAAG,EAAEC,EAAE,EAAE,EAAE;IAC7BH,MAAM,IAAII,MAAM,CAACC,YAAY,CAACJ,KAAK,CAACE,EAAE,CAAC,CAAC;EAC5C;EACA,OAAOG,MAAM,CAACC,IAAI,CAACP,MAAM,CAAC;AAC9B;AAEA,SAASQ,wCAAwC,CAACC,yBAAyB,EAAE;EACzE,OAAOA,yBAAyB,CAACC,OAAO,CAAC,QAAQ,EAAE,UAACC,CAAC;IAAA,OAAM;MACvD,GAAG,EAAE,GAAG;MACR,GAAG,EAAE,GAAG;MACR,GAAG,EAAE;IACT,CAAC,CAACA,CAAC,CAAC;EAAA,CAAC,CAAC;AACV;AAEA,IAAMC,WAAW,GAAG,eAAe;AACnC,SAASC,YAAY,CAACC,UAAU,EAAE;EAC9B,OAAQA;EACJ;EAAA,CACCJ,OAAO,CAAC,cAAc,EAAE,EAAE;EAC3B;EAAA,CACCK,KAAK,CAAC,GAAG,CAAC;AACnB;AACA,SAASC,YAAY,CAACC,cAAc,EAAEC,aAAa,EAAE;EACjD,IAAIC,OAAO,GAAG,IAAI;EAClB,IAAID,aAAa,EAAE;IACf,IAAI;MACAC,OAAO,GAAG,IAAIC,GAAG,CAACF,aAAa,CAAC;IACpC,CAAC,CACD,OAAOG,EAAE,EAAE,CAAE,CAAC,CAAC;IACf,IAAI,CAACF,OAAO,KAAK,IAAI,IAAIA,OAAO,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,OAAO,CAACG,QAAQ,MAAM,QAAQ,EAAE;MACnF,MAAM,IAAI5I,8BAA8B,CAACP,kCAAkC,CAACE,+BAA+B,EAAE,0DAA0D,CAAC;IAC5K;EACJ;EACA8I,OAAO,KAAKA,OAAO,GAAG,IAAIC,GAAG,WAAIR,WAAW,QAAK,CAAC;EAClD,IAAMW,QAAQ,GAAGN,cAAc,CAACO,UAAU,CAAC,GAAG,CAAC;EACzC;EACEP,cAAc;EAChB;EACE,6BAAIJ,YAAY,CAACM,OAAO,CAACI,QAAQ,CAAC,sBAAKV,YAAY,CAACI,cAAc,CAAC,GAAEQ,IAAI,CAAC,GAAG,CAAC;EACtF,OAAO,IAAIL,GAAG,CAACG,QAAQ,EAAEJ,OAAO,CAAC;AACrC;AACA,SAASO,4BAA4B,CAAChD,oBAAoB,EAAEiD,YAAY,EAAEC,kBAAkB,EAAE;EAC1F,OAAOlI,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;IAAA;MAAA;QAAA;UAAA;YAC7BmI,eAAe,GAAGpC,qBAAqB,CAACkC,YAAY,CAAC;YAAA;YACvC,OAAM3G,MAAM,CAACC,MAAM,CAACC,SAAS,CAAC,KAAK,EAAEwD,oBAAoB,CAAC;UAAA;YAAxEoD,WAAW;YACXC,UAAU,GAAGjC,yBAAyB,CAACgC,WAAW,CAAC;YACnDE,GAAG,GAAGhB,YAAY,CAAC,oBAAoB,EAAEY,kBAAkB,CAAC;YAClEI,GAAG,CAACC,YAAY,CAACvG,GAAG,CAAC,aAAa,EAAE8E,wCAAwC,CAACuB,UAAU,CAAC,CAAC;YACzFC,GAAG,CAACC,YAAY,CAACvG,GAAG,CAAC,MAAM,YAAKmG,eAAe,EAAG;YAAC,kCAC5CG,GAAG;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CACb,EAAC;AACN;;AAEA;AACA,IAAME,OAAO,GAAG;EACZC,OAAO,EAAE,CAAC;EACVC,KAAK,EAAE;AACX,CAAC;AACD,SAASC,iBAAiB,CAACC,CAAC,EAAE;EAC1B,OAAOA,CAAC;AACZ;AACA,SAASC,UAAU,GAAG;EAClB,OAAOC,SAAS,CAACC,SAAS,CAACC,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,GAAGR,OAAO,CAACC,OAAO,GAAGD,OAAO,CAACE,KAAK;AAC3F;AACA,SAASO,mBAAmB,GAAG;EAC3B;EACA;EACA;EACA,OAAO,IAAIzI,OAAO,CAAC,UAACD,OAAO,EAAEE,MAAM,EAAK;IACpC,SAASyI,OAAO,GAAG;MACfC,YAAY,CAACC,SAAS,CAAC;MACvBxC,MAAM,CAACyC,mBAAmB,CAAC,MAAM,EAAEC,UAAU,CAAC;IAClD;IACA,SAASA,UAAU,GAAG;MAClBJ,OAAO,EAAE;MACT3I,OAAO,EAAE;IACb;IACAqG,MAAM,CAAC2C,gBAAgB,CAAC,MAAM,EAAED,UAAU,CAAC;IAC3C,IAAMF,SAAS,GAAGI,UAAU,CAAC,YAAM;MAC/BN,OAAO,EAAE;MACTzI,MAAM,EAAE;IACZ,CAAC,EAAE,IAAI,CAAC;EACZ,CAAC,CAAC;AACN;AACA,IAAIgJ,MAAM,GAAG,IAAI;AACjB,SAASC,2BAA2B,CAACpB,GAAG,EAAE;EACtC,IAAImB,MAAM,IAAI,IAAI,EAAE;IAChBA,MAAM,GAAGE,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;IACzCH,MAAM,CAACI,KAAK,CAACC,OAAO,GAAG,MAAM;IAC7BH,QAAQ,CAACI,IAAI,CAACC,WAAW,CAACP,MAAM,CAAC;EACrC;EACA;EACAA,MAAM,CAACQ,aAAa,CAACC,QAAQ,CAACC,IAAI,GAAG7B,GAAG,CAAC8B,QAAQ,EAAE;AACvD;AACA,SAASC,YAAY,CAACrF,oBAAoB,EAAEkD,kBAAkB,EAAE;EAC5D,OAAOlI,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;IAAA;MAAA;QAAA;UAAA;YAC7BsK,qBAAqB,GAAGxE,wBAAwB,EAAE;YAAA;YACjC,OAAMkC,4BAA4B,CAAChD,oBAAoB,EAAEsF,qBAAqB,EAAEpC,kBAAkB,CAAC;UAAA;YAApHqC,cAAc;YAAA,MAChBA,cAAc,CAAC3C,QAAQ,KAAK,QAAQ;cAAA;cAAA;YAAA;YACpC;YACA;YACA;YACAhB,MAAM,CAACsD,QAAQ,CAACM,MAAM,CAACD,cAAc,CAAC;YAAC;YAAA;UAAA;YAAA;YAK7BE,OAAO,GAAG5B,UAAU,EAAE;YAAA,eACpB4B,OAAO;YAAA,kCACNjC,OAAO,CAACC,OAAO,yBAKfD,OAAO,CAACE,KAAK;YAAA;UAAA;YAJd;YACAgB,2BAA2B,CAACa,cAAc,CAAC;YAC3C;YAAA;UAAA;YAGMG,gBAAgB,GAAGzB,mBAAmB,EAAE;YAC9CrC,MAAM,CAACsD,QAAQ,CAACM,MAAM,CAACD,cAAc,CAAC;YAAC;YACvC,OAAMG,gBAAgB;UAAA;YAAA;UAAA;YAItB/B,iBAAiB,CAAC8B,OAAO,CAAC;UAAC;YAAA;YAAA;UAAA;YAAA;YAAA;YAAA,MAI7B,IAAIzL,8BAA8B,CAACP,kCAAkC,CAACM,sBAAsB,EAAE,qEAAqE,CAAC;UAAA;YAAA,kCAG3KuL,qBAAqB;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CAC/B,EAAC;AACN;AAEA,IAAMK,2BAA2B,GAAG;EAChC;AACJ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACIC,oBAAoB,EAAE,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,CAAC;EAC/DC,SAAS,EAAE;AACf,CAAC;AACD,IAAMC,kBAAkB,GAAG,mCAAmC;AAC9D,SAASC,mBAAmB,GAAG;EAC3B,IAAI,OAAOnE,MAAM,KAAK,WAAW,IAAIA,MAAM,CAACoE,eAAe,KAAK,IAAI,EAAE;IAClE,MAAM,IAAIhM,8BAA8B,CAACP,kCAAkC,CAACG,6BAA6B,EAAE,gFAAgF,CAAC;EAChM;AACJ;AACA,SAASqM,+BAA+B,CAACC,aAAa,EAAE;EACpD,IAAI5C,GAAG;EACP,IAAI;IACAA,GAAG,GAAG,IAAIZ,GAAG,CAACwD,aAAa,CAAC;EAChC,CAAC,CACD,OAAOvD,EAAE,EAAE;IACP,MAAM,IAAI3I,8BAA8B,CAACP,kCAAkC,CAACE,+BAA+B,EAAE,qCAAqC,CAAC;EACvJ;EACA,IAAI2J,GAAG,CAACV,QAAQ,KAAK,QAAQ,EAAE;IAC3B,MAAM,IAAI5I,8BAA8B,CAACP,kCAAkC,CAACE,+BAA+B,EAAE,0DAA0D,CAAC;EAC5K;AACJ;AACA,SAASwM,8BAA8B,CAAC/I,SAAS,EAAE;EAC/C,IAAME,IAAI,GAAG,IAAIC,QAAQ,CAACH,SAAS,CAAC;EACpC,OAAOE,IAAI,CAAC8I,SAAS,CAAC,CAAC,EAAE,kBAAmB,KAAK,CAAC;AACtD;AACA,SAASC,QAAQ,CAACC,QAAQ,EAAEC,MAAM,EAAE;EAChC,OAAOvL,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;IAAA;IAAA;IAAA;MAAA;QAAA;UAAA;YACnC+K,mBAAmB,EAAE;YAAC;YACK,OAAMtI,0BAA0B,EAAE;UAAA;YAAvD+I,kBAAkB;YAAA;YACJ,OAAMnB,YAAY,CAACmB,kBAAkB,CAACC,SAAS,EAAEF,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAK,KAAK,CAAC,GAAG,KAAK,CAAC,GAAGA,MAAM,CAACG,OAAO,CAAC;UAAA;YAA9HC,WAAW;YACXC,YAAY,4BAAqBD,WAAW;YAE5CE,mBAAmB,GAAI,YAAM;cAC/B,IAAMC,QAAQ,sBAAOnB,2BAA2B,CAACC,oBAAoB,CAAC;cACtE,OAAO;gBAAA,OAAOkB,QAAQ,CAAClG,MAAM,GAAG,CAAC,GAAGkG,QAAQ,CAACC,KAAK,EAAE,GAAGD,QAAQ,CAAC,CAAC,CAAC;cAAA,CAAC;YACvE,CAAC,EAAG;YACAE,oBAAoB,GAAG,CAAC;YACxBC,8BAA8B,GAAG,CAAC;YAClCC,KAAK,GAAG;cAAEC,MAAM,EAAE;YAAe,CAAC;YAAA,mCAC/B,IAAI3L,OAAO,CAAC,UAACD,OAAO,EAAEE,MAAM,EAAK;cACpC,IAAI2L,MAAM;cACV;cACA,IAAMC,uBAAuB,GAAG,CAAC,CAAC;cAClC,IAAMC,UAAU,GAAG,SAAbA,UAAU;gBAAA,OAAStM,SAAS,CAAC,MAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;kBAAA;kBAAA;oBAAA;sBAAA;wBAAA;0BAAA,MACjDkM,KAAK,CAACC,MAAM,KAAK,YAAY;4BAAA;4BAAA;0BAAA;0BAC7BI,OAAO,CAACC,IAAI,CAAC,+EAA+E,kBAC/EN,KAAK,CAACC,MAAM,OAAK,CAAC;0BAAC;wBAAA;0BAAA,SAGLD,KAAK,EAA5BV,kBAAkB,UAAlBA,kBAAkB;0BAC1BY,MAAM,CAAC/C,mBAAmB,CAAC,MAAM,EAAEiD,UAAU,CAAC;0BAAC;0BAC3B,OAAM1J,mBAAmB,EAAE;wBAAA;0BAAzC6J,WAAW;0BAAA,eACjBL,MAAM;0BAAA;0BAAM,OAAMjL,cAAc,CAACsL,WAAW,CAAChB,SAAS,EAAED,kBAAkB,CAACkB,UAAU,CAAC;wBAAA;0BAAA;0BAAA,aAA/EC,IAAI;0BACXT,KAAK,GAAG;4BACJC,MAAM,EAAE,gBAAgB;4BACxBnH,oBAAoB,EAAEwG,kBAAkB,CAACC,SAAS;4BAClDxG,cAAc,EAAEwH,WAAW,CAACC;0BAChC,CAAC;wBAAC;wBAAA;0BAAA;sBAAA;oBAAA;kBAAA;gBAAA,CACL,EAAC;cAAA;cACF,IAAME,WAAW,GAAG,SAAdA,WAAW,CAAIC,GAAG,EAAK;gBACzB,IAAIA,GAAG,CAACC,QAAQ,EAAE;kBACdZ,KAAK,GAAG;oBAAEC,MAAM,EAAE;kBAAe,CAAC;gBACtC,CAAC,MACI;kBACD1L,MAAM,CAAC,IAAIzB,8BAA8B,CAACP,kCAAkC,CAACI,oBAAoB,qDAA8CgO,GAAG,CAAC3N,IAAI,eAAK2N,GAAG,CAACE,MAAM,SAAM;oBAAEC,UAAU,EAAEH;kBAAI,CAAC,CAAC,CAAC;gBACrM;gBACAI,aAAa,EAAE;cACnB,CAAC;cACD,IAAMC,WAAW,GAAG,SAAdA,WAAW,CAAIC,IAAI;gBAAA,OAAKnN,SAAS,CAAC,MAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;kBAAA;oBAAA;sBAAA;wBAAA;0BAC1DiN,aAAa,EAAE;0BAAC,MACZG,IAAI,CAACC,GAAG,EAAE,GAAGC,mBAAmB,IAAI3C,2BAA2B,CAACE,SAAS;4BAAA;4BAAA;0BAAA;0BACzEpK,MAAM,CAAC,IAAIzB,8BAA8B,CAACP,kCAAkC,CAACK,qBAAqB,8DAAuD6M,WAAW,OAAI,CAAC;0BAAC;0BAAA;wBAAA;0BAAA;0BAG1K,OAAM,IAAInL,OAAO,CAAC,UAACD,OAAO,EAAK;4BAC3B,IAAMgN,YAAY,GAAG1B,mBAAmB,EAAE;4BAC1C2B,kBAAkB,GAAG5G,MAAM,CAAC4C,UAAU,CAACjJ,OAAO,EAAEgN,YAAY,CAAC;0BACjE,CAAC,CAAC;wBAAA;0BACFE,uBAAuB,EAAE;wBAAC;wBAAA;0BAAA;sBAAA;oBAAA;kBAAA;gBAAA,CAEjC,EAAC;cAAA;cACF,IAAMC,aAAa,GAAG,SAAhBA,aAAa,CAAIb,GAAG;gBAAA,OAAK7M,SAAS,CAAC,MAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;kBAAA;kBAAA;oBAAA;sBAAA;wBAAA;0BAAA;0BACpC,OAAM6M,GAAG,CAACzN,IAAI,CAACuO,WAAW,EAAE;wBAAA;0BAA7CC,cAAc;0BAAA,gBACZ1B,KAAK,CAACC,MAAM;0BAAA,oCACX,WAAW,yBAwBX,gBAAgB;0BAAA;wBAAA;0BAAA;0BAtBP/I,oBAAoB,GAAGwK,cAAc,CAAC9J,KAAK,CAAC,CAAC,EAAE7B,qBAAqB,CAAC;0BACrEE,cAAc,GAAGgJ,8BAA8B,CAAC/H,oBAAoB,CAAC;0BAAA,MACvEjB,cAAc,KAAM8J,8BAA8B,GAAG,CAAE;4BAAA;4BAAA;0BAAA;0BAAA,MACjD,IAAI3M,KAAK,CAAC,+CAA+C,CAAC;wBAAA;0BAEpE2M,8BAA8B,GAAG9J,cAAc;0BAAC;0BACzB,OAAM0B,qBAAqB,CAAC+J,cAAc,EAAE1B,KAAK,CAAClJ,YAAY,CAAC;wBAAA;0BAAhFD,cAAc;0BACd8K,eAAe,GAAGxB,uBAAuB,CAACtJ,cAAc,CAACM,EAAE,CAAC;0BAClE,OAAOgJ,uBAAuB,CAACtJ,cAAc,CAACM,EAAE,CAAC;0BACjDwK,eAAe,CAACtN,OAAO,CAACwC,cAAc,CAAChC,MAAM,CAAC;0BAAC;0BAAA;wBAAA;0BAAA;0BAAA;0BAAA,MAG3C,yBAAajB,sCAAsC;4BAAA;4BAAA;0BAAA;0BAC7C+N,gBAAe,GAAGxB,uBAAuB,CAAC,cAAEtM,gBAAgB,CAAC;0BACnE,OAAOsM,uBAAuB,CAAC,cAAEtM,gBAAgB,CAAC;0BAClD8N,gBAAe,CAACpN,MAAM,eAAG;0BAAC;0BAAA;wBAAA;0BAAA;wBAAA;0BAAA;wBAAA;0BAAA;0BAQb,OAAMqE,aAAa,CAAC8I,cAAc,EAAE1B,KAAK,CAAClH,oBAAoB,EAAEkH,KAAK,CAACjH,cAAc,CAAC;wBAAA;0BAApGjC,YAAY;0BAClBkJ,KAAK,GAAG;4BAAEC,MAAM,EAAE,WAAW;4BAAEnJ,YAAY,EAAZA;0BAAa,CAAC;0BACvC8K,MAAM,GAAG,IAAIC,KAAK,CAAC,CAAC,CAAC,EAAE;4BACzBC,GAAG,eAACC,MAAM,EAAEC,CAAC,EAAE;8BACX,IAAID,MAAM,CAACC,CAAC,CAAC,IAAI,IAAI,EAAE;gCACnB,IAAMC,MAAM,GAAGD,CAAC,CACX9D,QAAQ,EAAE,CACVpD,OAAO,CAAC,QAAQ,EAAE,UAACoH,MAAM;kCAAA,kBAASA,MAAM,CAACC,WAAW,EAAE;gCAAA,CAAE,CAAC,CACzDA,WAAW,EAAE;gCAClBJ,MAAM,CAACC,CAAC,CAAC,GAAG,UAAUI,MAAM,EAAE;kCAC1B,OAAOtO,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,KAAK,CAAC,0CAAE;oCAAA;oCAAA;sCAAA;wCAAA;0CAAA;4CAC7BqD,EAAE,GAAG2I,oBAAoB,EAAE;4CAAA,gBACjCI,MAAM;4CAAA;4CAAM,OAAMtJ,qBAAqB,CAAC;8CACpCO,EAAE,EAAFA,EAAE;8CACFkL,OAAO,EAAE,KAAK;8CACdJ,MAAM,EAANA,MAAM;8CACNG,MAAM,EAAEA,MAAM,KAAK,IAAI,IAAIA,MAAM,KAAK,KAAK,CAAC,GAAGA,MAAM,GAAG,CAAC;4CAC7D,CAAC,EAAEtL,YAAY,CAAC;0CAAA;4CAAA;4CAAA,cALT2J,IAAI;4CAAA,mCAMJ,IAAInM,OAAO,CAAC,UAACD,QAAO,EAAEE,MAAM,EAAK;8CACpC4L,uBAAuB,CAAChJ,EAAE,CAAC,GAAG;gDAC1B9C,OAAO,mBAACQ,MAAM,EAAE;kDACZ,QAAQmN,CAAC;oDACL,KAAK,WAAW;oDAChB,KAAK,aAAa;sDAAE;wDAChB,IAAQM,eAAe,GAAKzN,MAAM,CAA1ByN,eAAe;wDACvB,IAAIA,eAAe,IAAI,IAAI,EAAE;0DACzB,IAAI;4DACAvD,+BAA+B,CAACuD,eAAe,CAAC;0DACpD,CAAC,CACD,OAAO3N,CAAC,EAAE;4DACNJ,MAAM,CAACI,CAAC,CAAC;4DACT;0DACJ;wDACJ;wDACA;sDACJ;kDAAC;kDAELN,QAAO,CAACQ,MAAM,CAAC;gDACnB,CAAC;gDACDN,MAAM,EAANA;8CACJ,CAAC;4CACL,CAAC,CAAC;0CAAA;0CAAA;4CAAA;wCAAA;sCAAA;oCAAA;kCAAA,CACL,EAAC;gCACN,CAAC;8BACL;8BACA,OAAOwN,MAAM,CAACC,CAAC,CAAC;4BACpB,CAAC;4BACDO,cAAc,4BAAG;8BACb,OAAO,KAAK;4BAChB,CAAC;4BACDC,cAAc,4BAAG;8BACb,OAAO,KAAK;4BAChB;0BACJ,CAAC,CAAC;0BAAA;0BAAA,gBAEEnO,OAAO;0BAAA;0BAAC,OAAM+K,QAAQ,CAACwC,MAAM,CAAC;wBAAA;0BAAA;0BAAA;0BAAA;0BAAA;wBAAA;0BAAA;0BAAA;0BAG9BrN,MAAM,eAAG;wBAAC;0BAAA;0BAGVwM,aAAa,EAAE;0BACfb,MAAM,CAACuC,KAAK,EAAE;0BAAC;wBAAA;0BAAA;wBAAA;wBAAA;0BAAA;sBAAA;oBAAA;kBAAA;gBAAA,CAK9B,EAAC;cAAA;cACF,IAAI1B,aAAa;cACjB,IAAIO,kBAAkB;cACtB,IAAMC,uBAAuB,GAAG,SAA1BA,uBAAuB,GAAS;gBAClC,IAAIR,aAAa,EAAE;kBACfA,aAAa,EAAE;gBACnB;gBACAf,KAAK,GAAG;kBAAEC,MAAM,EAAE,YAAY;kBAAEX,kBAAkB,EAAlBA;gBAAmB,CAAC;gBACpD,IAAI8B,mBAAmB,KAAK1I,SAAS,EAAE;kBACnC0I,mBAAmB,GAAGF,IAAI,CAACC,GAAG,EAAE;gBACpC;gBACAjB,MAAM,GAAG,IAAIwC,SAAS,CAAChD,YAAY,EAAE,CAACd,kBAAkB,CAAC,CAAC;gBAC1DsB,MAAM,CAAC7C,gBAAgB,CAAC,MAAM,EAAE+C,UAAU,CAAC;gBAC3CF,MAAM,CAAC7C,gBAAgB,CAAC,OAAO,EAAEqD,WAAW,CAAC;gBAC7CR,MAAM,CAAC7C,gBAAgB,CAAC,OAAO,EAAE2D,WAAW,CAAC;gBAC7Cd,MAAM,CAAC7C,gBAAgB,CAAC,SAAS,EAAEmE,aAAa,CAAC;gBACjDT,aAAa,GAAG,yBAAM;kBAClBrG,MAAM,CAACuC,YAAY,CAACqE,kBAAkB,CAAC;kBACvCpB,MAAM,CAAC/C,mBAAmB,CAAC,MAAM,EAAEiD,UAAU,CAAC;kBAC9CF,MAAM,CAAC/C,mBAAmB,CAAC,OAAO,EAAEuD,WAAW,CAAC;kBAChDR,MAAM,CAAC/C,mBAAmB,CAAC,OAAO,EAAE6D,WAAW,CAAC;kBAChDd,MAAM,CAAC/C,mBAAmB,CAAC,SAAS,EAAEqE,aAAa,CAAC;gBACxD,CAAC;cACL,CAAC;cACDD,uBAAuB,EAAE;YAC7B,CAAC,CAAC;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CACL,EAAC;AACN;AAEA,SAASzO,8BAA8B,EAAEP,kCAAkC,EAAEqB,sCAAsC,EAAEP,0CAA0C,EAAE8L,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}