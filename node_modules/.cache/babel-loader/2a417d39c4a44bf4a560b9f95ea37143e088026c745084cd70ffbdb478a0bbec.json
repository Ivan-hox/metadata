{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/regeneratorRuntime.js\").default;\nvar _classCallCheck = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SolanaWallet = void 0;\nvar web3_js_1 = require(\"@solana/web3.js\");\nvar bs58_1 = __importDefault(require(\"bs58\"));\nvar buffer_1 = require(\"buffer\");\nvar SolanaWallet = /*#__PURE__*/function () {\n  function SolanaWallet(auth, rpcUrl) {\n    var _this = this;\n    _classCallCheck(this, SolanaWallet);\n    this.auth = auth;\n    this.rpcUrl = rpcUrl;\n    this.isParticleNetwork = true;\n    this.auth = auth;\n    this.rpcUrl = rpcUrl;\n    this._connecting = false;\n    var userInfo = this.auth.userInfo();\n    if (userInfo) {\n      var wallet = userInfo.wallets.find(function (w) {\n        return w.chain_name === \"solana\" && w.public_address.length > 0;\n      });\n      if (wallet) {\n        this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n      } else {\n        this._publicKey = null;\n      }\n    } else {\n      this._publicKey = null;\n    }\n    this.auth.on(\"connect\", function (userInfo) {\n      var wallet = userInfo.wallets.find(function (w) {\n        return w.chain_name === \"solana\" && w.public_address.length > 0;\n      });\n      if (wallet) {\n        _this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n      }\n    });\n    this.auth.on(\"disconnect\", function () {\n      _this._publicKey = null;\n    });\n  }\n  _createClass(SolanaWallet, [{\n    key: \"connecting\",\n    get: function get() {\n      return this._connecting;\n    }\n  }, {\n    key: \"connected\",\n    get: function get() {\n      return this._publicKey !== null;\n    }\n  }, {\n    key: \"publicKey\",\n    get: function get() {\n      return this._publicKey;\n    }\n  }, {\n    key: \"connect\",\n    value: function connect(config) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var wallet;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.prev = 0;\n                this._connecting = true;\n                wallet = this.auth.wallet();\n                if (!wallet) {\n                  _context.next = 6;\n                  break;\n                }\n                this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n                return _context.abrupt(\"return\", Promise.resolve());\n              case 6:\n                _context.next = 8;\n                return this.auth.login(config);\n              case 8:\n                wallet = this.auth.wallet();\n                if (!wallet) {\n                  _context.next = 14;\n                  break;\n                }\n                this._publicKey = new web3_js_1.PublicKey(wallet.public_address);\n                return _context.abrupt(\"return\", Promise.resolve());\n              case 14:\n                return _context.abrupt(\"return\", Promise.reject(\"wallet create failed\"));\n              case 15:\n                _context.next = 20;\n                break;\n              case 17:\n                _context.prev = 17;\n                _context.t0 = _context[\"catch\"](0);\n                return _context.abrupt(\"return\", Promise.reject(_context.t0));\n              case 20:\n                _context.prev = 20;\n                this._connecting = false;\n                return _context.finish(20);\n              case 23:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this, [[0, 17, 20, 23]]);\n      }));\n    }\n  }, {\n    key: \"disconnect\",\n    value: function disconnect() {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.next = 2;\n                return this.auth.logout();\n              case 2:\n                this._publicKey = null;\n                return _context2.abrupt(\"return\", Promise.resolve());\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n    }\n  }, {\n    key: \"signTransaction\",\n    value: function signTransaction(transaction) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n        var signature;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.next = 2;\n                return this.auth.sign(\"signTransaction\", bs58_1.default.encode(transaction.serialize({\n                  requireAllSignatures: false,\n                  verifySignatures: false\n                })));\n              case 2:\n                signature = _context3.sent;\n                return _context3.abrupt(\"return\", web3_js_1.Transaction.from(buffer_1.Buffer.from(signature, \"base64\")));\n              case 4:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n    }\n  }, {\n    key: \"signAllTransactions\",\n    value: function signAllTransactions(transactions) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee4() {\n        var signatures;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.next = 2;\n                return this.auth.signAllTransactions(transactions.map(function (tx) {\n                  return bs58_1.default.encode(tx.serialize({\n                    requireAllSignatures: false,\n                    verifySignatures: false\n                  }));\n                }));\n              case 2:\n                signatures = _context4.sent;\n                return _context4.abrupt(\"return\", signatures.map(function (signed) {\n                  return web3_js_1.Transaction.from(buffer_1.Buffer.from(signed, \"base64\"));\n                }));\n              case 4:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n    }\n  }, {\n    key: \"signAndSendTransaction\",\n    value: function signAndSendTransaction(transaction) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                return _context5.abrupt(\"return\", this.auth.sendTransaction(bs58_1.default.encode(transaction.serialize({\n                  requireAllSignatures: false,\n                  verifySignatures: false\n                }))));\n              case 1:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n    }\n  }, {\n    key: \"signMessage\",\n    value: function signMessage(message) {\n      return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n        var signature;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                _context6.next = 2;\n                return this.auth.sign(\"signMessage\", bs58_1.default.encode(message));\n              case 2:\n                signature = _context6.sent;\n                return _context6.abrupt(\"return\", buffer_1.Buffer.from(signature, \"base64\"));\n              case 4:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n    }\n  }, {\n    key: \"getConnection\",\n    value: function getConnection(config) {\n      var url = this.rpcUrl ? this.rpcUrl + \"/solana/rpc\" : \"https://api.particle.network/solana-chain/rpc\";\n      return new web3_js_1.Connection(\"\".concat(url, \"?chainId=\").concat(this.auth.chainId()), {\n        commitment: config === null || config === void 0 ? void 0 : config.commitment,\n        wsEndpoint: config === null || config === void 0 ? void 0 : config.wsEndpoint,\n        httpHeaders: {\n          Authorization: this.auth.basicCredentials()\n        },\n        fetch: config === null || config === void 0 ? void 0 : config.fetch,\n        fetchMiddleware: config === null || config === void 0 ? void 0 : config.fetchMiddleware,\n        disableRetryOnRateLimit: config === null || config === void 0 ? void 0 : config.disableRetryOnRateLimit,\n        confirmTransactionInitialTimeout: config === null || config === void 0 ? void 0 : config.confirmTransactionInitialTimeout\n      });\n    }\n  }]);\n  return SolanaWallet;\n}();\nexports.SolanaWallet = SolanaWallet;","map":{"version":3,"mappings":"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","names":["SolanaWallet","auth","rpcUrl","_connecting","userInfo","wallet","wallets","find","w","chain_name","public_address","length","_publicKey","web3_js_1","on","config","Promise","resolve","login","reject","logout","transaction","sign","bs58_1","encode","serialize","requireAllSignatures","verifySignatures","signature","from","buffer_1","transactions","signAllTransactions","map","tx","signatures","signed","sendTransaction","message","url","chainId","commitment","wsEndpoint","httpHeaders","Authorization","basicCredentials","fetch","fetchMiddleware","disableRetryOnRateLimit","confirmTransactionInitialTimeout","exports"],"sources":["../src/solana-wallet.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}