{"ast":null,"code":"import _createForOfIteratorHelper from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _classCallCheck from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _inherits from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport _regeneratorRuntime from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport { PublicKey } from '@solana/web3.js';\nimport { createLoggerMiddleware, COMMUNICATION_JRPC_METHODS, COMMUNICATION_NOTIFICATIONS, PROVIDER_JRPC_METHODS, PROVIDER_NOTIFICATIONS } from '@toruslabs/base-controllers';\nimport { setAPIKey } from '@toruslabs/http-helpers';\nimport { SafeEventEmitter, ObjectMultiplex, createStreamMiddleware, JRPCEngine, createIdRemapMiddleware, getRpcPromiseCallback, BasePostMessageStream } from '@toruslabs/openlogin-jrpc';\nimport { ethErrors, EthereumRpcError } from 'eth-rpc-errors';\nimport { duplex } from 'is-stream';\nimport pump from 'pump';\nimport loglevel from 'loglevel';\nimport dequal from 'fast-deep-equal';\nvar version = \"0.3.2\";\nvar messages = {\n  errors: {\n    disconnected: function disconnected() {\n      return \"Torus: Lost connection to Torus.\";\n    },\n    permanentlyDisconnected: function permanentlyDisconnected() {\n      return \"Torus: Disconnected from iframe. Page reload required.\";\n    },\n    unsupportedSync: function unsupportedSync(method) {\n      return \"Torus: The Torus Ethereum provider does not support synchronous methods like \".concat(method, \" without a callback parameter.\");\n    },\n    invalidDuplexStream: function invalidDuplexStream() {\n      return \"Must provide a Node.js-style duplex stream.\";\n    },\n    invalidOptions: function invalidOptions(maxEventListeners) {\n      return \"Invalid options. Received: { maxEventListeners: \".concat(maxEventListeners, \"}\");\n    },\n    invalidRequestArgs: function invalidRequestArgs() {\n      return \"Expected a single, non-array, object argument.\";\n    },\n    invalidRequestMethod: function invalidRequestMethod() {\n      return \"'args.method' must be a non-empty string.\";\n    },\n    invalidRequestParams: function invalidRequestParams() {\n      return \"'args.params' must be an object or array if provided.\";\n    },\n    invalidLoggerObject: function invalidLoggerObject() {\n      return \"'args.logger' must be an object if provided.\";\n    },\n    invalidLoggerMethod: function invalidLoggerMethod(method) {\n      return \"'args.logger' must include required method '\".concat(method, \"'.\");\n    }\n  },\n  info: {\n    connected: function connected(chainId) {\n      return \"Torus: Connected to chain with ID \\\"\".concat(chainId, \"\\\".\");\n    }\n  },\n  warnings: {}\n};\nvar PAYMENT_PROVIDER = {\n  MOONPAY: \"moonpay\",\n  WYRE: \"wyre\",\n  RAMPNETWORK: \"rampnetwork\",\n  XANPOOL: \"xanpool\",\n  MERCURYO: \"mercuryo\",\n  TRANSAK: \"transak\"\n};\nvar TORUS_BUILD_ENV = {\n  PRODUCTION: \"production\",\n  DEVELOPMENT: \"development\",\n  TESTING: \"testing\"\n};\nvar BUTTON_POSITION = {\n  BOTTOM_LEFT: \"bottom-left\",\n  TOP_LEFT: \"top-left\",\n  BOTTOM_RIGHT: \"bottom-right\",\n  TOP_RIGHT: \"top-right\"\n};\nvar LOGIN_PROVIDER = {\n  GOOGLE: \"google\",\n  FACEBOOK: \"facebook\",\n  REDDIT: \"reddit\",\n  DISCORD: \"discord\",\n  TWITCH: \"twitch\",\n  APPLE: \"apple\",\n  LINE: \"line\",\n  GITHUB: \"github\",\n  KAKAO: \"kakao\",\n  LINKEDIN: \"linkedin\",\n  TWITTER: \"twitter\",\n  WEIBO: \"weibo\",\n  WECHAT: \"wechat\",\n  EMAIL_PASSWORDLESS: \"email_passwordless\"\n};\nvar translations = {\n  en: {\n    embed: {\n      continue: \"Continue\",\n      actionRequired: \"Authorization required\",\n      pendingAction: \"Click continue to proceed with your request in a popup\",\n      cookiesRequired: \"Cookies Required\",\n      enableCookies: \"Please enable cookies in your browser preferences to access Torus\",\n      clickHere: \"More Info\"\n    }\n  },\n  de: {\n    embed: {\n      continue: \"Fortsetzen\",\n      actionRequired: \"Autorisierung erforderlich\",\n      pendingAction: \"Klicken Sie in einem Popup auf Weiter, um mit Ihrer Anfrage fortzufahren\",\n      cookiesRequired: \"Cookies benötigt\",\n      enableCookies: \"Bitte aktivieren Sie Cookies in Ihren Browsereinstellungen, um auf Torus zuzugreifen\",\n      clickHere: \"Mehr Info\"\n    }\n  },\n  ja: {\n    embed: {\n      continue: \"継続する\",\n      actionRequired: \"認証が必要です\",\n      pendingAction: \"続行をクリックして、ポップアップでリクエストを続行します\",\n      cookiesRequired: \"必要なクッキー\",\n      enableCookies: \"Torusにアクセスするには、ブラウザの設定でCookieを有効にしてください。\",\n      clickHere: \"詳しくは\"\n    }\n  },\n  ko: {\n    embed: {\n      continue: \"계속하다\",\n      actionRequired: \"승인 필요\",\n      pendingAction: \"팝업에서 요청을 진행하려면 계속을 클릭하십시오.\",\n      cookiesRequired: \"쿠키 필요\",\n      enableCookies: \"브라우저 환경 설정에서 쿠키를 활성화하여 Torus에 액세스하십시오.\",\n      clickHere: \"더 많은 정보\"\n    }\n  },\n  zh: {\n    embed: {\n      continue: \"继续\",\n      actionRequired: \"需要授权\",\n      pendingAction: \"单击继续以在弹出窗口中继续您的请求\",\n      cookiesRequired: \"必填Cookie\",\n      enableCookies: \"请在您的浏览器首选项中启用cookie以访问Torus。\",\n      clickHere: \"更多信息\"\n    }\n  }\n};\nvar configuration = {\n  supportedVerifierList: [LOGIN_PROVIDER.GOOGLE, LOGIN_PROVIDER.REDDIT, LOGIN_PROVIDER.DISCORD],\n  api: \"https://api.tor.us\",\n  translations: translations,\n  prodTorusUrl: \"\",\n  localStorageKey: \"torus-\".concat(window.location.hostname)\n};\nvar log = loglevel.getLogger(\"solana-embed\");\n\n// utility functions\n/**\n * json-rpc-engine middleware that logs RPC errors and and validates req.method.\n *\n * @param log - The logging API to use.\n * @returns  json-rpc-engine middleware function\n */\nfunction createErrorMiddleware() {\n  return function (req, res, next) {\n    // json-rpc-engine will terminate the request when it notices this error\n    if (typeof req.method !== \"string\" || !req.method) {\n      res.error = ethErrors.rpc.invalidRequest({\n        message: \"The request 'method' must be a non-empty string.\",\n        data: req\n      });\n    }\n    next(function (done) {\n      var error = res.error;\n      if (!error) {\n        return done();\n      }\n      log.error(\"Torus - RPC Error: \".concat(error.message), error);\n      return done();\n    });\n  };\n}\n/**\n * Logs a stream disconnection error. Emits an 'error' if given an\n * EventEmitter that has listeners for the 'error' event.\n *\n * @param log - The logging API to use.\n * @param remoteLabel - The label of the disconnected stream.\n * @param error - The associated error to log.\n * @param emitter - The logging API to use.\n */\nfunction logStreamDisconnectWarning(remoteLabel, error, emitter) {\n  var warningMsg = \"Torus: Lost connection to \\\"\".concat(remoteLabel, \"\\\".\");\n  if (error !== null && error !== void 0 && error.stack) {\n    warningMsg += \"\\n\".concat(error.stack);\n  }\n  log.warn(warningMsg);\n  if (emitter && emitter.listenerCount(\"error\") > 0) {\n    emitter.emit(\"error\", warningMsg);\n  }\n}\nvar getWindowId = function getWindowId() {\n  return Math.random().toString(36).slice(2);\n};\nvar getTorusUrl = /*#__PURE__*/function () {\n  var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(buildEnv) {\n    var torusUrl, logLevel;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.t0 = buildEnv;\n            _context.next = _context.t0 === \"testing\" ? 3 : _context.t0 === \"development\" ? 6 : 9;\n            break;\n          case 3:\n            torusUrl = \"https://solana-testing.tor.us\";\n            logLevel = \"debug\";\n            return _context.abrupt(\"break\", 12);\n          case 6:\n            torusUrl = \"http://localhost:8080\";\n            logLevel = \"debug\";\n            return _context.abrupt(\"break\", 12);\n          case 9:\n            torusUrl = \"https://solana.tor.us\";\n            logLevel = \"error\";\n            return _context.abrupt(\"break\", 12);\n          case 12:\n            return _context.abrupt(\"return\", {\n              torusUrl: torusUrl,\n              logLevel: logLevel\n            });\n          case 13:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n  return function getTorusUrl(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nvar getUserLanguage = function getUserLanguage() {\n  var userLanguage = window.navigator.language || \"en-US\";\n  var userLanguages = userLanguage.split(\"-\");\n  userLanguage = Object.prototype.hasOwnProperty.call(configuration.translations, userLanguages[0]) ? userLanguages[0] : \"en\";\n  return userLanguage;\n};\nvar FEATURES_PROVIDER_CHANGE_WINDOW = {\n  height: 660,\n  width: 375\n};\nvar FEATURES_DEFAULT_WALLET_WINDOW = {\n  height: 740,\n  width: 1315\n};\nvar FEATURES_DEFAULT_POPUP_WINDOW = {\n  height: 700,\n  width: 1200\n};\nvar FEATURES_CONFIRM_WINDOW = {\n  height: 600,\n  width: 400\n};\nfunction storageAvailable(type) {\n  var storage;\n  try {\n    storage = window[type];\n    var x = \"__storage_test__\";\n    storage.setItem(x, x);\n    storage.removeItem(x);\n    return true;\n  } catch (e) {\n    return e && (\n    // everything except Firefox\n    e.code === 22 ||\n    // Firefox\n    e.code === 1014 ||\n    // test name field too, because code might not be present\n    // everything except Firefox\n    e.name === \"QuotaExceededError\" ||\n    // Firefox\n    e.name === \"NS_ERROR_DOM_QUOTA_REACHED\") &&\n    // acknowledge QuotaExceededError only if there's something already stored\n    storage && storage.length !== 0;\n  }\n}\n/**\n * popup handler utils\n */\nfunction getPopupFeatures(_ref) {\n  var w = _ref.width,\n    h = _ref.height;\n  // Fixes dual-screen position                             Most browsers      Firefox\n  var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : window.screenX;\n  var dualScreenTop = window.screenTop !== undefined ? window.screenTop : window.screenY;\n  var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : window.screen.width;\n  var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : window.screen.height;\n  var systemZoom = 1; // No reliable estimate\n  var left = Math.abs((width - w) / 2 / systemZoom + dualScreenLeft);\n  var top = Math.abs((height - h) / 2 / systemZoom + dualScreenTop);\n  var features = \"titlebar=0,toolbar=0,status=0,location=0,menubar=0,height=\".concat(h / systemZoom, \",width=\").concat(w / systemZoom, \",top=\").concat(top, \",left=\").concat(left);\n  return features;\n}\nvar BaseProvider = /*#__PURE__*/function (_SafeEventEmitter) {\n  _inherits(BaseProvider, _SafeEventEmitter);\n  var _super = _createSuper(BaseProvider);\n  /**\n   * Indicating that this provider is a Torus provider.\n   */\n\n  function BaseProvider(connectionStream, _ref) {\n    var _this;\n    _classCallCheck(this, BaseProvider);\n    var _ref$maxEventListener = _ref.maxEventListeners,\n      maxEventListeners = _ref$maxEventListener === void 0 ? 100 : _ref$maxEventListener,\n      _ref$jsonRpcStreamNam = _ref.jsonRpcStreamName,\n      jsonRpcStreamName = _ref$jsonRpcStreamNam === void 0 ? \"provider\" : _ref$jsonRpcStreamNam;\n    _this = _super.call(this);\n    _defineProperty(_assertThisInitialized(_this), \"isTorus\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_rpcEngine\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"jsonRpcConnectionEvents\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_state\", void 0);\n    if (!duplex(connectionStream)) {\n      throw new Error(messages.errors.invalidDuplexStream());\n    }\n    _this.isTorus = true;\n    _this.setMaxListeners(maxEventListeners);\n    _this._handleConnect = _this._handleConnect.bind(_assertThisInitialized(_this));\n    _this._handleDisconnect = _this._handleDisconnect.bind(_assertThisInitialized(_this));\n    _this._handleStreamDisconnect = _this._handleStreamDisconnect.bind(_assertThisInitialized(_this));\n    _this._rpcRequest = _this._rpcRequest.bind(_assertThisInitialized(_this));\n    _this._initializeState = _this._initializeState.bind(_assertThisInitialized(_this));\n    _this.request = _this.request.bind(_assertThisInitialized(_this));\n    _this.sendAsync = _this.sendAsync.bind(_assertThisInitialized(_this));\n    // this.enable = this.enable.bind(this);\n    // setup connectionStream multiplexing\n    var mux = new ObjectMultiplex();\n    pump(connectionStream, mux, connectionStream, _this._handleStreamDisconnect.bind(_assertThisInitialized(_this), \"Torus\"));\n    // ignore phishing warning message (handled elsewhere)\n    mux.ignoreStream(\"phishing\");\n    // setup own event listeners\n    // connect to async provider\n    var jsonRpcConnection = createStreamMiddleware();\n    pump(jsonRpcConnection.stream, mux.createStream(jsonRpcStreamName), jsonRpcConnection.stream, _this._handleStreamDisconnect.bind(_assertThisInitialized(_this), \"Torus RpcProvider\"));\n    // handle RPC requests via dapp-side rpc engine\n    var rpcEngine = new JRPCEngine();\n    rpcEngine.push(createIdRemapMiddleware());\n    rpcEngine.push(createErrorMiddleware());\n    rpcEngine.push(createLoggerMiddleware({\n      origin: location.origin\n    }));\n    rpcEngine.push(jsonRpcConnection.middleware);\n    _this._rpcEngine = rpcEngine;\n    _this.jsonRpcConnectionEvents = jsonRpcConnection.events;\n    return _this;\n  }\n  /**\n   * Submits an RPC request for the given method, with the given params.\n   * Resolves with the result of the method call, or rejects on error.\n   */\n  _createClass(BaseProvider, [{\n    key: \"request\",\n    value: function () {\n      var _request = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(args) {\n        var _this2 = this;\n        var method, params;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(!args || typeof args !== \"object\" || Array.isArray(args))) {\n                  _context2.next = 2;\n                  break;\n                }\n                throw ethErrors.rpc.invalidRequest({\n                  message: messages.errors.invalidRequestArgs(),\n                  data: args\n                });\n              case 2:\n                method = args.method, params = args.params;\n                if (!(typeof method !== \"string\" || method.length === 0)) {\n                  _context2.next = 5;\n                  break;\n                }\n                throw ethErrors.rpc.invalidRequest({\n                  message: messages.errors.invalidRequestMethod(),\n                  data: args\n                });\n              case 5:\n                if (!(params !== undefined && !Array.isArray(params) && (typeof params !== \"object\" || params === null))) {\n                  _context2.next = 7;\n                  break;\n                }\n                throw ethErrors.rpc.invalidRequest({\n                  message: messages.errors.invalidRequestParams(),\n                  data: args\n                });\n              case 7:\n                return _context2.abrupt(\"return\", new Promise(function (resolve, reject) {\n                  _this2._rpcRequest({\n                    method: method,\n                    params: params\n                  }, getRpcPromiseCallback(resolve, reject));\n                }));\n              case 8:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2);\n      }));\n      function request(_x2) {\n        return _request.apply(this, arguments);\n      }\n      return request;\n    }()\n    /**\n     * Submits an RPC request per the given JSON-RPC request object.\n     */\n  }, {\n    key: \"send\",\n    value: function send(payload, callback) {\n      this._rpcRequest(payload, callback);\n    }\n    /**\n     * Submits an RPC request per the given JSON-RPC request object.\n     */\n  }, {\n    key: \"sendAsync\",\n    value: function sendAsync(payload) {\n      var _this3 = this;\n      return new Promise(function (resolve, reject) {\n        _this3._rpcRequest(payload, getRpcPromiseCallback(resolve, reject));\n      });\n    }\n    /**\n     * Called when connection is lost to critical streams.\n     *\n     * emits TorusInpageProvider#disconnect\n     */\n  }, {\n    key: \"_handleStreamDisconnect\",\n    value: function _handleStreamDisconnect(streamName, error) {\n      logStreamDisconnectWarning(streamName, error, this);\n      this._handleDisconnect(false, error ? error.message : undefined);\n    }\n  }]);\n  return BaseProvider;\n}(SafeEventEmitter);\nvar handleEvent = function handleEvent(handle, eventName, handler) {\n  for (var _len = arguments.length, handlerArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n    handlerArgs[_key - 3] = arguments[_key];\n  }\n  var handlerWrapper = function handlerWrapper() {\n    handler.apply(void 0, handlerArgs);\n    handle.removeEventListener(eventName, handlerWrapper);\n  };\n  handle.addEventListener(eventName, handlerWrapper);\n};\nfunction documentReady() {\n  return _documentReady.apply(this, arguments);\n}\nfunction _documentReady() {\n  _documentReady = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee27() {\n    return _regeneratorRuntime().wrap(function _callee27$(_context27) {\n      while (1) {\n        switch (_context27.prev = _context27.next) {\n          case 0:\n            return _context27.abrupt(\"return\", new Promise(function (resolve) {\n              if (document.readyState !== \"loading\") {\n                resolve();\n              } else {\n                handleEvent(document, \"DOMContentLoaded\", resolve);\n              }\n            }));\n          case 1:\n          case \"end\":\n            return _context27.stop();\n        }\n      }\n    }, _callee27);\n  }));\n  return _documentReady.apply(this, arguments);\n}\nvar htmlToElement = function htmlToElement(html) {\n  var template = window.document.createElement(\"template\");\n  var trimmedHtml = html.trim(); // Never return a text node of whitespace as the result\n  template.innerHTML = trimmedHtml;\n  return template.content.firstChild;\n};\nvar PopupHandler = /*#__PURE__*/function (_SafeEventEmitter2) {\n  _inherits(PopupHandler, _SafeEventEmitter2);\n  var _super2 = _createSuper(PopupHandler);\n  function PopupHandler(_ref) {\n    var _this4;\n    _classCallCheck(this, PopupHandler);\n    var url = _ref.url,\n      target = _ref.target,\n      features = _ref.features;\n    _this4 = _super2.call(this);\n    _defineProperty(_assertThisInitialized(_this4), \"url\", void 0);\n    _defineProperty(_assertThisInitialized(_this4), \"target\", void 0);\n    _defineProperty(_assertThisInitialized(_this4), \"features\", void 0);\n    _defineProperty(_assertThisInitialized(_this4), \"window\", void 0);\n    _defineProperty(_assertThisInitialized(_this4), \"windowTimer\", void 0);\n    _defineProperty(_assertThisInitialized(_this4), \"iClosedWindow\", void 0);\n    _this4.url = url;\n    _this4.target = target || \"_blank\";\n    _this4.features = features || getPopupFeatures(FEATURES_DEFAULT_POPUP_WINDOW);\n    _this4.window = undefined;\n    _this4.windowTimer = undefined;\n    _this4.iClosedWindow = false;\n    _this4._setupTimer();\n    return _this4;\n  }\n  _createClass(PopupHandler, [{\n    key: \"_setupTimer\",\n    value: function _setupTimer() {\n      var _this5 = this;\n      this.windowTimer = Number(setInterval(function () {\n        if (_this5.window && _this5.window.closed) {\n          clearInterval(_this5.windowTimer);\n          if (!_this5.iClosedWindow) {\n            _this5.emit(\"close\");\n          }\n          _this5.iClosedWindow = false;\n          _this5.window = undefined;\n        }\n        if (_this5.window === undefined) clearInterval(_this5.windowTimer);\n      }, 500));\n    }\n  }, {\n    key: \"open\",\n    value: function open() {\n      var _this$window;\n      this.window = window.open(this.url.href, this.target, this.features);\n      if ((_this$window = this.window) !== null && _this$window !== void 0 && _this$window.focus) this.window.focus();\n      return Promise.resolve();\n    }\n  }, {\n    key: \"close\",\n    value: function close() {\n      this.iClosedWindow = true;\n      if (this.window) this.window.close();\n    }\n  }, {\n    key: \"redirect\",\n    value: function redirect(locationReplaceOnRedirect) {\n      if (locationReplaceOnRedirect) {\n        window.location.replace(this.url.href);\n      } else {\n        window.location.href = this.url.href;\n      }\n    }\n  }]);\n  return PopupHandler;\n}(SafeEventEmitter);\nfunction ownKeys$2(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$2(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$2(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar TorusCommunicationProvider = /*#__PURE__*/function (_BaseProvider) {\n  _inherits(TorusCommunicationProvider, _BaseProvider);\n  var _super3 = _createSuper(TorusCommunicationProvider);\n  function TorusCommunicationProvider(connectionStream, _ref) {\n    var _this6;\n    _classCallCheck(this, TorusCommunicationProvider);\n    var _ref$maxEventListener2 = _ref.maxEventListeners,\n      maxEventListeners = _ref$maxEventListener2 === void 0 ? 100 : _ref$maxEventListener2,\n      _ref$jsonRpcStreamNam2 = _ref.jsonRpcStreamName,\n      jsonRpcStreamName = _ref$jsonRpcStreamNam2 === void 0 ? \"provider\" : _ref$jsonRpcStreamNam2;\n    _this6 = _super3.call(this, connectionStream, {\n      maxEventListeners: maxEventListeners,\n      jsonRpcStreamName: jsonRpcStreamName\n    });\n    // private state\n    _defineProperty(_assertThisInitialized(_this6), \"embedTranslations\", void 0);\n    _defineProperty(_assertThisInitialized(_this6), \"torusUrl\", void 0);\n    _defineProperty(_assertThisInitialized(_this6), \"dappStorageKey\", void 0);\n    _defineProperty(_assertThisInitialized(_this6), \"windowRefs\", void 0);\n    _defineProperty(_assertThisInitialized(_this6), \"tryWindowHandle\", void 0);\n    _defineProperty(_assertThisInitialized(_this6), \"torusAlertContainer\", void 0);\n    _defineProperty(_assertThisInitialized(_this6), \"torusIframe\", void 0);\n    _this6._state = _objectSpread$2({}, TorusCommunicationProvider._defaultState);\n    // public state\n    _this6.torusUrl = \"\";\n    _this6.dappStorageKey = \"\";\n    var languageTranslations = configuration.translations[getUserLanguage()];\n    _this6.embedTranslations = languageTranslations.embed;\n    _this6.windowRefs = {};\n    // setup own event listeners\n    // EIP-1193 connect\n    _this6.on(\"connect\", function () {\n      _this6._state.isConnected = true;\n    });\n    var notificationHandler = function notificationHandler(payload) {\n      var method = payload.method,\n        params = payload.params;\n      if (method === COMMUNICATION_NOTIFICATIONS.IFRAME_STATUS) {\n        var isFullScreen = params.isFullScreen,\n          rid = params.rid;\n        _this6._displayIframe({\n          isFull: isFullScreen,\n          rid: rid\n        });\n      } else if (method === COMMUNICATION_NOTIFICATIONS.CREATE_WINDOW) {\n        var windowId = params.windowId,\n          url = params.url;\n        _this6._createPopupBlockAlert(windowId, url);\n      } else if (method === COMMUNICATION_NOTIFICATIONS.CLOSE_WINDOW) {\n        _this6._handleCloseWindow(params);\n      } else if (method === COMMUNICATION_NOTIFICATIONS.USER_LOGGED_IN) {\n        var currentLoginProvider = params.currentLoginProvider;\n        _this6._state.isLoggedIn = true;\n        _this6._state.currentLoginProvider = currentLoginProvider;\n      } else if (method === COMMUNICATION_NOTIFICATIONS.USER_LOGGED_OUT) {\n        _this6._state.isLoggedIn = false;\n        _this6._state.currentLoginProvider = null;\n        _this6._displayIframe();\n      }\n    };\n    _this6.jsonRpcConnectionEvents.on(\"notification\", notificationHandler);\n    return _this6;\n  }\n  _createClass(TorusCommunicationProvider, [{\n    key: \"isLoggedIn\",\n    get: function get() {\n      return this._state.isLoggedIn;\n    }\n  }, {\n    key: \"isIFrameFullScreen\",\n    get: function get() {\n      return this._state.isIFrameFullScreen;\n    }\n    /**\n     * Returns whether the inPage provider is connected to Torus.\n     */\n  }, {\n    key: \"isConnected\",\n    value: function isConnected() {\n      return this._state.isConnected;\n    }\n  }, {\n    key: \"_initializeState\",\n    value: function () {\n      var _initializeState2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(params) {\n        var _this7 = this;\n        var torusUrl, dappStorageKey, torusAlertContainer, torusIframe, _yield$this$request, currentLoginProvider, isLoggedIn;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                torusUrl = params.torusUrl, dappStorageKey = params.dappStorageKey, torusAlertContainer = params.torusAlertContainer, torusIframe = params.torusIframe;\n                this.torusUrl = torusUrl;\n                this.dappStorageKey = dappStorageKey;\n                this.torusAlertContainer = torusAlertContainer;\n                this.torusIframe = torusIframe;\n                this.torusIframe.addEventListener(\"load\", function () {\n                  // only do this if iframe is not full screen\n                  if (!_this7._state.isIFrameFullScreen) _this7._displayIframe();\n                });\n                _context3.next = 9;\n                return this.request({\n                  method: COMMUNICATION_JRPC_METHODS.GET_PROVIDER_STATE,\n                  params: []\n                });\n              case 9:\n                _yield$this$request = _context3.sent;\n                currentLoginProvider = _yield$this$request.currentLoginProvider;\n                isLoggedIn = _yield$this$request.isLoggedIn;\n                // indicate that we've connected, for EIP-1193 compliance\n                this._handleConnect(currentLoginProvider, isLoggedIn);\n                _context3.next = 18;\n                break;\n              case 15:\n                _context3.prev = 15;\n                _context3.t0 = _context3[\"catch\"](0);\n                log.error(\"Torus: Failed to get initial state. Please report this bug.\", _context3.t0);\n              case 18:\n                _context3.prev = 18;\n                log.info(\"initialized communication state\");\n                this._state.initialized = true;\n                this.emit(\"_initialized\");\n                return _context3.finish(18);\n              case 23:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 15, 18, 23]]);\n      }));\n      function _initializeState(_x3) {\n        return _initializeState2.apply(this, arguments);\n      }\n      return _initializeState;\n    }()\n  }, {\n    key: \"_handleWindow\",\n    value: function _handleWindow(windowId) {\n      var _this8 = this;\n      var _ref3 = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},\n        url = _ref3.url,\n        target = _ref3.target,\n        features = _ref3.features;\n      var finalUrl = new URL(url || \"\".concat(this.torusUrl, \"/redirect?windowId=\").concat(windowId));\n      if (this.dappStorageKey) {\n        // If multiple instances, it returns the first one\n        if (finalUrl.hash) finalUrl.hash += \"&dappStorageKey=\".concat(this.dappStorageKey);else finalUrl.hash = \"#dappStorageKey=\".concat(this.dappStorageKey);\n      }\n      var handledWindow = new PopupHandler({\n        url: finalUrl,\n        target: target,\n        features: features\n      });\n      handledWindow.open();\n      if (!handledWindow.window) {\n        this._createPopupBlockAlert(windowId, finalUrl.href);\n        return;\n      }\n      // Add to collection only if window is opened\n      this.windowRefs[windowId] = handledWindow;\n      // We tell the iframe that the window has been successfully opened\n      this.request({\n        method: COMMUNICATION_JRPC_METHODS.OPENED_WINDOW,\n        params: {\n          windowId: windowId\n        }\n      });\n      handledWindow.once(\"close\", function () {\n        // user closed the window\n        delete _this8.windowRefs[windowId];\n        _this8.request({\n          method: COMMUNICATION_JRPC_METHODS.CLOSED_WINDOW,\n          params: {\n            windowId: windowId\n          }\n        });\n      });\n    }\n  }, {\n    key: \"_displayIframe\",\n    value: function _displayIframe() {\n      var _ref4 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        _ref4$isFull = _ref4.isFull,\n        isFull = _ref4$isFull === void 0 ? false : _ref4$isFull,\n        _ref4$rid = _ref4.rid,\n        rid = _ref4$rid === void 0 ? \"\" : _ref4$rid;\n      var style = {};\n      // set phase\n      if (!isFull) {\n        style.display = this._state.torusWidgetVisibility ? \"block\" : \"none\";\n        style.height = \"70px\";\n        style.width = \"70px\";\n        switch (this._state.buttonPosition) {\n          case BUTTON_POSITION.TOP_LEFT:\n            style.top = \"0px\";\n            style.left = \"0px\";\n            style.right = \"auto\";\n            style.bottom = \"auto\";\n            break;\n          case BUTTON_POSITION.TOP_RIGHT:\n            style.top = \"0px\";\n            style.right = \"0px\";\n            style.left = \"auto\";\n            style.bottom = \"auto\";\n            break;\n          case BUTTON_POSITION.BOTTOM_RIGHT:\n            style.bottom = \"0px\";\n            style.right = \"0px\";\n            style.top = \"auto\";\n            style.left = \"auto\";\n            break;\n          case BUTTON_POSITION.BOTTOM_LEFT:\n          default:\n            style.bottom = \"0px\";\n            style.left = \"0px\";\n            style.top = \"auto\";\n            style.right = \"auto\";\n            break;\n        }\n      } else {\n        style.display = \"block\";\n        style.width = \"100%\";\n        style.height = \"100%\";\n        style.top = \"0px\";\n        style.right = \"0px\";\n        style.left = \"0px\";\n        style.bottom = \"0px\";\n      }\n      Object.assign(this.torusIframe.style, style);\n      this._state.isIFrameFullScreen = isFull;\n      this.request({\n        method: COMMUNICATION_JRPC_METHODS.IFRAME_STATUS,\n        params: {\n          isIFrameFullScreen: isFull,\n          rid: rid\n        }\n      });\n    }\n  }, {\n    key: \"hideTorusButton\",\n    value: function hideTorusButton() {\n      this._state.torusWidgetVisibility = false;\n      this._displayIframe();\n    }\n  }, {\n    key: \"showTorusButton\",\n    value: function showTorusButton() {\n      this._state.torusWidgetVisibility = true;\n      this._displayIframe();\n    }\n    /**\n     * Internal RPC method. Forwards requests to background via the RPC engine.\n     * Also remap ids inbound and outbound\n     */\n  }, {\n    key: \"_rpcRequest\",\n    value: function _rpcRequest(payload, callback) {\n      var cb = callback;\n      var _payload = payload;\n      if (!Array.isArray(_payload)) {\n        if (!_payload.jsonrpc) {\n          _payload.jsonrpc = \"2.0\";\n        }\n      }\n      this.tryWindowHandle(_payload, cb);\n    }\n    /**\n     * When the provider becomes connected, updates internal state and emits\n     * required events. Idempotent.\n     *\n     * @param currentLoginProvider - The login Provider\n     * emits TorusInpageProvider#connect\n     */\n  }, {\n    key: \"_handleConnect\",\n    value: function _handleConnect(currentLoginProvider, isLoggedIn) {\n      if (!this._state.isConnected) {\n        this._state.isConnected = true;\n        this.emit(\"connect\", {\n          currentLoginProvider: currentLoginProvider,\n          isLoggedIn: isLoggedIn\n        });\n        log.debug(messages.info.connected(currentLoginProvider));\n      }\n    }\n    /**\n     * When the provider becomes disconnected, updates internal state and emits\n     * required events. Idempotent with respect to the isRecoverable parameter.\n     *\n     * Error codes per the CloseEvent status codes as required by EIP-1193:\n     * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n     *\n     * @param isRecoverable - Whether the disconnection is recoverable.\n     * @param errorMessage - A custom error message.\n     * emits TorusInpageProvider#disconnect\n     */\n  }, {\n    key: \"_handleDisconnect\",\n    value: function _handleDisconnect(isRecoverable, errorMessage) {\n      if (this._state.isConnected || !this._state.isPermanentlyDisconnected && !isRecoverable) {\n        this._state.isConnected = false;\n        var error;\n        if (isRecoverable) {\n          error = new EthereumRpcError(1013,\n          // Try again later\n          errorMessage || messages.errors.disconnected());\n          log.debug(error);\n        } else {\n          error = new EthereumRpcError(1011,\n          // Internal error\n          errorMessage || messages.errors.permanentlyDisconnected());\n          log.error(error);\n          this._state.currentLoginProvider = null;\n          this._state.isLoggedIn = false;\n          this._state.torusWidgetVisibility = false;\n          this._state.isIFrameFullScreen = false;\n          this._state.isPermanentlyDisconnected = true;\n        }\n        this.emit(\"disconnect\", error);\n      }\n    }\n    // Called if the iframe wants to close the window cause it is done processing the request\n  }, {\n    key: \"_handleCloseWindow\",\n    value: function _handleCloseWindow(params) {\n      var windowId = params.windowId;\n      if (this.windowRefs[windowId]) {\n        this.windowRefs[windowId].close();\n        delete this.windowRefs[windowId];\n      }\n    }\n  }, {\n    key: \"_createPopupBlockAlert\",\n    value: function () {\n      var _createPopupBlockAlert2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(windowId, url) {\n        var _this9 = this;\n        var logoUrl, torusAlert, successAlert, btnContainer, bindOnLoad, attachOnLoad;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                logoUrl = this.getLogoUrl();\n                torusAlert = htmlToElement('<div id=\"torusAlert\" class=\"torus-alert--v2\">' + \"<div id=\\\"torusAlert__logo\\\"><img src=\\\"\".concat(logoUrl, \"\\\" /></div>\") + \"<div>\" + \"<h1 id=\\\"torusAlert__title\\\">\".concat(this.embedTranslations.actionRequired, \"</h1>\") + \"<p id=\\\"torusAlert__desc\\\">\".concat(this.embedTranslations.pendingAction, \"</p>\") + \"</div>\" + \"</div>\");\n                successAlert = htmlToElement(\"<div><a id=\\\"torusAlert__btn\\\">\".concat(this.embedTranslations.continue, \"</a></div>\"));\n                btnContainer = htmlToElement('<div id=\"torusAlert__btn-container\"></div>');\n                btnContainer.appendChild(successAlert);\n                torusAlert.appendChild(btnContainer);\n                bindOnLoad = function bindOnLoad() {\n                  successAlert.addEventListener(\"click\", function () {\n                    _this9._handleWindow(windowId, {\n                      url: url,\n                      target: \"_blank\",\n                      features: getPopupFeatures(FEATURES_CONFIRM_WINDOW)\n                    });\n                    torusAlert.remove();\n                    if (_this9.torusAlertContainer.children.length === 0) _this9.torusAlertContainer.style.display = \"none\";\n                  });\n                };\n                attachOnLoad = function attachOnLoad() {\n                  _this9.torusAlertContainer.appendChild(torusAlert);\n                };\n                _context4.next = 10;\n                return documentReady();\n              case 10:\n                attachOnLoad();\n                bindOnLoad();\n                this.torusAlertContainer.style.display = \"block\";\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this);\n      }));\n      function _createPopupBlockAlert(_x4, _x5) {\n        return _createPopupBlockAlert2.apply(this, arguments);\n      }\n      return _createPopupBlockAlert;\n    }()\n  }, {\n    key: \"getLogoUrl\",\n    value: function getLogoUrl() {\n      var logoUrl = \"\".concat(this.torusUrl, \"/images/torus_icon-blue.svg\");\n      return logoUrl;\n    }\n  }]);\n  return TorusCommunicationProvider;\n}(BaseProvider);\n_defineProperty(TorusCommunicationProvider, \"_defaultState\", {\n  buttonPosition: \"bottom-left\",\n  currentLoginProvider: null,\n  isIFrameFullScreen: false,\n  hasEmittedConnection: false,\n  torusWidgetVisibility: false,\n  initialized: false,\n  isLoggedIn: false,\n  isPermanentlyDisconnected: false,\n  isConnected: false\n});\nfunction ownKeys$1(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread$1(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys$1(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys$1(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar TorusInPageProvider = /*#__PURE__*/function (_BaseProvider2) {\n  _inherits(TorusInPageProvider, _BaseProvider2);\n  var _super4 = _createSuper(TorusInPageProvider);\n  /**\n   * The chain ID of the currently connected Solana chain.\n   * See [chainId.network]{@link https://chainid.network} for more information.\n   */\n\n  /**\n   * The user's currently selected Solana address.\n   * If null, Torus is either locked or the user has not permitted any\n   * addresses to be viewed.\n   */\n\n  function TorusInPageProvider(connectionStream, _ref) {\n    var _this10;\n    _classCallCheck(this, TorusInPageProvider);\n    var _ref$maxEventListener3 = _ref.maxEventListeners,\n      maxEventListeners = _ref$maxEventListener3 === void 0 ? 100 : _ref$maxEventListener3,\n      _ref$jsonRpcStreamNam3 = _ref.jsonRpcStreamName,\n      jsonRpcStreamName = _ref$jsonRpcStreamNam3 === void 0 ? \"provider\" : _ref$jsonRpcStreamNam3;\n    _this10 = _super4.call(this, connectionStream, {\n      maxEventListeners: maxEventListeners,\n      jsonRpcStreamName: jsonRpcStreamName\n    });\n    // private state\n    _defineProperty(_assertThisInitialized(_this10), \"chainId\", void 0);\n    _defineProperty(_assertThisInitialized(_this10), \"selectedAddress\", void 0);\n    _defineProperty(_assertThisInitialized(_this10), \"tryWindowHandle\", void 0);\n    _this10._state = _objectSpread$1({}, TorusInPageProvider._defaultState);\n    // public state\n    _this10.selectedAddress = null;\n    _this10.chainId = null;\n    _this10._handleAccountsChanged = _this10._handleAccountsChanged.bind(_assertThisInitialized(_this10));\n    _this10._handleChainChanged = _this10._handleChainChanged.bind(_assertThisInitialized(_this10));\n    _this10._handleUnlockStateChanged = _this10._handleUnlockStateChanged.bind(_assertThisInitialized(_this10));\n    // setup own event listeners\n    // EIP-1193 connect\n    _this10.on(\"connect\", function () {\n      _this10._state.isConnected = true;\n    });\n    var jsonRpcNotificationHandler = function jsonRpcNotificationHandler(payload) {\n      var method = payload.method,\n        params = payload.params;\n      if (method === PROVIDER_NOTIFICATIONS.ACCOUNTS_CHANGED) {\n        _this10._handleAccountsChanged(params);\n      } else if (method === PROVIDER_NOTIFICATIONS.UNLOCK_STATE_CHANGED) {\n        _this10._handleUnlockStateChanged(params);\n      } else if (method === PROVIDER_NOTIFICATIONS.CHAIN_CHANGED) {\n        _this10._handleChainChanged(params);\n      }\n    };\n    // json rpc notification listener\n    _this10.jsonRpcConnectionEvents.on(\"notification\", jsonRpcNotificationHandler);\n    return _this10;\n  }\n  /**\n   * Returns whether the inpage provider is connected to Torus.\n   */\n  _createClass(TorusInPageProvider, [{\n    key: \"isConnected\",\n    value: function isConnected() {\n      return this._state.isConnected;\n    }\n    // Private Methods\n    //= ===================\n    /**\n     * Constructor helper.\n     * Populates initial state by calling 'wallet_getProviderState' and emits\n     * necessary events.\n     */\n  }, {\n    key: \"_initializeState\",\n    value: function () {\n      var _initializeState3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5() {\n        var _yield$this$request2, accounts, chainId, isUnlocked;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                _context5.prev = 0;\n                _context5.next = 3;\n                return this.request({\n                  method: PROVIDER_JRPC_METHODS.GET_PROVIDER_STATE,\n                  params: []\n                });\n              case 3:\n                _yield$this$request2 = _context5.sent;\n                accounts = _yield$this$request2.accounts;\n                chainId = _yield$this$request2.chainId;\n                isUnlocked = _yield$this$request2.isUnlocked;\n                // indicate that we've connected, for EIP-1193 compliance\n                this.emit(\"connect\", {\n                  chainId: chainId\n                });\n                this._handleChainChanged({\n                  chainId: chainId\n                });\n                this._handleUnlockStateChanged({\n                  accounts: accounts,\n                  isUnlocked: isUnlocked\n                });\n                this._handleAccountsChanged(accounts);\n                _context5.next = 16;\n                break;\n              case 13:\n                _context5.prev = 13;\n                _context5.t0 = _context5[\"catch\"](0);\n                log.error(\"Torus: Failed to get initial state. Please report this bug.\", _context5.t0);\n              case 16:\n                _context5.prev = 16;\n                log.info(\"initialized provider state\");\n                this._state.initialized = true;\n                this.emit(\"_initialized\");\n                return _context5.finish(16);\n              case 21:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this, [[0, 13, 16, 21]]);\n      }));\n      function _initializeState() {\n        return _initializeState3.apply(this, arguments);\n      }\n      return _initializeState;\n    }()\n    /**\n     * Internal RPC method. Forwards requests to background via the RPC engine.\n     * Also remap ids inbound and outbound\n     */\n  }, {\n    key: \"_rpcRequest\",\n    value: function _rpcRequest(payload, callback) {\n      var _this11 = this;\n      var isInternal = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      var cb = callback;\n      var _payload = payload;\n      if (!Array.isArray(_payload)) {\n        if (!_payload.jsonrpc) {\n          _payload.jsonrpc = \"2.0\";\n        }\n        if (_payload.method === \"solana_accounts\" || _payload.method === \"solana_requestAccounts\") {\n          // handle accounts changing\n          cb = function cb(err, res) {\n            _this11._handleAccountsChanged(res.result || [], _payload.method === \"solana_accounts\", isInternal);\n            callback(err, res);\n          };\n        } else if (_payload.method === \"wallet_getProviderState\") {\n          this._rpcEngine.handle(payload, cb);\n          return;\n        }\n      }\n      this.tryWindowHandle(_payload, cb);\n    }\n    /**\n     * When the provider becomes connected, updates internal state and emits\n     * required events. Idempotent.\n     *\n     * @param chainId - The ID of the newly connected chain.\n     * emits TorusInpageProvider#connect\n     */\n  }, {\n    key: \"_handleConnect\",\n    value: function _handleConnect(chainId) {\n      if (!this._state.isConnected) {\n        this._state.isConnected = true;\n        this.emit(\"connect\", {\n          chainId: chainId\n        });\n        log.debug(messages.info.connected(chainId));\n      }\n    }\n    /**\n     * When the provider becomes disconnected, updates internal state and emits\n     * required events. Idempotent with respect to the isRecoverable parameter.\n     *\n     * Error codes per the CloseEvent status codes as required by EIP-1193:\n     * https://developer.mozilla.org/en-US/docs/Web/API/CloseEvent#Status_codes\n     *\n     * @param isRecoverable - Whether the disconnection is recoverable.\n     * @param errorMessage - A custom error message.\n     * emits TorusInpageProvider#disconnect\n     */\n  }, {\n    key: \"_handleDisconnect\",\n    value: function _handleDisconnect(isRecoverable, errorMessage) {\n      if (this._state.isConnected || !this._state.isPermanentlyDisconnected && !isRecoverable) {\n        this._state.isConnected = false;\n        var error;\n        if (isRecoverable) {\n          error = new EthereumRpcError(1013,\n          // Try again later\n          errorMessage || messages.errors.disconnected());\n          log.debug(error);\n        } else {\n          error = new EthereumRpcError(1011,\n          // Internal error\n          errorMessage || messages.errors.permanentlyDisconnected());\n          log.error(error);\n          this.chainId = null;\n          this._state.accounts = null;\n          this.selectedAddress = null;\n          this._state.isUnlocked = false;\n          this._state.isPermanentlyDisconnected = true;\n        }\n        this.emit(\"disconnect\", error);\n      }\n    }\n    /**\n     * Called when accounts may have changed.\n     */\n  }, {\n    key: \"_handleAccountsChanged\",\n    value: function _handleAccountsChanged(accounts) {\n      var isEthAccounts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n      var isInternal = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n      // defensive programming\n      var finalAccounts = accounts;\n      if (!Array.isArray(finalAccounts)) {\n        log.error(\"Torus: Received non-array accounts parameter. Please report this bug.\", finalAccounts);\n        finalAccounts = [];\n      }\n      var _iterator = _createForOfIteratorHelper(accounts),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var account = _step.value;\n          if (typeof account !== \"string\") {\n            log.error(\"Torus: Received non-string account. Please report this bug.\", accounts);\n            finalAccounts = [];\n            break;\n          }\n        }\n        // emit accountsChanged if anything about the accounts array has changed\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      if (!dequal(this._state.accounts, finalAccounts)) {\n        // we should always have the correct accounts even before solana_accounts\n        // returns, except in cases where isInternal is true\n        if (isEthAccounts && Array.isArray(this._state.accounts) && this._state.accounts.length > 0 && !isInternal) {\n          log.error('Torus: \"solana_accounts\" unexpectedly updated accounts. Please report this bug.', finalAccounts);\n        }\n        this._state.accounts = finalAccounts;\n        this.emit(\"accountsChanged\", finalAccounts);\n      }\n      // handle selectedAddress\n      if (this.selectedAddress !== finalAccounts[0]) {\n        this.selectedAddress = finalAccounts[0] || null;\n      }\n    }\n    /**\n     * Upon receipt of a new chainId and networkVersion, emits corresponding\n     * events and sets relevant public state.\n     * Does nothing if neither the chainId nor the networkVersion are different\n     * from existing values.\n     *\n     * emits TorusInpageProvider#chainChanged\n     * @param networkInfo - An object with network info.\n     */\n  }, {\n    key: \"_handleChainChanged\",\n    value: function _handleChainChanged() {\n      var _ref5 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        chainId = _ref5.chainId;\n      if (!chainId) {\n        log.error(\"Torus: Received invalid network parameters. Please report this bug.\", {\n          chainId: chainId\n        });\n        return;\n      }\n      if (chainId === \"loading\") {\n        this._handleDisconnect(true);\n      } else {\n        this._handleConnect(chainId);\n        if (chainId !== this.chainId) {\n          this.chainId = chainId;\n          if (this._state.initialized) {\n            this.emit(\"chainChanged\", this.chainId);\n          }\n        }\n      }\n    }\n    /**\n     * Upon receipt of a new isUnlocked state, sets relevant public state.\n     * Calls the accounts changed handler with the received accounts, or an empty\n     * array.\n     *\n     * Does nothing if the received value is equal to the existing value.\n     * There are no lock/unlock events.\n     *\n     * @param opts - Options bag.\n     */\n  }, {\n    key: \"_handleUnlockStateChanged\",\n    value: function _handleUnlockStateChanged() {\n      var _ref6 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n        accounts = _ref6.accounts,\n        isUnlocked = _ref6.isUnlocked;\n      if (typeof isUnlocked !== \"boolean\") {\n        log.error(\"Torus: Received invalid isUnlocked parameter. Please report this bug.\", {\n          isUnlocked: isUnlocked\n        });\n        return;\n      }\n      if (isUnlocked !== this._state.isUnlocked) {\n        this._state.isUnlocked = isUnlocked;\n        this._handleAccountsChanged(accounts || []);\n      }\n    }\n  }]);\n  return TorusInPageProvider;\n}(BaseProvider);\n_defineProperty(TorusInPageProvider, \"_defaultState\", {\n  accounts: null,\n  isConnected: false,\n  isUnlocked: false,\n  initialized: false,\n  isPermanentlyDisconnected: false,\n  hasEmittedConnection: false\n});\n\n/**\n * Returns whether the given image URL exists\n */\nfunction imgExists(url) {\n  return new Promise(function (resolve, reject) {\n    try {\n      var img = document.createElement(\"img\");\n      img.onload = function () {\n        return resolve(true);\n      };\n      img.onerror = function () {\n        return resolve(false);\n      };\n      img.src = url;\n    } catch (e) {\n      reject(e);\n    }\n  });\n}\n/**\n * Extracts a name for the site from the DOM\n */\nvar getSiteName = function getSiteName(window) {\n  var document = window.document;\n  var siteName = document.querySelector('head > meta[property=\"og:site_name\"]');\n  if (siteName) {\n    return siteName.content;\n  }\n  var metaTitle = document.querySelector('head > meta[name=\"title\"]');\n  if (metaTitle) {\n    return metaTitle.content;\n  }\n  if (document.title && document.title.length > 0) {\n    return document.title;\n  }\n  return window.location.hostname;\n};\n/**\n * Extracts an icon for the site from the DOM\n */\nfunction getSiteIcon(_x6) {\n  return _getSiteIcon.apply(this, arguments);\n}\n/**\n * Gets site metadata and returns it\n *\n */\nfunction _getSiteIcon() {\n  _getSiteIcon = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee28(window) {\n    var _document, icon;\n    return _regeneratorRuntime().wrap(function _callee28$(_context28) {\n      while (1) {\n        switch (_context28.prev = _context28.next) {\n          case 0:\n            _context28.prev = 0;\n            _document = window.document; // Use the site's favicon if it exists\n            icon = _document.querySelector('head > link[rel=\"shortcut icon\"]');\n            _context28.t0 = icon;\n            if (!_context28.t0) {\n              _context28.next = 8;\n              break;\n            }\n            _context28.next = 7;\n            return imgExists(icon.href);\n          case 7:\n            _context28.t0 = _context28.sent;\n          case 8:\n            if (!_context28.t0) {\n              _context28.next = 10;\n              break;\n            }\n            return _context28.abrupt(\"return\", icon.href);\n          case 10:\n            // Search through available icons in no particular order\n            icon = Array.from(_document.querySelectorAll('head > link[rel=\"icon\"]')).find(function (_icon) {\n              return Boolean(_icon.href);\n            });\n            _context28.t1 = icon;\n            if (!_context28.t1) {\n              _context28.next = 16;\n              break;\n            }\n            _context28.next = 15;\n            return imgExists(icon.href);\n          case 15:\n            _context28.t1 = _context28.sent;\n          case 16:\n            if (!_context28.t1) {\n              _context28.next = 18;\n              break;\n            }\n            return _context28.abrupt(\"return\", icon.href);\n          case 18:\n            return _context28.abrupt(\"return\", \"\");\n          case 21:\n            _context28.prev = 21;\n            _context28.t2 = _context28[\"catch\"](0);\n            return _context28.abrupt(\"return\", \"\");\n          case 24:\n          case \"end\":\n            return _context28.stop();\n        }\n      }\n    }, _callee28, null, [[0, 21]]);\n  }));\n  return _getSiteIcon.apply(this, arguments);\n}\nvar getSiteMetadata = /*#__PURE__*/function () {\n  var _ref7 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6() {\n    return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n      while (1) {\n        switch (_context6.prev = _context6.next) {\n          case 0:\n            _context6.t0 = getSiteName(window);\n            _context6.next = 3;\n            return getSiteIcon(window);\n          case 3:\n            _context6.t1 = _context6.sent;\n            return _context6.abrupt(\"return\", {\n              name: _context6.t0,\n              icon: _context6.t1\n            });\n          case 5:\n          case \"end\":\n            return _context6.stop();\n        }\n      }\n    }, _callee6);\n  }));\n  return function getSiteMetadata() {\n    return _ref7.apply(this, arguments);\n  };\n}();\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nvar PROVIDER_UNSAFE_METHODS = [\"send_transaction\", \"sign_transaction\", \"sign_all_transactions\", \"sign_message\", \"connect\"];\nvar COMMUNICATION_UNSAFE_METHODS = [COMMUNICATION_JRPC_METHODS.SET_PROVIDER];\nvar isLocalStorageAvailable = storageAvailable(\"localStorage\");\n// preload for iframe doesn't work https://bugs.chromium.org/p/chromium/issues/detail?id=593267\n(function () {\n  var _preLoadIframe = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee7() {\n    var torusIframeHtml, _yield$getTorusUrl, torusUrl;\n    return _regeneratorRuntime().wrap(function _callee7$(_context7) {\n      while (1) {\n        switch (_context7.prev = _context7.next) {\n          case 0:\n            _context7.prev = 0;\n            if (!(typeof document === \"undefined\")) {\n              _context7.next = 3;\n              break;\n            }\n            return _context7.abrupt(\"return\");\n          case 3:\n            torusIframeHtml = document.createElement(\"link\");\n            _context7.next = 6;\n            return getTorusUrl(\"production\");\n          case 6:\n            _yield$getTorusUrl = _context7.sent;\n            torusUrl = _yield$getTorusUrl.torusUrl;\n            torusIframeHtml.href = \"\".concat(torusUrl, \"/frame\");\n            torusIframeHtml.crossOrigin = \"anonymous\";\n            torusIframeHtml.type = \"text/html\";\n            torusIframeHtml.rel = \"prefetch\";\n            if (torusIframeHtml.relList && torusIframeHtml.relList.supports) {\n              if (torusIframeHtml.relList.supports(\"prefetch\")) {\n                document.head.appendChild(torusIframeHtml);\n              }\n            }\n            _context7.next = 18;\n            break;\n          case 15:\n            _context7.prev = 15;\n            _context7.t0 = _context7[\"catch\"](0);\n            log.warn(_context7.t0);\n          case 18:\n          case \"end\":\n            return _context7.stop();\n        }\n      }\n    }, _callee7, null, [[0, 15]]);\n  }));\n  function preLoadIframe() {\n    return _preLoadIframe.apply(this, arguments);\n  }\n  return preLoadIframe;\n})()();\nvar Torus = /*#__PURE__*/function () {\n  function Torus() {\n    _classCallCheck(this, Torus);\n    var _ref8 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n      _ref8$modalZIndex = _ref8.modalZIndex,\n      modalZIndex = _ref8$modalZIndex === void 0 ? 99999 : _ref8$modalZIndex;\n    _defineProperty(this, \"isInitialized\", void 0);\n    _defineProperty(this, \"torusAlert\", void 0);\n    _defineProperty(this, \"modalZIndex\", void 0);\n    _defineProperty(this, \"alertZIndex\", void 0);\n    _defineProperty(this, \"requestedLoginProvider\", void 0);\n    _defineProperty(this, \"provider\", void 0);\n    _defineProperty(this, \"communicationProvider\", void 0);\n    _defineProperty(this, \"dappStorageKey\", void 0);\n    _defineProperty(this, \"isTopupHidden\", false);\n    _defineProperty(this, \"torusAlertContainer\", void 0);\n    _defineProperty(this, \"torusUrl\", void 0);\n    _defineProperty(this, \"torusIframe\", void 0);\n    _defineProperty(this, \"styleLink\", void 0);\n    this.torusUrl = \"\";\n    this.isInitialized = false; // init done\n    this.requestedLoginProvider = null;\n    this.modalZIndex = modalZIndex;\n    this.alertZIndex = modalZIndex + 1000;\n    this.dappStorageKey = \"\";\n  }\n  _createClass(Torus, [{\n    key: \"isLoggedIn\",\n    get: function get() {\n      if (!this.communicationProvider) return false;\n      return this.communicationProvider.isLoggedIn;\n    }\n  }, {\n    key: \"init\",\n    value: function () {\n      var _init = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee10() {\n        var _this12 = this;\n        var _ref9,\n          _ref9$buildEnv,\n          buildEnv,\n          _ref9$enableLogging,\n          enableLogging,\n          network,\n          _ref9$showTorusButton,\n          showTorusButton,\n          _ref9$useLocalStorage,\n          useLocalStorage,\n          _ref9$buttonPosition,\n          buttonPosition,\n          _ref9$apiKey,\n          apiKey,\n          _ref9$extraParams,\n          extraParams,\n          whiteLabel,\n          _yield$getTorusUrl2,\n          torusUrl,\n          logLevel,\n          dappStorageKey,\n          torusIframeUrl,\n          hashParams,\n          handleSetup,\n          _args10 = arguments;\n        return _regeneratorRuntime().wrap(function _callee10$(_context10) {\n          while (1) {\n            switch (_context10.prev = _context10.next) {\n              case 0:\n                _ref9 = _args10.length > 0 && _args10[0] !== undefined ? _args10[0] : {}, _ref9$buildEnv = _ref9.buildEnv, buildEnv = _ref9$buildEnv === void 0 ? TORUS_BUILD_ENV.PRODUCTION : _ref9$buildEnv, _ref9$enableLogging = _ref9.enableLogging, enableLogging = _ref9$enableLogging === void 0 ? false : _ref9$enableLogging, network = _ref9.network, _ref9$showTorusButton = _ref9.showTorusButton, showTorusButton = _ref9$showTorusButton === void 0 ? false : _ref9$showTorusButton, _ref9$useLocalStorage = _ref9.useLocalStorage, useLocalStorage = _ref9$useLocalStorage === void 0 ? false : _ref9$useLocalStorage, _ref9$buttonPosition = _ref9.buttonPosition, buttonPosition = _ref9$buttonPosition === void 0 ? BUTTON_POSITION.BOTTOM_LEFT : _ref9$buttonPosition, _ref9$apiKey = _ref9.apiKey, apiKey = _ref9$apiKey === void 0 ? \"torus-default\" : _ref9$apiKey, _ref9$extraParams = _ref9.extraParams, extraParams = _ref9$extraParams === void 0 ? {} : _ref9$extraParams, whiteLabel = _ref9.whiteLabel;\n                if (!this.isInitialized) {\n                  _context10.next = 3;\n                  break;\n                }\n                throw new Error(\"Already initialized\");\n              case 3:\n                setAPIKey(apiKey);\n                _context10.next = 6;\n                return getTorusUrl(buildEnv);\n              case 6:\n                _yield$getTorusUrl2 = _context10.sent;\n                torusUrl = _yield$getTorusUrl2.torusUrl;\n                logLevel = _yield$getTorusUrl2.logLevel;\n                log.enableAll();\n                log.info(torusUrl, \"url loaded\");\n                log.info(\"Solana Embed Version :\".concat(version));\n                this.torusUrl = torusUrl;\n                log.setDefaultLevel(logLevel);\n                if (enableLogging) log.enableAll();else log.disableAll();\n                dappStorageKey = this.handleDappStorageKey(useLocalStorage);\n                torusIframeUrl = new URL(torusUrl);\n                if (torusIframeUrl.pathname.endsWith(\"/\")) torusIframeUrl.pathname += \"frame\";else torusIframeUrl.pathname += \"/frame\";\n                hashParams = new URLSearchParams();\n                if (dappStorageKey) hashParams.append(\"dappStorageKey\", dappStorageKey);\n                hashParams.append(\"origin\", window.location.origin);\n                torusIframeUrl.hash = hashParams.toString();\n                // Iframe code\n                this.torusIframe = htmlToElement(\"<iframe\\n        id=\\\"torusIframe\\\"\\n        class=\\\"torusIframe\\\"\\n        src=\\\"\".concat(torusIframeUrl.href, \"\\\"\\n        style=\\\"display: none; position: fixed; top: 0; right: 0; width: 100%;\\n        height: 100%; border: none; border-radius: 0; z-index: \").concat(this.modalZIndex.toString(), \"\\\"\\n      ></iframe>\"));\n                this.torusAlertContainer = htmlToElement(\"<div id=\\\"torusAlertContainer\\\" style=\\\"display:none; z-index: \".concat(this.alertZIndex.toString(), \"\\\"></div>\"));\n                this.styleLink = htmlToElement(\"<link href=\\\"\".concat(torusUrl, \"/css/widget.css\\\" rel=\\\"stylesheet\\\" type=\\\"text/css\\\">\"));\n                handleSetup = /*#__PURE__*/function () {\n                  var _ref10 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee9() {\n                    return _regeneratorRuntime().wrap(function _callee9$(_context9) {\n                      while (1) {\n                        switch (_context9.prev = _context9.next) {\n                          case 0:\n                            return _context9.abrupt(\"return\", new Promise(function (resolve, reject) {\n                              try {\n                                window.document.head.appendChild(_this12.styleLink);\n                                window.document.body.appendChild(_this12.torusIframe);\n                                window.document.body.appendChild(_this12.torusAlertContainer);\n                                _this12.torusIframe.addEventListener(\"load\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee8() {\n                                  var dappMetadata;\n                                  return _regeneratorRuntime().wrap(function _callee8$(_context8) {\n                                    while (1) {\n                                      switch (_context8.prev = _context8.next) {\n                                        case 0:\n                                          _context8.next = 2;\n                                          return getSiteMetadata();\n                                        case 2:\n                                          dappMetadata = _context8.sent;\n                                          // send init params here\n                                          _this12.torusIframe.contentWindow.postMessage({\n                                            buttonPosition: buttonPosition,\n                                            apiKey: apiKey,\n                                            network: network,\n                                            dappMetadata: dappMetadata,\n                                            extraParams: extraParams,\n                                            whiteLabel: whiteLabel\n                                          }, torusIframeUrl.origin);\n                                          _context8.next = 6;\n                                          return _this12._setupWeb3({\n                                            torusUrl: torusUrl\n                                          });\n                                        case 6:\n                                          if (showTorusButton) _this12.showTorusButton();\n                                          if (whiteLabel !== null && whiteLabel !== void 0 && whiteLabel.topupHide) _this12.isTopupHidden = whiteLabel.topupHide;else _this12.hideTorusButton();\n                                          _this12.isInitialized = true;\n                                          window.torus = _this12;\n                                          resolve();\n                                        case 11:\n                                        case \"end\":\n                                          return _context8.stop();\n                                      }\n                                    }\n                                  }, _callee8);\n                                })));\n                              } catch (error) {\n                                reject(error);\n                              }\n                            }));\n                          case 1:\n                          case \"end\":\n                            return _context9.stop();\n                        }\n                      }\n                    }, _callee9);\n                  }));\n                  return function handleSetup() {\n                    return _ref10.apply(this, arguments);\n                  };\n                }();\n                _context10.next = 28;\n                return documentReady();\n              case 28:\n                _context10.next = 30;\n                return handleSetup();\n              case 30:\n              case \"end\":\n                return _context10.stop();\n            }\n          }\n        }, _callee10, this);\n      }));\n      function init() {\n        return _init.apply(this, arguments);\n      }\n      return init;\n    }()\n  }, {\n    key: \"login\",\n    value: function () {\n      var _login = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee11() {\n        var _this13 = this;\n        var params,\n          res,\n          _args11 = arguments;\n        return _regeneratorRuntime().wrap(function _callee11$(_context11) {\n          while (1) {\n            switch (_context11.prev = _context11.next) {\n              case 0:\n                params = _args11.length > 0 && _args11[0] !== undefined ? _args11[0] : {};\n                if (this.isInitialized) {\n                  _context11.next = 3;\n                  break;\n                }\n                throw new Error(\"Call init() first\");\n              case 3:\n                _context11.prev = 3;\n                this.requestedLoginProvider = params.loginProvider || null;\n                if (!this.requestedLoginProvider) {\n                  this.communicationProvider._displayIframe({\n                    isFull: true\n                  });\n                }\n                // If user is already logged in, we assume they have given access to the website\n                _context11.next = 8;\n                return new Promise(function (resolve, reject) {\n                  // We use this method because we want to update inPage provider state with account info\n                  _this13.provider._rpcRequest({\n                    method: \"solana_requestAccounts\",\n                    params: [_this13.requestedLoginProvider, params.login_hint]\n                  }, getRpcPromiseCallback(resolve, reject));\n                });\n              case 8:\n                res = _context11.sent;\n                if (!(Array.isArray(res) && res.length > 0)) {\n                  _context11.next = 11;\n                  break;\n                }\n                return _context11.abrupt(\"return\", res);\n              case 11:\n                throw new Error(\"Login failed\");\n              case 14:\n                _context11.prev = 14;\n                _context11.t0 = _context11[\"catch\"](3);\n                log.error(\"login failed\", _context11.t0);\n                throw _context11.t0;\n              case 18:\n                _context11.prev = 18;\n                if (this.communicationProvider.isIFrameFullScreen) this.communicationProvider._displayIframe();\n                return _context11.finish(18);\n              case 21:\n              case \"end\":\n                return _context11.stop();\n            }\n          }\n        }, _callee11, this, [[3, 14, 18, 21]]);\n      }));\n      function login() {\n        return _login.apply(this, arguments);\n      }\n      return login;\n    }()\n  }, {\n    key: \"loginWithPrivateKey\",\n    value: function () {\n      var _loginWithPrivateKey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee12(loginParams) {\n        var privateKey, userInfo, _yield$this$communica, success;\n        return _regeneratorRuntime().wrap(function _callee12$(_context12) {\n          while (1) {\n            switch (_context12.prev = _context12.next) {\n              case 0:\n                if (this.isInitialized) {\n                  _context12.next = 2;\n                  break;\n                }\n                throw new Error(\"Call init() first\");\n              case 2:\n                privateKey = loginParams.privateKey, userInfo = loginParams.userInfo;\n                _context12.next = 5;\n                return this.communicationProvider.request({\n                  method: \"login_with_private_key\",\n                  params: {\n                    privateKey: privateKey,\n                    userInfo: userInfo\n                  }\n                });\n              case 5:\n                _yield$this$communica = _context12.sent;\n                success = _yield$this$communica.success;\n                if (success) {\n                  _context12.next = 9;\n                  break;\n                }\n                throw new Error(\"Login Failed\");\n              case 9:\n              case \"end\":\n                return _context12.stop();\n            }\n          }\n        }, _callee12, this);\n      }));\n      function loginWithPrivateKey(_x7) {\n        return _loginWithPrivateKey.apply(this, arguments);\n      }\n      return loginWithPrivateKey;\n    }()\n  }, {\n    key: \"logout\",\n    value: function () {\n      var _logout = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee13() {\n        return _regeneratorRuntime().wrap(function _callee13$(_context13) {\n          while (1) {\n            switch (_context13.prev = _context13.next) {\n              case 0:\n                if (this.communicationProvider.isLoggedIn) {\n                  _context13.next = 2;\n                  break;\n                }\n                throw new Error(\"Not logged in\");\n              case 2:\n                _context13.next = 4;\n                return this.communicationProvider.request({\n                  method: COMMUNICATION_JRPC_METHODS.LOGOUT,\n                  params: []\n                });\n              case 4:\n                this.requestedLoginProvider = null;\n              case 5:\n              case \"end\":\n                return _context13.stop();\n            }\n          }\n        }, _callee13, this);\n      }));\n      function logout() {\n        return _logout.apply(this, arguments);\n      }\n      return logout;\n    }()\n  }, {\n    key: \"cleanUp\",\n    value: function () {\n      var _cleanUp = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee14() {\n        return _regeneratorRuntime().wrap(function _callee14$(_context14) {\n          while (1) {\n            switch (_context14.prev = _context14.next) {\n              case 0:\n                if (!this.communicationProvider.isLoggedIn) {\n                  _context14.next = 3;\n                  break;\n                }\n                _context14.next = 3;\n                return this.logout();\n              case 3:\n                this.clearInit();\n              case 4:\n              case \"end\":\n                return _context14.stop();\n            }\n          }\n        }, _callee14, this);\n      }));\n      function cleanUp() {\n        return _cleanUp.apply(this, arguments);\n      }\n      return cleanUp;\n    }()\n  }, {\n    key: \"clearInit\",\n    value: function clearInit() {\n      function isElement(element) {\n        return element instanceof Element || element instanceof Document;\n      }\n      if (isElement(this.styleLink) && window.document.body.contains(this.styleLink)) {\n        this.styleLink.remove();\n        this.styleLink = undefined;\n      }\n      if (isElement(this.torusIframe) && window.document.body.contains(this.torusIframe)) {\n        this.torusIframe.remove();\n        this.torusIframe = undefined;\n      }\n      if (isElement(this.torusAlertContainer) && window.document.body.contains(this.torusAlertContainer)) {\n        this.torusAlert = undefined;\n        this.torusAlertContainer.remove();\n        this.torusAlertContainer = undefined;\n      }\n      this.isInitialized = false;\n    }\n  }, {\n    key: \"hideTorusButton\",\n    value: function hideTorusButton() {\n      this.communicationProvider.hideTorusButton();\n    }\n  }, {\n    key: \"showTorusButton\",\n    value: function showTorusButton() {\n      this.communicationProvider.showTorusButton();\n    }\n  }, {\n    key: \"setProvider\",\n    value: function () {\n      var _setProvider = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee15(params) {\n        return _regeneratorRuntime().wrap(function _callee15$(_context15) {\n          while (1) {\n            switch (_context15.prev = _context15.next) {\n              case 0:\n                _context15.next = 2;\n                return this.communicationProvider.request({\n                  method: COMMUNICATION_JRPC_METHODS.SET_PROVIDER,\n                  params: _objectSpread({}, params)\n                });\n              case 2:\n              case \"end\":\n                return _context15.stop();\n            }\n          }\n        }, _callee15, this);\n      }));\n      function setProvider(_x8) {\n        return _setProvider.apply(this, arguments);\n      }\n      return setProvider;\n    }()\n  }, {\n    key: \"showWallet\",\n    value: function () {\n      var _showWallet = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee16(path) {\n        var params,\n          instanceId,\n          finalPath,\n          finalUrl,\n          walletWindow,\n          _args16 = arguments;\n        return _regeneratorRuntime().wrap(function _callee16$(_context16) {\n          while (1) {\n            switch (_context16.prev = _context16.next) {\n              case 0:\n                params = _args16.length > 1 && _args16[1] !== undefined ? _args16[1] : {};\n                _context16.next = 3;\n                return this.communicationProvider.request({\n                  method: COMMUNICATION_JRPC_METHODS.WALLET_INSTANCE_ID,\n                  params: []\n                });\n              case 3:\n                instanceId = _context16.sent;\n                finalPath = path ? \"/\".concat(path) : \"\";\n                finalUrl = new URL(\"\".concat(this.torusUrl, \"/wallet\").concat(finalPath)); // Using URL constructor to prevent js injection and allow parameter validation.!\n                finalUrl.searchParams.append(\"instanceId\", instanceId);\n                Object.keys(params).forEach(function (x) {\n                  finalUrl.searchParams.append(x, params[x]);\n                });\n                if (this.dappStorageKey) {\n                  finalUrl.hash = \"#dappStorageKey=\".concat(this.dappStorageKey);\n                }\n                // No need to track this window state. Hence, no _handleWindow call.\n                walletWindow = new PopupHandler({\n                  url: finalUrl,\n                  features: getPopupFeatures(FEATURES_DEFAULT_WALLET_WINDOW)\n                });\n                walletWindow.open();\n              case 11:\n              case \"end\":\n                return _context16.stop();\n            }\n          }\n        }, _callee16, this);\n      }));\n      function showWallet(_x9) {\n        return _showWallet.apply(this, arguments);\n      }\n      return showWallet;\n    }()\n  }, {\n    key: \"getUserInfo\",\n    value: function () {\n      var _getUserInfo = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee17() {\n        var userInfoResponse;\n        return _regeneratorRuntime().wrap(function _callee17$(_context17) {\n          while (1) {\n            switch (_context17.prev = _context17.next) {\n              case 0:\n                _context17.next = 2;\n                return this.communicationProvider.request({\n                  method: COMMUNICATION_JRPC_METHODS.USER_INFO,\n                  params: []\n                });\n              case 2:\n                userInfoResponse = _context17.sent;\n                return _context17.abrupt(\"return\", userInfoResponse);\n              case 4:\n              case \"end\":\n                return _context17.stop();\n            }\n          }\n        }, _callee17, this);\n      }));\n      function getUserInfo() {\n        return _getUserInfo.apply(this, arguments);\n      }\n      return getUserInfo;\n    }()\n  }, {\n    key: \"initiateTopup\",\n    value: function () {\n      var _initiateTopup = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee18(provider, params) {\n        var windowId, topupResponse;\n        return _regeneratorRuntime().wrap(function _callee18$(_context18) {\n          while (1) {\n            switch (_context18.prev = _context18.next) {\n              case 0:\n                if (this.isInitialized) {\n                  _context18.next = 2;\n                  break;\n                }\n                throw new Error(\"Torus is not initialized\");\n              case 2:\n                windowId = getWindowId();\n                this.communicationProvider._handleWindow(windowId);\n                _context18.next = 6;\n                return this.communicationProvider.request({\n                  method: COMMUNICATION_JRPC_METHODS.TOPUP,\n                  params: {\n                    provider: provider,\n                    params: params,\n                    windowId: windowId\n                  }\n                });\n              case 6:\n                topupResponse = _context18.sent;\n                return _context18.abrupt(\"return\", topupResponse);\n              case 8:\n              case \"end\":\n                return _context18.stop();\n            }\n          }\n        }, _callee18, this);\n      }));\n      function initiateTopup(_x10, _x11) {\n        return _initiateTopup.apply(this, arguments);\n      }\n      return initiateTopup;\n    }() // Solana specific API\n  }, {\n    key: \"getAccounts\",\n    value: function () {\n      var _getAccounts = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee19() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee19$(_context19) {\n          while (1) {\n            switch (_context19.prev = _context19.next) {\n              case 0:\n                _context19.next = 2;\n                return this.provider.request({\n                  method: \"getAccounts\",\n                  params: []\n                });\n              case 2:\n                response = _context19.sent;\n                return _context19.abrupt(\"return\", response);\n              case 4:\n              case \"end\":\n                return _context19.stop();\n            }\n          }\n        }, _callee19, this);\n      }));\n      function getAccounts() {\n        return _getAccounts.apply(this, arguments);\n      }\n      return getAccounts;\n    }()\n  }, {\n    key: \"sendTransaction\",\n    value: function () {\n      var _sendTransaction = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee20(transaction) {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee20$(_context20) {\n          while (1) {\n            switch (_context20.prev = _context20.next) {\n              case 0:\n                _context20.next = 2;\n                return this.provider.request({\n                  method: \"send_transaction\",\n                  params: {\n                    message: transaction.serialize({\n                      requireAllSignatures: false\n                    }).toString(\"hex\")\n                  }\n                });\n              case 2:\n                response = _context20.sent;\n                return _context20.abrupt(\"return\", response);\n              case 4:\n              case \"end\":\n                return _context20.stop();\n            }\n          }\n        }, _callee20, this);\n      }));\n      function sendTransaction(_x12) {\n        return _sendTransaction.apply(this, arguments);\n      }\n      return sendTransaction;\n    }() // support sendOptions\n  }, {\n    key: \"signAndSendTransaction\",\n    value: function () {\n      var _signAndSendTransaction = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee21(transaction, options) {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee21$(_context21) {\n          while (1) {\n            switch (_context21.prev = _context21.next) {\n              case 0:\n                _context21.next = 2;\n                return this.provider.request({\n                  method: \"send_transaction\",\n                  params: {\n                    message: transaction.serialize({\n                      requireAllSignatures: false\n                    }).toString(\"hex\"),\n                    options: options\n                  }\n                });\n              case 2:\n                response = _context21.sent;\n                return _context21.abrupt(\"return\", {\n                  signature: response\n                });\n              case 4:\n              case \"end\":\n                return _context21.stop();\n            }\n          }\n        }, _callee21, this);\n      }));\n      function signAndSendTransaction(_x13, _x14) {\n        return _signAndSendTransaction.apply(this, arguments);\n      }\n      return signAndSendTransaction;\n    }()\n  }, {\n    key: \"signTransaction\",\n    value: function () {\n      var _signTransaction = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee22(transaction) {\n        var response, parsed, signature;\n        return _regeneratorRuntime().wrap(function _callee22$(_context22) {\n          while (1) {\n            switch (_context22.prev = _context22.next) {\n              case 0:\n                _context22.next = 2;\n                return this.provider.request({\n                  method: \"sign_transaction\",\n                  params: {\n                    message: transaction.serializeMessage().toString(\"hex\"),\n                    messageOnly: true\n                  }\n                });\n              case 2:\n                response = _context22.sent;\n                // reconstruct signature pair\n                parsed = JSON.parse(response);\n                signature = {\n                  publicKey: new PublicKey(parsed.publicKey),\n                  signature: Buffer.from(parsed.signature, \"hex\")\n                };\n                transaction.addSignature(signature.publicKey, signature.signature);\n                return _context22.abrupt(\"return\", transaction);\n              case 7:\n              case \"end\":\n                return _context22.stop();\n            }\n          }\n        }, _callee22, this);\n      }));\n      function signTransaction(_x15) {\n        return _signTransaction.apply(this, arguments);\n      }\n      return signTransaction;\n    }()\n  }, {\n    key: \"signAllTransactions\",\n    value: function () {\n      var _signAllTransactions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee23(transactions) {\n        var encodedMessage, responses, signatures;\n        return _regeneratorRuntime().wrap(function _callee23$(_context23) {\n          while (1) {\n            switch (_context23.prev = _context23.next) {\n              case 0:\n                encodedMessage = transactions.map(function (tx) {\n                  return tx.serializeMessage().toString(\"hex\");\n                });\n                _context23.next = 3;\n                return this.provider.request({\n                  method: \"sign_all_transactions\",\n                  params: {\n                    message: encodedMessage,\n                    messageOnly: true\n                  }\n                });\n              case 3:\n                responses = _context23.sent;\n                // reconstruct signature pairs\n                signatures = responses.map(function (item) {\n                  var parsed = JSON.parse(item);\n                  return {\n                    publicKey: new PublicKey(parsed.publicKey),\n                    signature: Buffer.from(parsed.signature, \"hex\")\n                  };\n                });\n                transactions.forEach(function (tx, idx) {\n                  tx.addSignature(signatures[idx].publicKey, signatures[idx].signature);\n                  return tx;\n                });\n                return _context23.abrupt(\"return\", transactions);\n              case 7:\n              case \"end\":\n                return _context23.stop();\n            }\n          }\n        }, _callee23, this);\n      }));\n      function signAllTransactions(_x16) {\n        return _signAllTransactions.apply(this, arguments);\n      }\n      return signAllTransactions;\n    }()\n  }, {\n    key: \"signMessage\",\n    value: function () {\n      var _signMessage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee24(data) {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee24$(_context24) {\n          while (1) {\n            switch (_context24.prev = _context24.next) {\n              case 0:\n                _context24.next = 2;\n                return this.provider.request({\n                  method: \"sign_message\",\n                  params: {\n                    data: data\n                  }\n                });\n              case 2:\n                response = _context24.sent;\n                return _context24.abrupt(\"return\", response);\n              case 4:\n              case \"end\":\n                return _context24.stop();\n            }\n          }\n        }, _callee24, this);\n      }));\n      function signMessage(_x17) {\n        return _signMessage.apply(this, arguments);\n      }\n      return signMessage;\n    }()\n  }, {\n    key: \"getGaslessPublicKey\",\n    value: function () {\n      var _getGaslessPublicKey = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee25() {\n        var response;\n        return _regeneratorRuntime().wrap(function _callee25$(_context25) {\n          while (1) {\n            switch (_context25.prev = _context25.next) {\n              case 0:\n                _context25.next = 2;\n                return this.provider.request({\n                  method: \"get_gasless_public_key\",\n                  params: []\n                });\n              case 2:\n                response = _context25.sent;\n                return _context25.abrupt(\"return\", response);\n              case 4:\n              case \"end\":\n                return _context25.stop();\n            }\n          }\n        }, _callee25, this);\n      }));\n      function getGaslessPublicKey() {\n        return _getGaslessPublicKey.apply(this, arguments);\n      }\n      return getGaslessPublicKey;\n    }() // async connect(): Promise<boolean> {\n    //   const response = (await this.provider.request({\n    //     method: \"connect\",\n    //     params: {},\n    //   })) as boolean;\n    //   return response;\n    // }\n  }, {\n    key: \"handleDappStorageKey\",\n    value: function handleDappStorageKey(useLocalStorage) {\n      var dappStorageKey = \"\";\n      if (isLocalStorageAvailable && useLocalStorage) {\n        var storedKey = window.localStorage.getItem(configuration.localStorageKey);\n        if (storedKey) dappStorageKey = storedKey;else {\n          var generatedKey = \"torus-app-\".concat(getWindowId());\n          window.localStorage.setItem(configuration.localStorageKey, generatedKey);\n          dappStorageKey = generatedKey;\n        }\n      }\n      this.dappStorageKey = dappStorageKey;\n      return dappStorageKey;\n    }\n  }, {\n    key: \"_setupWeb3\",\n    value: function () {\n      var _setupWeb = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee26(providerParams) {\n        var _this14 = this;\n        var providerStream, communicationStream, inPageProvider, communicationProvider, detectAccountRequestPrototypeModifier, proxiedInPageProvider, proxiedCommunicationProvider;\n        return _regeneratorRuntime().wrap(function _callee26$(_context26) {\n          while (1) {\n            switch (_context26.prev = _context26.next) {\n              case 0:\n                log.info(\"setupWeb3 running\");\n                // setup background connection\n                providerStream = new BasePostMessageStream({\n                  name: \"embed_torus\",\n                  target: \"iframe_torus\",\n                  targetWindow: this.torusIframe.contentWindow\n                }); // We create another LocalMessageDuplexStream for communication between dapp <> iframe\n                communicationStream = new BasePostMessageStream({\n                  name: \"embed_communication\",\n                  target: \"iframe_communication\",\n                  targetWindow: this.torusIframe.contentWindow\n                }); // compose the inPage provider\n                inPageProvider = new TorusInPageProvider(providerStream, {});\n                communicationProvider = new TorusCommunicationProvider(communicationStream, {});\n                inPageProvider.tryWindowHandle = function (payload, cb) {\n                  var _payload = payload;\n                  if (!Array.isArray(_payload) && PROVIDER_UNSAFE_METHODS.includes(_payload.method)) {\n                    if (!_this14.communicationProvider.isLoggedIn) throw new Error(\"User Not Logged In\");\n                    var windowId = getWindowId();\n                    communicationProvider._handleWindow(windowId, {\n                      target: \"_blank\",\n                      features: getPopupFeatures(FEATURES_CONFIRM_WINDOW)\n                    });\n                    // for inPageProvider methods sending windowId in request instead of params\n                    // as params might be positional.\n                    _payload.windowId = windowId;\n                  }\n                  inPageProvider._rpcEngine.handle(_payload, cb);\n                };\n                communicationProvider.tryWindowHandle = function (payload, cb) {\n                  var _payload = payload;\n                  if (!Array.isArray(_payload) && COMMUNICATION_UNSAFE_METHODS.includes(_payload.method)) {\n                    var windowId = getWindowId();\n                    communicationProvider._handleWindow(windowId, {\n                      target: \"_blank\",\n                      features: getPopupFeatures(FEATURES_PROVIDER_CHANGE_WINDOW) // todo: are these features generic for all\n                    });\n                    // for communication methods sending window id in jrpc req params\n                    _payload.params.windowId = windowId;\n                  }\n                  communicationProvider._rpcEngine.handle(_payload, cb);\n                };\n                // detect solana_requestAccounts and pipe to enable for now\n                detectAccountRequestPrototypeModifier = function detectAccountRequestPrototypeModifier(m) {\n                  var originalMethod = inPageProvider[m];\n                  // eslint-disable-next-line @typescript-eslint/no-this-alias\n                  var self = _this14;\n                  inPageProvider[m] = function providerFunc(request, cb) {\n                    var method = request.method,\n                      _request$params = request.params,\n                      params = _request$params === void 0 ? [] : _request$params;\n                    if (method === \"solana_requestAccounts\") {\n                      if (!cb) return self.login({\n                        loginProvider: params[0]\n                      });\n                      self.login({\n                        loginProvider: params[0]\n                      })\n                      // eslint-disable-next-line promise/no-callback-in-promise\n                      .then(function (res) {\n                        return cb(null, res);\n                      })\n                      // eslint-disable-next-line promise/no-callback-in-promise\n                      .catch(function (err) {\n                        return cb(err);\n                      });\n                    }\n                    return originalMethod.apply(this, [request, cb]);\n                  };\n                }; // Detects call to solana_requestAccounts in request & sendAsync and passes to login\n                detectAccountRequestPrototypeModifier(\"request\");\n                detectAccountRequestPrototypeModifier(\"sendAsync\");\n                detectAccountRequestPrototypeModifier(\"send\");\n                proxiedInPageProvider = new Proxy(inPageProvider, {\n                  // straight up lie that we deleted the property so that it doesn't\n                  // throw an error in strict mode\n                  deleteProperty: function deleteProperty() {\n                    return true;\n                  }\n                });\n                proxiedCommunicationProvider = new Proxy(communicationProvider, {\n                  // straight up lie that we deleted the property so that it doesn't\n                  // throw an error in strict mode\n                  deleteProperty: function deleteProperty() {\n                    return true;\n                  }\n                });\n                this.provider = proxiedInPageProvider;\n                this.communicationProvider = proxiedCommunicationProvider;\n                _context26.next = 17;\n                return Promise.all([inPageProvider._initializeState(), communicationProvider._initializeState(_objectSpread(_objectSpread({}, providerParams), {}, {\n                  dappStorageKey: this.dappStorageKey,\n                  torusAlertContainer: this.torusAlertContainer,\n                  torusIframe: this.torusIframe\n                }))]);\n              case 17:\n                log.debug(\"Torus - injected provider\");\n              case 18:\n              case \"end\":\n                return _context26.stop();\n            }\n          }\n        }, _callee26, this);\n      }));\n      function _setupWeb3(_x18) {\n        return _setupWeb.apply(this, arguments);\n      }\n      return _setupWeb3;\n    }()\n  }]);\n  return Torus;\n}();\nexport { BUTTON_POSITION, LOGIN_PROVIDER, PAYMENT_PROVIDER, TORUS_BUILD_ENV, TorusInPageProvider, Torus as default };","map":{"version":3,"mappings":"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","names":["errors","disconnected","permanentlyDisconnected","unsupportedSync","method","invalidDuplexStream","invalidOptions","maxEventListeners","invalidRequestArgs","invalidRequestMethod","invalidRequestParams","invalidLoggerObject","invalidLoggerMethod","info","connected","chainId","warnings","PAYMENT_PROVIDER","MOONPAY","WYRE","RAMPNETWORK","XANPOOL","MERCURYO","TRANSAK","TORUS_BUILD_ENV","PRODUCTION","DEVELOPMENT","TESTING","BUTTON_POSITION","BOTTOM_LEFT","TOP_LEFT","BOTTOM_RIGHT","TOP_RIGHT","LOGIN_PROVIDER","GOOGLE","FACEBOOK","REDDIT","DISCORD","TWITCH","APPLE","LINE","GITHUB","KAKAO","LINKEDIN","TWITTER","WEIBO","WECHAT","EMAIL_PASSWORDLESS","translations","en","embed","continue","actionRequired","pendingAction","cookiesRequired","enableCookies","clickHere","de","ja","ko","zh","supportedVerifierList","api","prodTorusUrl","localStorageKey","window","location","hostname","loglevel","getLogger","createErrorMiddleware","req","res","next","error","ethErrors","rpc","invalidRequest","message","data","done","log","logStreamDisconnectWarning","remoteLabel","emitter","warningMsg","stack","warn","listenerCount","emit","getWindowId","Math","random","toString","slice","getTorusUrl","buildEnv","torusUrl","logLevel","getUserLanguage","userLanguage","navigator","language","userLanguages","split","Object","prototype","hasOwnProperty","call","config","FEATURES_PROVIDER_CHANGE_WINDOW","height","width","FEATURES_DEFAULT_WALLET_WINDOW","FEATURES_DEFAULT_POPUP_WINDOW","FEATURES_CONFIRM_WINDOW","storageAvailable","type","storage","x","setItem","removeItem","e","code","name","length","getPopupFeatures","_ref","w","h","dualScreenLeft","screenLeft","undefined","screenX","dualScreenTop","screenTop","screenY","innerWidth","document","documentElement","clientWidth","screen","innerHeight","clientHeight","systemZoom","left","abs","top","features","BaseProvider","constructor","connectionStream","jsonRpcStreamName","_defineProperty","isDuplexStream","Error","messages","isTorus","setMaxListeners","_handleConnect","bind","_handleDisconnect","_handleStreamDisconnect","_rpcRequest","_initializeState","request","sendAsync","mux","ObjectMultiplex","pump","ignoreStream","jsonRpcConnection","createStreamMiddleware","stream","createStream","rpcEngine","JRPCEngine","push","createIdRemapMiddleware","createLoggerMiddleware","origin","middleware","_rpcEngine","jsonRpcConnectionEvents","events","args","Array","isArray","params","Promise","resolve","reject","getRpcPromiseCallback","send","payload","callback","streamName","SafeEventEmitter","handleEvent","handle","eventName","handler","handlerArgs","handlerWrapper","removeEventListener","addEventListener","documentReady","readyState","htmlToElement","html","template","createElement","trimmedHtml","trim","innerHTML","content","firstChild","PopupHandler","url","target","windowTimer","iClosedWindow","_setupTimer","Number","setInterval","closed","clearInterval","open","href","_this$window","focus","close","redirect","locationReplaceOnRedirect","replace","TorusCommunicationProvider","_state","_defaultState","dappStorageKey","languageTranslations","configuration","embedTranslations","windowRefs","on","isConnected","notificationHandler","COMMUNICATION_NOTIFICATIONS","IFRAME_STATUS","isFullScreen","rid","_displayIframe","isFull","CREATE_WINDOW","windowId","_createPopupBlockAlert","CLOSE_WINDOW","_handleCloseWindow","USER_LOGGED_IN","currentLoginProvider","isLoggedIn","USER_LOGGED_OUT","isIFrameFullScreen","torusAlertContainer","torusIframe","COMMUNICATION_JRPC_METHODS","GET_PROVIDER_STATE","initialized","_handleWindow","arguments","finalUrl","URL","hash","handledWindow","OPENED_WINDOW","once","CLOSED_WINDOW","style","display","torusWidgetVisibility","buttonPosition","right","bottom","assign","hideTorusButton","showTorusButton","cb","_payload","jsonrpc","tryWindowHandle","debug","isRecoverable","errorMessage","isPermanentlyDisconnected","EthereumRpcError","logoUrl","getLogoUrl","torusAlert","successAlert","btnContainer","appendChild","bindOnLoad","remove","children","attachOnLoad","hasEmittedConnection","TorusInPageProvider","selectedAddress","_handleAccountsChanged","_handleChainChanged","_handleUnlockStateChanged","jsonRpcNotificationHandler","PROVIDER_NOTIFICATIONS","ACCOUNTS_CHANGED","UNLOCK_STATE_CHANGED","CHAIN_CHANGED","PROVIDER_JRPC_METHODS","accounts","isUnlocked","isInternal","err","result","isEthAccounts","finalAccounts","account","dequal","imgExists","img","onload","onerror","src","getSiteName","siteName","querySelector","metaTitle","title","getSiteIcon","icon","from","querySelectorAll","find","_icon","Boolean","getSiteMetadata","PROVIDER_UNSAFE_METHODS","COMMUNICATION_UNSAFE_METHODS","SET_PROVIDER","isLocalStorageAvailable","torusIframeHtml","crossOrigin","rel","relList","supports","head","preLoadIframe","Torus","modalZIndex","isInitialized","requestedLoginProvider","alertZIndex","communicationProvider","enableLogging","network","useLocalStorage","apiKey","extraParams","whiteLabel","setAPIKey","enableAll","version","setDefaultLevel","disableAll","handleDappStorageKey","torusIframeUrl","pathname","endsWith","hashParams","URLSearchParams","append","styleLink","handleSetup","body","dappMetadata","contentWindow","postMessage","_setupWeb3","topupHide","isTopupHidden","torus","loginProvider","provider","login_hint","loginParams","privateKey","userInfo","success","LOGOUT","logout","clearInit","isElement","element","Element","Document","contains","path","WALLET_INSTANCE_ID","instanceId","finalPath","searchParams","keys","forEach","walletWindow","USER_INFO","userInfoResponse","TOPUP","topupResponse","response","transaction","serialize","requireAllSignatures","options","signature","serializeMessage","messageOnly","parsed","JSON","parse","publicKey","PublicKey","Buffer","addSignature","transactions","encodedMessage","map","tx","responses","signatures","item","idx","storedKey","localStorage","getItem","generatedKey","providerParams","providerStream","BasePostMessageStream","targetWindow","communicationStream","inPageProvider","includes","detectAccountRequestPrototypeModifier","m","originalMethod","self","providerFunc","login","then","catch","apply","proxiedInPageProvider","Proxy","deleteProperty","proxiedCommunicationProvider","all"],"sources":["../../src/messages.ts","../../src/interfaces.ts","../../src/config.ts","../../src/loglevel.ts","../../src/utils.ts","../../src/baseProvider.ts","../../src/embedUtils.ts","../../src/PopupHandler.ts","../../src/communicationProvider.ts","../../src/inPageProvider.ts","../../src/siteMetadata.ts","../../src/embed.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null]},"metadata":{},"sourceType":"module","externalDependencies":[]}