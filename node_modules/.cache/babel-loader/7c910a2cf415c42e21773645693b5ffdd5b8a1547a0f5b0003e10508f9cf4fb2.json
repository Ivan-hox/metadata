{"ast":null,"code":"\"use strict\";\n\nvar _slicedToArray = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/slicedToArray.js\").default;\nvar _inherits = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/inherits.js\").default;\nvar _createSuper = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/createSuper.js\").default;\nvar _wrapNativeSuper = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/wrapNativeSuper.js\").default;\nvar _classCallCheck = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/classCallCheck.js\").default;\nvar _createClass = require(\"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/createClass.js\").default;\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  Object.defineProperty(o, k2, {\n    enumerable: true,\n    get: function get() {\n      return m[k];\n    }\n  });\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) {\n    if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  }\n  __setModuleDefault(result, mod);\n  return result;\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TokenLendingError = exports.AnchorError = exports.CustomProgramError = exports.CusperUnknownError = exports.initCusper = exports.ErrorResolver = void 0;\nvar parse_error_1 = require(\"./parse-error\");\nvar anchor = __importStar(require(\"./errors/anchor\"));\nvar token_lending_1 = require(\"./errors/token-lending\");\n// -----------------\n// Error Resolver\n// -----------------\nvar ErrorResolver = /*#__PURE__*/function () {\n  function ErrorResolver(resolveErrorFromCode) {\n    _classCallCheck(this, ErrorResolver);\n    this.resolveErrorFromCode = resolveErrorFromCode;\n  }\n  /**\n   * Attempts to resolve the provided error code to a known or custom error.\n   *\n   * @param captureBoundaryFn is used to exclude everything after (including)\n   * that function from the stack trace if possible\n   * @param fallbackToUnknown unless `false` a {@link CusperUnknownError} is\n   * returned when resolution fails\n   */\n  _createClass(ErrorResolver, [{\n    key: \"errorFromCode\",\n    value: function errorFromCode(code, captureBoundaryFn) {\n      var fallbackToUnknown = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n      // Try specific program errors first since they're more likely\n      var err = this.resolveErrorFromCode != null ? this.resolveErrorFromCode(code) : null;\n      if (err != null) {\n        return this.passPreparedError(err, captureBoundaryFn !== null && captureBoundaryFn !== void 0 ? captureBoundaryFn : this.errorFromCode);\n      }\n      // Then try errors of known programs\n      err = AnchorError.fromCode(code);\n      if (err != null) {\n        return this.passPreparedError(err, captureBoundaryFn !== null && captureBoundaryFn !== void 0 ? captureBoundaryFn : this.errorFromCode);\n      }\n      err = TokenLendingError.fromCode(code);\n      if (err != null) {\n        return this.passPreparedError(err, captureBoundaryFn !== null && captureBoundaryFn !== void 0 ? captureBoundaryFn : this.errorFromCode);\n      }\n      if (fallbackToUnknown) {\n        err = new CusperUnknownError(code, 'CusperUnknownError', 'cusper does not know this error');\n        return this.passPreparedError(err, captureBoundaryFn !== null && captureBoundaryFn !== void 0 ? captureBoundaryFn : this.errorFromCode);\n      }\n    }\n    /**\n     * Attempts to parse the error code from the provied logs and then resolve it\n     * to a known or custom error.\n     * @param fallbackToUnknown unless `false` a {@link CusperUnknownError} is\n     * returned when resolution fails\n     */\n  }, {\n    key: \"errorFromProgramLogs\",\n    value: function errorFromProgramLogs(logs) {\n      var fallbackToUnknown = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      var code = (0, parse_error_1.errorCodeFromLogs)(logs);\n      return code == null ? null : this.errorFromCode(code, this.errorFromProgramLogs, fallbackToUnknown);\n    }\n    /**\n     * Throws an error that it attempts to resolve from the logs of the provided error.\n     * If no error can be resolved it throws a {@link CusperUnknownError} instead\n     */\n  }, {\n    key: \"throwError\",\n    value: function throwError(error) {\n      var err = error.logs != null && this.errorFromProgramLogs(error.logs, true) || new CusperUnknownError(-1, 'Error created without logs and thus without error code');\n      throw this.passPreparedError(err, this.throwError);\n    }\n  }, {\n    key: \"passPreparedError\",\n    value: function passPreparedError(err, captureBoundaryFn) {\n      if (err == null) return null;\n      if (typeof Error.captureStackTrace === 'function') {\n        Error.captureStackTrace(err, captureBoundaryFn);\n      }\n      return err;\n    }\n  }]);\n  return ErrorResolver;\n}();\nexports.ErrorResolver = ErrorResolver;\n/**\n * Initializes a Custom Program Error Resolver, aka _Cusper_.\n *\n * @param resolveErrorFromCode if provided it will be used to resolve custom\n * errors before falling back to known program errors\n */\nfunction initCusper(resolveErrorFromCode) {\n  return new ErrorResolver(resolveErrorFromCode);\n}\nexports.initCusper = initCusper;\n// -----------------\n// Unknown Error\n// -----------------\n/**\n * This error is returned/raised when an error code couldn't be found or resolved to a\n * custom or known error.\n */\nvar CusperUnknownError = /*#__PURE__*/function (_Error) {\n  _inherits(CusperUnknownError, _Error);\n  var _super = _createSuper(CusperUnknownError);\n  function CusperUnknownError(code) {\n    var _this;\n    _classCallCheck(this, CusperUnknownError);\n    for (var _len = arguments.length, params = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      params[_key - 1] = arguments[_key];\n    }\n    _this = _super.call.apply(_super, [this].concat(params));\n    _this.code = code;\n    _this.name = 'CusperUnknownError';\n    return _this;\n  }\n  return _createClass(CusperUnknownError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nexports.CusperUnknownError = CusperUnknownError;\n// -----------------\n// Custom Program Error\n// -----------------\n/**\n * Used by implementers to provide their own errors to be resolved by cusper.\n */\nvar CustomProgramError = /*#__PURE__*/function (_Error2) {\n  _inherits(CustomProgramError, _Error2);\n  var _super2 = _createSuper(CustomProgramError);\n  /**\n   * Creates an instance of a {@link CustomProgramError}.\n   *\n   * @param code the error code for which this error was resolved\n   * @param name the name of the error\n   */\n  function CustomProgramError(code, name) {\n    var _this2;\n    _classCallCheck(this, CustomProgramError);\n    for (var _len2 = arguments.length, params = new Array(_len2 > 2 ? _len2 - 2 : 0), _key2 = 2; _key2 < _len2; _key2++) {\n      params[_key2 - 2] = arguments[_key2];\n    }\n    _this2 = _super2.call.apply(_super2, [this].concat(params));\n    _this2.code = code;\n    _this2.name = \"CustomProgramError#\".concat(name);\n    return _this2;\n  }\n  return _createClass(CustomProgramError);\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nexports.CustomProgramError = CustomProgramError;\n// -----------------\n// Anchor\n// -----------------\n/**\n * An error raised by the anchor program before getting to the actual program\n * implementation.\n */\nvar AnchorError = /*#__PURE__*/function (_Error3) {\n  _inherits(AnchorError, _Error3);\n  var _super3 = _createSuper(AnchorError);\n  function AnchorError(code, name) {\n    var _this3;\n    _classCallCheck(this, AnchorError);\n    for (var _len3 = arguments.length, params = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n      params[_key3 - 2] = arguments[_key3];\n    }\n    _this3 = _super3.call.apply(_super3, [this].concat(params));\n    _this3.code = code;\n    _this3.name = \"AnchorError#\".concat(name);\n    return _this3;\n  }\n  _createClass(AnchorError, [{\n    key: \"toString\",\n    value: function toString() {\n      return \"\".concat(this.name, \": \").concat(this.message);\n    }\n  }], [{\n    key: \"fromCode\",\n    value: function fromCode(code) {\n      var errorMeta = AnchorError.errorMap.get(code);\n      return errorMeta != null ? new AnchorError(errorMeta.code, errorMeta.name, errorMeta.message) : null;\n    }\n  }]);\n  return AnchorError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nexports.AnchorError = AnchorError;\nAnchorError.errorMap = Object.entries(anchor.LangErrorCode).reduce(function (acc, _ref) {\n  var _ref2 = _slicedToArray(_ref, 2),\n    key = _ref2[0],\n    code = _ref2[1];\n  acc.set(code, {\n    code: code,\n    name: key,\n    message: anchor.LangErrorMessage.get(code)\n  });\n  return acc;\n}, new Map());\n// -----------------\n// Token Lending\n// -----------------\n/**\n * Error raised by the token lending program.\n * Please note that error codes overlap with other _known_ programs as they start at `0`.\n * Thus in some cases they might be wrongly represented and actually not\n * originate from the token lending program.\n */\nvar TokenLendingError = /*#__PURE__*/function (_Error4) {\n  _inherits(TokenLendingError, _Error4);\n  var _super4 = _createSuper(TokenLendingError);\n  function TokenLendingError(code, name) {\n    var _this4;\n    _classCallCheck(this, TokenLendingError);\n    for (var _len4 = arguments.length, params = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n      params[_key4 - 2] = arguments[_key4];\n    }\n    _this4 = _super4.call.apply(_super4, [this].concat(params));\n    _this4.code = code;\n    _this4.name = \"TokenLendingError#\".concat(name);\n    return _this4;\n  }\n  _createClass(TokenLendingError, [{\n    key: \"toString\",\n    value: function toString() {\n      return \"\".concat(this.name, \": \").concat(this.message);\n    }\n  }], [{\n    key: \"fromCode\",\n    value: function fromCode(code) {\n      var errorMeta = TokenLendingError.errorMap.get(code);\n      return errorMeta != null ? new TokenLendingError(errorMeta.code, errorMeta.name, errorMeta.message) : null;\n    }\n  }]);\n  return TokenLendingError;\n}( /*#__PURE__*/_wrapNativeSuper(Error));\nexports.TokenLendingError = TokenLendingError;\nTokenLendingError.errorMap = token_lending_1.tokenLendingErrors;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AASA;AACA;AACA;AAAA,IACaA,aAAa;EACxB,uBAA6BC,oBAA2C;IAAA;IAA3C,yBAAoB,GAApBA,oBAAoB;EAA0B;EAE3E;;;;;;;;EAAA;IAAA;IAAA,OAQA,uBACEC,IAAY,EACZC,iBAA4B,EACJ;MAAA,IAAxBC,iBAAiB,uEAAG,IAAI;MAExB;MACA,IAAIC,GAAG,GACL,IAAI,CAACJ,oBAAoB,IAAI,IAAI,GAAG,IAAI,CAACA,oBAAoB,CAACC,IAAI,CAAC,GAAG,IAAI;MAE5E,IAAIG,GAAG,IAAI,IAAI,EAAE;QACf,OAAO,IAAI,CAACC,iBAAiB,CAC3BD,GAAG,EACHF,iBAAiB,aAAjBA,iBAAiB,cAAjBA,iBAAiB,GAAI,IAAI,CAACI,aAAa,CACxC;;MAGH;MACAF,GAAG,GAAGG,WAAW,CAACC,QAAQ,CAACP,IAAI,CAAC;MAChC,IAAIG,GAAG,IAAI,IAAI,EAAE;QACf,OAAO,IAAI,CAACC,iBAAiB,CAC3BD,GAAG,EACHF,iBAAiB,aAAjBA,iBAAiB,cAAjBA,iBAAiB,GAAI,IAAI,CAACI,aAAa,CACxC;;MAEHF,GAAG,GAAGK,iBAAiB,CAACD,QAAQ,CAACP,IAAI,CAAC;MACtC,IAAIG,GAAG,IAAI,IAAI,EAAE;QACf,OAAO,IAAI,CAACC,iBAAiB,CAC3BD,GAAG,EACHF,iBAAiB,aAAjBA,iBAAiB,cAAjBA,iBAAiB,GAAI,IAAI,CAACI,aAAa,CACxC;;MAGH,IAAIH,iBAAiB,EAAE;QACrBC,GAAG,GAAG,IAAIM,kBAAkB,CAC1BT,IAAI,EACJ,oBAAoB,EACpB,iCAAiC,CAClC;QACD,OAAO,IAAI,CAACI,iBAAiB,CAC3BD,GAAG,EACHF,iBAAiB,aAAjBA,iBAAiB,cAAjBA,iBAAiB,GAAI,IAAI,CAACI,aAAa,CACxC;;IAEL;IAEA;;;;;;EAAA;IAAA;IAAA,OAMA,8BACEK,IAAc,EACU;MAAA,IAAxBR,iBAAiB,uEAAG,IAAI;MAExB,IAAMF,IAAI,GAAG,mCAAiB,EAACU,IAAI,CAAC;MACpC,OAAOV,IAAI,IAAI,IAAI,GACf,IAAI,GACJ,IAAI,CAACK,aAAa,CAACL,IAAI,EAAE,IAAI,CAACW,oBAAoB,EAAET,iBAAiB,CAAC;IAC5E;IAEA;;;;EAAA;IAAA;IAAA,OAIA,oBAAWU,KAAoB;MAC7B,IAAMT,GAAG,GACNS,KAAK,CAACF,IAAI,IAAI,IAAI,IAAI,IAAI,CAACC,oBAAoB,CAACC,KAAK,CAACF,IAAI,EAAE,IAAI,CAAC,IAClE,IAAID,kBAAkB,CACpB,CAAC,CAAC,EACF,wDAAwD,CACzD;MACH,MAAM,IAAI,CAACL,iBAAiB,CAACD,GAAG,EAAE,IAAI,CAACU,UAAU,CAAC;IACpD;EAAC;IAAA;IAAA,OAEO,2BAAkBV,GAAkB,EAAEF,iBAA2B;MACvE,IAAIE,GAAG,IAAI,IAAI,EAAE,OAAO,IAAI;MAC5B,IAAI,OAAOW,KAAK,CAACC,iBAAiB,KAAK,UAAU,EAAE;QACjDD,KAAK,CAACC,iBAAiB,CAACZ,GAAG,EAAEF,iBAAiB,CAAC;;MAEjD,OAAOE,GAAG;IACZ;EAAC;EAAA;AAAA;AA5FHa;AA+FA;;;;;;AAMA,SAAgBC,UAAU,CAAClB,oBAA2C;EACpE,OAAO,IAAID,aAAa,CAACC,oBAAoB,CAAC;AAChD;AAFAiB;AAIA;AACA;AACA;AACA;;;;AAAA,IAIaP,kBAAmB;EAAA;EAAA;EAC9B,4BAAqBT,IAAY,EAAkB;IAAA;IAAA;IAAA,kCAAbkB,MAAa;MAAbA,MAAa;IAAA;IACjD,gDAASA,MAAM;IADI,UAAI,GAAJlB,IAAI;IAEvB,MAAKmB,IAAI,GAAG,oBAAoB;IAAA;EAClC;EAAC;AAAA,iCAJqCL,KAAK;AAA7CE;AAOA;AACA;AACA;AACA;;;AAAA,IAGaI,kBAAmB;EAAA;EAAA;EAC9B;;;;;;EAMA,4BAAqBpB,IAAY,EAAEmB,IAAY,EAAkB;IAAA;IAAA;IAAA,mCAAbD,MAAa;MAAbA,MAAa;IAAA;IAC/D,mDAASA,MAAM;IADI,WAAI,GAAJlB,IAAI;IAEvB,OAAKmB,IAAI,gCAAyBA,IAAI,CAAE;IAAA;EAC1C;EAAC;AAAA,iCAVqCL,KAAK;AAA7CE;AAaA;AACA;AACA;AACA;;;;AAAA,IAIaV,WAAY;EAAA;EAAA;EACvB,qBAAqBN,IAAY,EAAEmB,IAAY,EAAkB;IAAA;IAAA;IAAA,mCAAbD,MAAa;MAAbA,MAAa;IAAA;IAC/D,mDAASA,MAAM;IADI,WAAI,GAAJlB,IAAI;IAEvB,OAAKmB,IAAI,yBAAkBA,IAAI,CAAE;IAAA;EACnC;EAAC;IAAA;IAAA,OAmBD,oBAAQ;MACN,iBAAU,IAAI,CAACA,IAAI,eAAK,IAAI,CAACE,OAAO;IACtC;EAAC;IAAA;IAAA,OATD,kBAAgBrB,IAAY;MAC1B,IAAMsB,SAAS,GAAGhB,WAAW,CAACiB,QAAQ,CAACC,GAAG,CAACxB,IAAI,CAAC;MAChD,OAAOsB,SAAS,IAAI,IAAI,GACpB,IAAIhB,WAAW,CAACgB,SAAS,CAACtB,IAAI,EAAEsB,SAAS,CAACH,IAAI,EAAEG,SAAS,CAACD,OAAO,CAAC,GAClE,IAAI;IACV;EAAC;EAAA;AAAA,iCArB8BP,KAAK;AAAtCE;AAKSV,oBAAQ,GAA2BmB,MAAM,CAACC,OAAO,CACtDC,MAAM,CAACC,aAAa,CACrB,CAACC,MAAM,CAAC,UAACC,GAAG,QAAiB;EAAA;IAAdC,GAAG;IAAE/B,IAAI;EACvB8B,GAAG,CAACE,GAAG,CAAChC,IAAI,EAAE;IACZA,IAAI,EAAJA,IAAI;IACJmB,IAAI,EAAEY,GAAG;IACTV,OAAO,EAAEM,MAAM,CAACM,gBAAgB,CAACT,GAAG,CAACxB,IAAI;GAC1C,CAAC;EACF,OAAO8B,GAAG;AACZ,CAAC,EAAE,IAAII,GAAG,EAAE,CAAC;AAcf;AACA;AACA;AACA;;;;;;AAAA,IAMa1B,iBAAkB;EAAA;EAAA;EAC7B,2BAAqBR,IAAY,EAAEmB,IAAY,EAAkB;IAAA;IAAA;IAAA,mCAAbD,MAAa;MAAbA,MAAa;IAAA;IAC/D,mDAASA,MAAM;IADI,WAAI,GAAJlB,IAAI;IAEvB,OAAKmB,IAAI,+BAAwBA,IAAI,CAAE;IAAA;EACzC;EAAC;IAAA;IAAA,OASD,oBAAQ;MACN,iBAAU,IAAI,CAACA,IAAI,eAAK,IAAI,CAACE,OAAO;IACtC;EAAC;IAAA;IAAA,OATD,kBAAgBrB,IAAY;MAC1B,IAAMsB,SAAS,GAAGd,iBAAiB,CAACe,QAAQ,CAACC,GAAG,CAACxB,IAAI,CAAC;MACtD,OAAOsB,SAAS,IAAI,IAAI,GACpB,IAAId,iBAAiB,CAACc,SAAS,CAACtB,IAAI,EAAEsB,SAAS,CAACH,IAAI,EAAEG,SAAS,CAACD,OAAO,CAAC,GACxE,IAAI;IACV;EAAC;EAAA;AAAA,iCAXoCP,KAAK;AAA5CE;AAKSR,0BAAQ,GAAG2B,kCAAkB","names":["ErrorResolver","resolveErrorFromCode","code","captureBoundaryFn","fallbackToUnknown","err","passPreparedError","errorFromCode","AnchorError","fromCode","TokenLendingError","CusperUnknownError","logs","errorFromProgramLogs","error","throwError","Error","captureStackTrace","exports","initCusper","params","name","CustomProgramError","message","errorMeta","errorMap","get","Object","entries","anchor","LangErrorCode","reduce","acc","key","set","LangErrorMessage","Map","token_lending_1"],"sources":["../../src/resolve-error.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script","externalDependencies":[]}