{"ast":null,"code":"import { ACCOUNT_SIZE } from '../state/account.js';\nimport { MINT_SIZE } from '../state/mint.js';\nimport { MULTISIG_SIZE } from '../state/multisig.js';\nimport { ACCOUNT_TYPE_SIZE } from './accountType.js';\nimport { DEFAULT_ACCOUNT_STATE_SIZE } from './defaultAccountState/index.js';\nimport { IMMUTABLE_OWNER_SIZE } from './immutableOwner.js';\nimport { INTEREST_BEARING_MINT_CONFIG_STATE_SIZE } from './interestBearingMint/state.js';\nimport { MEMO_TRANSFER_SIZE } from './memoTransfer/index.js';\nimport { MINT_CLOSE_AUTHORITY_SIZE } from './mintCloseAuthority.js';\nimport { NON_TRANSFERABLE_SIZE } from './nonTransferable.js';\nimport { TRANSFER_FEE_AMOUNT_SIZE, TRANSFER_FEE_CONFIG_SIZE } from './transferFee/index.js';\nexport var ExtensionType;\n(function (ExtensionType) {\n  ExtensionType[ExtensionType[\"Uninitialized\"] = 0] = \"Uninitialized\";\n  ExtensionType[ExtensionType[\"TransferFeeConfig\"] = 1] = \"TransferFeeConfig\";\n  ExtensionType[ExtensionType[\"TransferFeeAmount\"] = 2] = \"TransferFeeAmount\";\n  ExtensionType[ExtensionType[\"MintCloseAuthority\"] = 3] = \"MintCloseAuthority\";\n  ExtensionType[ExtensionType[\"ConfidentialTransferMint\"] = 4] = \"ConfidentialTransferMint\";\n  ExtensionType[ExtensionType[\"ConfidentialTransferAccount\"] = 5] = \"ConfidentialTransferAccount\";\n  ExtensionType[ExtensionType[\"DefaultAccountState\"] = 6] = \"DefaultAccountState\";\n  ExtensionType[ExtensionType[\"ImmutableOwner\"] = 7] = \"ImmutableOwner\";\n  ExtensionType[ExtensionType[\"MemoTransfer\"] = 8] = \"MemoTransfer\";\n  ExtensionType[ExtensionType[\"NonTransferable\"] = 9] = \"NonTransferable\";\n  ExtensionType[ExtensionType[\"InterestBearingMint\"] = 10] = \"InterestBearingMint\";\n})(ExtensionType || (ExtensionType = {}));\nexport var TYPE_SIZE = 2;\nexport var LENGTH_SIZE = 2;\n// NOTE: All of these should eventually use their type's Span instead of these\n// constants.  This is provided for at least creation to work.\nexport function getTypeLen(e) {\n  switch (e) {\n    case ExtensionType.Uninitialized:\n      return 0;\n    case ExtensionType.TransferFeeConfig:\n      return TRANSFER_FEE_CONFIG_SIZE;\n    case ExtensionType.TransferFeeAmount:\n      return TRANSFER_FEE_AMOUNT_SIZE;\n    case ExtensionType.MintCloseAuthority:\n      return MINT_CLOSE_AUTHORITY_SIZE;\n    case ExtensionType.ConfidentialTransferMint:\n      return 97;\n    case ExtensionType.ConfidentialTransferAccount:\n      return 286;\n    case ExtensionType.DefaultAccountState:\n      return DEFAULT_ACCOUNT_STATE_SIZE;\n    case ExtensionType.ImmutableOwner:\n      return IMMUTABLE_OWNER_SIZE;\n    case ExtensionType.MemoTransfer:\n      return MEMO_TRANSFER_SIZE;\n    case ExtensionType.NonTransferable:\n      return NON_TRANSFERABLE_SIZE;\n    case ExtensionType.InterestBearingMint:\n      return INTEREST_BEARING_MINT_CONFIG_STATE_SIZE;\n    default:\n      throw Error(\"Unknown extension type: \".concat(e));\n  }\n}\nexport function getAccountTypeOfMintType(e) {\n  switch (e) {\n    case ExtensionType.TransferFeeConfig:\n      return ExtensionType.TransferFeeAmount;\n    case ExtensionType.ConfidentialTransferMint:\n      return ExtensionType.ConfidentialTransferAccount;\n    case ExtensionType.TransferFeeAmount:\n    case ExtensionType.ConfidentialTransferAccount:\n    case ExtensionType.DefaultAccountState:\n    case ExtensionType.ImmutableOwner:\n    case ExtensionType.MemoTransfer:\n    case ExtensionType.MintCloseAuthority:\n    case ExtensionType.NonTransferable:\n    case ExtensionType.Uninitialized:\n    case ExtensionType.InterestBearingMint:\n      return ExtensionType.Uninitialized;\n  }\n}\nfunction getLen(extensionTypes, baseSize) {\n  if (extensionTypes.length === 0) {\n    return baseSize;\n  } else {\n    var accountLength = ACCOUNT_SIZE + ACCOUNT_TYPE_SIZE + extensionTypes.filter(function (element, i) {\n      return i === extensionTypes.indexOf(element);\n    }).map(function (element) {\n      return getTypeLen(element) + TYPE_SIZE + LENGTH_SIZE;\n    }).reduce(function (a, b) {\n      return a + b;\n    });\n    if (accountLength === MULTISIG_SIZE) {\n      return accountLength + TYPE_SIZE;\n    } else {\n      return accountLength;\n    }\n  }\n}\nexport function getMintLen(extensionTypes) {\n  return getLen(extensionTypes, MINT_SIZE);\n}\nexport function getAccountLen(extensionTypes) {\n  return getLen(extensionTypes, ACCOUNT_SIZE);\n}\nexport function getExtensionData(extension, tlvData) {\n  var extensionTypeIndex = 0;\n  while (extensionTypeIndex < tlvData.length) {\n    var entryType = tlvData.readUInt16LE(extensionTypeIndex);\n    var entryLength = tlvData.readUInt16LE(extensionTypeIndex + TYPE_SIZE);\n    var typeIndex = extensionTypeIndex + TYPE_SIZE + LENGTH_SIZE;\n    if (entryType == extension) {\n      return tlvData.slice(typeIndex, typeIndex + entryLength);\n    }\n    extensionTypeIndex = typeIndex + entryLength;\n  }\n  return null;\n}\nexport function getExtensionTypes(tlvData) {\n  var extensionTypes = [];\n  var extensionTypeIndex = 0;\n  while (extensionTypeIndex < tlvData.length) {\n    var entryType = tlvData.readUInt16LE(extensionTypeIndex);\n    extensionTypes.push(entryType);\n    var entryLength = tlvData.readUInt16LE(extensionTypeIndex + TYPE_SIZE);\n    extensionTypeIndex += TYPE_SIZE + LENGTH_SIZE + entryLength;\n  }\n  return extensionTypes;\n}\nexport function getAccountLenForMint(mint) {\n  var extensionTypes = getExtensionTypes(mint.tlvData);\n  var accountExtensions = extensionTypes.map(getAccountTypeOfMintType);\n  return getAccountLen(accountExtensions);\n}","map":{"version":3,"mappings":"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","names":["ACCOUNT_SIZE","MINT_SIZE","MULTISIG_SIZE","ACCOUNT_TYPE_SIZE","DEFAULT_ACCOUNT_STATE_SIZE","IMMUTABLE_OWNER_SIZE","INTEREST_BEARING_MINT_CONFIG_STATE_SIZE","MEMO_TRANSFER_SIZE","MINT_CLOSE_AUTHORITY_SIZE","NON_TRANSFERABLE_SIZE","TRANSFER_FEE_AMOUNT_SIZE","TRANSFER_FEE_CONFIG_SIZE","ExtensionType","TYPE_SIZE","LENGTH_SIZE","getTypeLen","e","Uninitialized","TransferFeeConfig","TransferFeeAmount","MintCloseAuthority","ConfidentialTransferMint","ConfidentialTransferAccount","DefaultAccountState","ImmutableOwner","MemoTransfer","NonTransferable","InterestBearingMint","Error","getAccountTypeOfMintType","getLen","extensionTypes","baseSize","length","accountLength","filter","element","i","indexOf","map","reduce","a","b","getMintLen","getAccountLen","getExtensionData","extension","tlvData","extensionTypeIndex","entryType","readUInt16LE","entryLength","typeIndex","slice","getExtensionTypes","push","getAccountLenForMint","mint","accountExtensions"],"sources":["/Users/ivan/Metadata/node_modules/@solana/spl-token/src/extensions/extensionType.ts"],"sourcesContent":["import { ACCOUNT_SIZE } from '../state/account.js';\nimport type { Mint } from '../state/mint.js';\nimport { MINT_SIZE } from '../state/mint.js';\nimport { MULTISIG_SIZE } from '../state/multisig.js';\nimport { ACCOUNT_TYPE_SIZE } from './accountType.js';\nimport { DEFAULT_ACCOUNT_STATE_SIZE } from './defaultAccountState/index.js';\nimport { IMMUTABLE_OWNER_SIZE } from './immutableOwner.js';\nimport { INTEREST_BEARING_MINT_CONFIG_STATE_SIZE } from './interestBearingMint/state.js';\nimport { MEMO_TRANSFER_SIZE } from './memoTransfer/index.js';\nimport { MINT_CLOSE_AUTHORITY_SIZE } from './mintCloseAuthority.js';\nimport { NON_TRANSFERABLE_SIZE } from './nonTransferable.js';\nimport { TRANSFER_FEE_AMOUNT_SIZE, TRANSFER_FEE_CONFIG_SIZE } from './transferFee/index.js';\n\nexport enum ExtensionType {\n    Uninitialized,\n    TransferFeeConfig,\n    TransferFeeAmount,\n    MintCloseAuthority,\n    ConfidentialTransferMint,\n    ConfidentialTransferAccount,\n    DefaultAccountState,\n    ImmutableOwner,\n    MemoTransfer,\n    NonTransferable,\n    InterestBearingMint,\n}\n\nexport const TYPE_SIZE = 2;\nexport const LENGTH_SIZE = 2;\n\n// NOTE: All of these should eventually use their type's Span instead of these\n// constants.  This is provided for at least creation to work.\nexport function getTypeLen(e: ExtensionType): number {\n    switch (e) {\n        case ExtensionType.Uninitialized:\n            return 0;\n        case ExtensionType.TransferFeeConfig:\n            return TRANSFER_FEE_CONFIG_SIZE;\n        case ExtensionType.TransferFeeAmount:\n            return TRANSFER_FEE_AMOUNT_SIZE;\n        case ExtensionType.MintCloseAuthority:\n            return MINT_CLOSE_AUTHORITY_SIZE;\n        case ExtensionType.ConfidentialTransferMint:\n            return 97;\n        case ExtensionType.ConfidentialTransferAccount:\n            return 286;\n        case ExtensionType.DefaultAccountState:\n            return DEFAULT_ACCOUNT_STATE_SIZE;\n        case ExtensionType.ImmutableOwner:\n            return IMMUTABLE_OWNER_SIZE;\n        case ExtensionType.MemoTransfer:\n            return MEMO_TRANSFER_SIZE;\n        case ExtensionType.NonTransferable:\n            return NON_TRANSFERABLE_SIZE;\n        case ExtensionType.InterestBearingMint:\n            return INTEREST_BEARING_MINT_CONFIG_STATE_SIZE;\n        default:\n            throw Error(`Unknown extension type: ${e}`);\n    }\n}\n\nexport function getAccountTypeOfMintType(e: ExtensionType): ExtensionType {\n    switch (e) {\n        case ExtensionType.TransferFeeConfig:\n            return ExtensionType.TransferFeeAmount;\n        case ExtensionType.ConfidentialTransferMint:\n            return ExtensionType.ConfidentialTransferAccount;\n        case ExtensionType.TransferFeeAmount:\n        case ExtensionType.ConfidentialTransferAccount:\n        case ExtensionType.DefaultAccountState:\n        case ExtensionType.ImmutableOwner:\n        case ExtensionType.MemoTransfer:\n        case ExtensionType.MintCloseAuthority:\n        case ExtensionType.NonTransferable:\n        case ExtensionType.Uninitialized:\n        case ExtensionType.InterestBearingMint:\n            return ExtensionType.Uninitialized;\n    }\n}\n\nfunction getLen(extensionTypes: ExtensionType[], baseSize: number): number {\n    if (extensionTypes.length === 0) {\n        return baseSize;\n    } else {\n        const accountLength =\n            ACCOUNT_SIZE +\n            ACCOUNT_TYPE_SIZE +\n            extensionTypes\n                .filter((element, i) => i === extensionTypes.indexOf(element))\n                .map((element) => getTypeLen(element) + TYPE_SIZE + LENGTH_SIZE)\n                .reduce((a, b) => a + b);\n        if (accountLength === MULTISIG_SIZE) {\n            return accountLength + TYPE_SIZE;\n        } else {\n            return accountLength;\n        }\n    }\n}\n\nexport function getMintLen(extensionTypes: ExtensionType[]): number {\n    return getLen(extensionTypes, MINT_SIZE);\n}\n\nexport function getAccountLen(extensionTypes: ExtensionType[]): number {\n    return getLen(extensionTypes, ACCOUNT_SIZE);\n}\n\nexport function getExtensionData(extension: ExtensionType, tlvData: Buffer): Buffer | null {\n    let extensionTypeIndex = 0;\n    while (extensionTypeIndex < tlvData.length) {\n        const entryType = tlvData.readUInt16LE(extensionTypeIndex);\n        const entryLength = tlvData.readUInt16LE(extensionTypeIndex + TYPE_SIZE);\n        const typeIndex = extensionTypeIndex + TYPE_SIZE + LENGTH_SIZE;\n        if (entryType == extension) {\n            return tlvData.slice(typeIndex, typeIndex + entryLength);\n        }\n        extensionTypeIndex = typeIndex + entryLength;\n    }\n    return null;\n}\n\nexport function getExtensionTypes(tlvData: Buffer): ExtensionType[] {\n    const extensionTypes = [];\n    let extensionTypeIndex = 0;\n    while (extensionTypeIndex < tlvData.length) {\n        const entryType = tlvData.readUInt16LE(extensionTypeIndex);\n        extensionTypes.push(entryType);\n        const entryLength = tlvData.readUInt16LE(extensionTypeIndex + TYPE_SIZE);\n        extensionTypeIndex += TYPE_SIZE + LENGTH_SIZE + entryLength;\n    }\n    return extensionTypes;\n}\n\nexport function getAccountLenForMint(mint: Mint): number {\n    const extensionTypes = getExtensionTypes(mint.tlvData);\n    const accountExtensions = extensionTypes.map(getAccountTypeOfMintType);\n    return getAccountLen(accountExtensions);\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}