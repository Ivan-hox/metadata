{"ast":null,"code":"import _regeneratorRuntime from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _classCallCheck from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/ivan/Metadata/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport { assertPayloadIsMessageSignatureNeededResponsePayload, ConnectionManager, Platform, PopupEvent, assertPayloadIsSolanaWalletAdapterApproved, DEFAULT_POPUP_HEIGHT_PX, assertPayloadIsTransactionSignatureNeededResponsePayload } from '@fractalwagmi/popup-connection';\nimport { WalletError, WalletNotConnectedError, WalletSignTransactionError, WalletPublicKeyError, WalletConnectionError, WalletSignMessageError } from '@solana/wallet-adapter-base';\nimport { Transaction, PublicKey } from '@solana/web3.js';\nimport base58 from 'bs58';\nimport { createNonce } from \"./nonce.js\";\nvar UNKNOWN_ERROR_MESSAGE = 'Unknown Error';\nvar FRACTAL_DOMAIN_HTTPS = 'https://fractal.is';\nvar APPROVE_PAGE_URL = \"\".concat(FRACTAL_DOMAIN_HTTPS, \"/wallet-adapter/approve\");\nvar SIGN_PAGE_URL = \"\".concat(FRACTAL_DOMAIN_HTTPS, \"/wallet-adapter/sign\");\nvar MIN_POPUP_HEIGHT_PX = DEFAULT_POPUP_HEIGHT_PX;\nvar MAX_POPUP_WIDTH_PX = 850;\nvar LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY = 'RdxqNYxF';\nexport var FractalWalletAdapterImpl = /*#__PURE__*/function () {\n  function FractalWalletAdapterImpl() {\n    _classCallCheck(this, FractalWalletAdapterImpl);\n    this.popupManager = new ConnectionManager(Platform.SOLANA_WALLET_ADAPTER);\n    this.publicKey = null;\n    this.connecting = false;\n  }\n  _createClass(FractalWalletAdapterImpl, [{\n    key: \"getPublicKey\",\n    value: function getPublicKey() {\n      return this.publicKey;\n    }\n  }, {\n    key: \"connect\",\n    value: function () {\n      var _connect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n        var _this = this;\n        var resolve, reject, publicKeyInLocalStorage, nonce, handleSolanaWalletAdapterApproved, handleExplicitDenialByUser, handleClosedByUser;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                publicKeyInLocalStorage = window.localStorage.getItem(LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY);\n                if (!publicKeyInLocalStorage) {\n                  _context.next = 4;\n                  break;\n                }\n                this.publicKey = new PublicKey(publicKeyInLocalStorage);\n                return _context.abrupt(\"return\", Promise.resolve());\n              case 4:\n                nonce = createNonce();\n                this.popupManager.open({\n                  nonce: nonce,\n                  url: \"\".concat(APPROVE_PAGE_URL, \"/\").concat(nonce)\n                });\n                handleSolanaWalletAdapterApproved = function handleSolanaWalletAdapterApproved(payload) {\n                  if (!assertPayloadIsSolanaWalletAdapterApproved(payload)) {\n                    reject(new WalletConnectionError('Malformed payload when setting up connection. ' + 'Expected { solanaPublicKey: string } but ' + \"received \".concat(JSON.stringify(payload))));\n                    _this.popupManager.close();\n                    return;\n                  }\n                  try {\n                    _this.publicKey = new PublicKey(payload.solanaPublicKey);\n                    window.localStorage.setItem(LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY, payload.solanaPublicKey);\n                    resolve();\n                  } catch (error) {\n                    var publicKeyError = new WalletPublicKeyError(error instanceof Error ? error.message : UNKNOWN_ERROR_MESSAGE, error);\n                    reject(publicKeyError);\n                  }\n                  _this.popupManager.close();\n                };\n                handleExplicitDenialByUser = function handleExplicitDenialByUser() {\n                  reject(new WalletConnectionError('The user denied the connection.'));\n                  _this.popupManager.close();\n                };\n                handleClosedByUser = function handleClosedByUser() {\n                  reject(new WalletConnectionError('The user denied the connection.'));\n                  _this.popupManager.close();\n                };\n                this.popupManager.onConnectionUpdated(function (connection) {\n                  if (!connection) {\n                    return;\n                  }\n                  connection.on(PopupEvent.SOLANA_WALLET_ADAPTER_APPROVED, handleSolanaWalletAdapterApproved);\n                  connection.on(PopupEvent.SOLANA_WALLET_ADAPTER_DENIED, handleExplicitDenialByUser);\n                  connection.on(PopupEvent.POPUP_CLOSED, handleClosedByUser);\n                });\n                return _context.abrupt(\"return\", new Promise(function (promiseResolver, promiseRejector) {\n                  resolve = promiseResolver;\n                  reject = promiseRejector;\n                }));\n              case 11:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n      function connect() {\n        return _connect.apply(this, arguments);\n      }\n      return connect;\n    }()\n  }, {\n    key: \"disconnect\",\n    value: function () {\n      var _disconnect = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                this.popupManager.tearDown();\n                this.publicKey = null;\n                window.localStorage.removeItem(LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY);\n              case 3:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n      function disconnect() {\n        return _disconnect.apply(this, arguments);\n      }\n      return disconnect;\n    }()\n  }, {\n    key: \"signTransaction\",\n    value: function () {\n      var _signTransaction = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(transaction) {\n        var result, errorToThrow;\n        return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                _context3.prev = 0;\n                this.checkWalletReadiness();\n                _context3.next = 4;\n                return this.signTransactions([transaction]);\n              case 4:\n                result = _context3.sent;\n                return _context3.abrupt(\"return\", result[0]);\n              case 8:\n                _context3.prev = 8;\n                _context3.t0 = _context3[\"catch\"](0);\n                errorToThrow = _context3.t0;\n                if (!(_context3.t0 instanceof WalletError)) {\n                  errorToThrow = new WalletSignTransactionError(_context3.t0 instanceof Error ? _context3.t0.message : UNKNOWN_ERROR_MESSAGE, _context3.t0);\n                }\n                throw errorToThrow;\n              case 13:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this, [[0, 8]]);\n      }));\n      function signTransaction(_x) {\n        return _signTransaction.apply(this, arguments);\n      }\n      return signTransaction;\n    }()\n  }, {\n    key: \"signAllTransactions\",\n    value: function () {\n      var _signAllTransactions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee4(transactions) {\n        var result, errorToThrow;\n        return _regeneratorRuntime().wrap(function _callee4$(_context4) {\n          while (1) {\n            switch (_context4.prev = _context4.next) {\n              case 0:\n                _context4.prev = 0;\n                this.checkWalletReadiness();\n                _context4.next = 4;\n                return this.signTransactions(transactions);\n              case 4:\n                result = _context4.sent;\n                return _context4.abrupt(\"return\", result);\n              case 8:\n                _context4.prev = 8;\n                _context4.t0 = _context4[\"catch\"](0);\n                errorToThrow = _context4.t0;\n                if (!(_context4.t0 instanceof WalletError)) {\n                  errorToThrow = new WalletSignTransactionError(_context4.t0 instanceof Error ? _context4.t0.message : UNKNOWN_ERROR_MESSAGE, _context4.t0);\n                }\n                throw errorToThrow;\n              case 13:\n              case \"end\":\n                return _context4.stop();\n            }\n          }\n        }, _callee4, this, [[0, 8]]);\n      }));\n      function signAllTransactions(_x2) {\n        return _signAllTransactions.apply(this, arguments);\n      }\n      return signAllTransactions;\n    }()\n  }, {\n    key: \"signMessage\",\n    value: function () {\n      var _signMessage = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee5(encodedMessage) {\n        var _this2 = this;\n        var decodedMessage, resolve, reject, handleMessageSignatureNeededResponse, handleClosedOrDeniedByUser, handleAuthLoaded, nonce;\n        return _regeneratorRuntime().wrap(function _callee5$(_context5) {\n          while (1) {\n            switch (_context5.prev = _context5.next) {\n              case 0:\n                decodedMessage = new TextDecoder().decode(encodedMessage);\n                handleMessageSignatureNeededResponse = function handleMessageSignatureNeededResponse(payload) {\n                  if (!assertPayloadIsMessageSignatureNeededResponsePayload(payload)) {\n                    var error = new WalletSignMessageError('Malformed payload when signing message. ' + 'Expected { decodedSignature: string } ' + \"but received \".concat(JSON.stringify(payload)));\n                    reject(error);\n                    _this2.popupManager.close();\n                    return;\n                  }\n                  var encodedSignature = new TextEncoder().encode(payload.decodedSignature);\n                  resolve(encodedSignature);\n                };\n                handleClosedOrDeniedByUser = function handleClosedOrDeniedByUser() {\n                  reject(new WalletSignMessageError('The user did not approve the message'));\n                  _this2.popupManager.close();\n                };\n                handleAuthLoaded = function handleAuthLoaded() {\n                  var _a;\n                  var payload = {\n                    decodedMessage: decodedMessage\n                  };\n                  (_a = _this2.popupManager.getConnection()) === null || _a === void 0 ? void 0 : _a.send({\n                    event: PopupEvent.MESSAGE_SIGNATURE_NEEDED,\n                    payload: payload\n                  });\n                };\n                nonce = createNonce();\n                this.popupManager.open({\n                  heightPx: Math.max(MIN_POPUP_HEIGHT_PX, Math.floor(window.innerHeight * 0.8)),\n                  nonce: nonce,\n                  url: \"\".concat(SIGN_PAGE_URL, \"/\").concat(nonce),\n                  widthPx: Math.min(MAX_POPUP_WIDTH_PX, Math.floor(window.innerWidth * 0.8))\n                });\n                this.popupManager.onConnectionUpdated(function (connection) {\n                  if (!connection) {\n                    return;\n                  }\n                  connection.on(PopupEvent.MESSAGE_SIGNATURE_NEEDED_RESPONSE, handleMessageSignatureNeededResponse);\n                  connection.on(PopupEvent.TRANSACTION_DENIED, handleClosedOrDeniedByUser);\n                  connection.on(PopupEvent.POPUP_CLOSED, handleClosedOrDeniedByUser);\n                  connection.on(PopupEvent.AUTH_LOADED, handleAuthLoaded);\n                });\n                return _context5.abrupt(\"return\", new Promise(function (promiseResolver, promiseRejector) {\n                  resolve = promiseResolver;\n                  reject = promiseRejector;\n                }));\n              case 8:\n              case \"end\":\n                return _context5.stop();\n            }\n          }\n        }, _callee5, this);\n      }));\n      function signMessage(_x3) {\n        return _signMessage.apply(this, arguments);\n      }\n      return signMessage;\n    }()\n  }, {\n    key: \"signTransactions\",\n    value: function () {\n      var _signTransactions = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee6(transactions) {\n        var _this3 = this;\n        var resolve, reject, handleTransactionSignatureNeededResponse, handleClosedOrDeniedByUser, handleAuthLoaded, nonce;\n        return _regeneratorRuntime().wrap(function _callee6$(_context6) {\n          while (1) {\n            switch (_context6.prev = _context6.next) {\n              case 0:\n                handleTransactionSignatureNeededResponse = function handleTransactionSignatureNeededResponse(payload) {\n                  if (!assertPayloadIsTransactionSignatureNeededResponsePayload(payload)) {\n                    var error = new WalletSignTransactionError('Malformed payload when signing transactions. ' + 'Expected { signedB58Transactions: string[] } ' + \"but received \".concat(JSON.stringify(payload)));\n                    reject(error);\n                    _this3.popupManager.close();\n                    return;\n                  }\n                  var signedTransactions = payload.signedB58Transactions.map(function (signedB58Transaction) {\n                    return Transaction.from(base58.decode(signedB58Transaction));\n                  });\n                  resolve(signedTransactions);\n                  _this3.popupManager.close();\n                };\n                handleClosedOrDeniedByUser = function handleClosedOrDeniedByUser() {\n                  reject(new WalletSignTransactionError('The user did not approve the transaction'));\n                  _this3.popupManager.close();\n                };\n                handleAuthLoaded = function handleAuthLoaded() {\n                  var _a;\n                  var payload = {\n                    unsignedB58Transactions: transactions.map(function (t) {\n                      return base58.encode(t.serializeMessage());\n                    })\n                  };\n                  (_a = _this3.popupManager.getConnection()) === null || _a === void 0 ? void 0 : _a.send({\n                    event: PopupEvent.TRANSACTION_SIGNATURE_NEEDED,\n                    payload: payload\n                  });\n                };\n                nonce = createNonce();\n                this.popupManager.open({\n                  heightPx: Math.max(MIN_POPUP_HEIGHT_PX, Math.floor(window.innerHeight * 0.8)),\n                  nonce: nonce,\n                  url: \"\".concat(SIGN_PAGE_URL, \"/\").concat(nonce),\n                  widthPx: Math.min(MAX_POPUP_WIDTH_PX, Math.floor(window.innerWidth * 0.8))\n                });\n                this.popupManager.onConnectionUpdated(function (connection) {\n                  if (!connection) {\n                    return;\n                  }\n                  connection.on(PopupEvent.TRANSACTION_SIGNATURE_NEEDED_RESPONSE, handleTransactionSignatureNeededResponse);\n                  connection.on(PopupEvent.TRANSACTION_DENIED, handleClosedOrDeniedByUser);\n                  connection.on(PopupEvent.POPUP_CLOSED, handleClosedOrDeniedByUser);\n                  connection.on(PopupEvent.AUTH_LOADED, handleAuthLoaded);\n                });\n                return _context6.abrupt(\"return\", new Promise(function (promiseResolver, promiseRejector) {\n                  resolve = promiseResolver;\n                  reject = promiseRejector;\n                }));\n              case 7:\n              case \"end\":\n                return _context6.stop();\n            }\n          }\n        }, _callee6, this);\n      }));\n      function signTransactions(_x4) {\n        return _signTransactions.apply(this, arguments);\n      }\n      return signTransactions;\n    }()\n  }, {\n    key: \"checkWalletReadiness\",\n    value: function checkWalletReadiness() {\n      if (this.publicKey === null) {\n        throw new WalletNotConnectedError('`publicKey` is null. Did you forget to call `.connect()`?');\n      }\n    }\n  }]);\n  return FractalWalletAdapterImpl;\n}();","map":{"version":3,"mappings":"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","names":["assertPayloadIsMessageSignatureNeededResponsePayload","ConnectionManager","Platform","PopupEvent","assertPayloadIsSolanaWalletAdapterApproved","DEFAULT_POPUP_HEIGHT_PX","assertPayloadIsTransactionSignatureNeededResponsePayload","WalletError","WalletNotConnectedError","WalletSignTransactionError","WalletPublicKeyError","WalletConnectionError","WalletSignMessageError","Transaction","PublicKey","base58","createNonce","UNKNOWN_ERROR_MESSAGE","FRACTAL_DOMAIN_HTTPS","APPROVE_PAGE_URL","SIGN_PAGE_URL","MIN_POPUP_HEIGHT_PX","MAX_POPUP_WIDTH_PX","LOCAL_STORAGE_KEY_FOR_PUBLIC_KEY","FractalWalletAdapterImpl","SOLANA_WALLET_ADAPTER","publicKey","publicKeyInLocalStorage","window","localStorage","getItem","Promise","resolve","nonce","popupManager","open","url","handleSolanaWalletAdapterApproved","payload","reject","JSON","stringify","close","solanaPublicKey","setItem","error","publicKeyError","Error","message","handleExplicitDenialByUser","handleClosedByUser","onConnectionUpdated","connection","on","SOLANA_WALLET_ADAPTER_APPROVED","SOLANA_WALLET_ADAPTER_DENIED","POPUP_CLOSED","promiseResolver","promiseRejector","tearDown","removeItem","transaction","checkWalletReadiness","signTransactions","result","errorToThrow","transactions","encodedMessage","decodedMessage","TextDecoder","decode","handleMessageSignatureNeededResponse","encodedSignature","TextEncoder","encode","decodedSignature","handleClosedOrDeniedByUser","handleAuthLoaded","getConnection","send","event","MESSAGE_SIGNATURE_NEEDED","heightPx","Math","max","floor","innerHeight","widthPx","min","innerWidth","MESSAGE_SIGNATURE_NEEDED_RESPONSE","TRANSACTION_DENIED","AUTH_LOADED","handleTransactionSignatureNeededResponse","signedTransactions","signedB58Transactions","map","from","signedB58Transaction","unsignedB58Transactions","t","serializeMessage","TRANSACTION_SIGNATURE_NEEDED","TRANSACTION_SIGNATURE_NEEDED_RESPONSE"],"sources":["../../../src/core/fractal-wallet-adapter-impl.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}